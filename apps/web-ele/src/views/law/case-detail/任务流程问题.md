# 任务流程问题归档

## 1. 任务阶段划分
- **第一阶段**：法院指定管理人至管理人接管破产企业前的工作
- **第二阶段**：管理人接管破产企业至调查审查破产企业前的工作
- **第三阶段**：管理人调查审查破产企业至第一次债权人会议前工作
- **第四阶段**：第一次债权人会议至破产宣告前的工作
- **第五阶段**：破产宣告至破产程序终结前的工作

## 2. 任务类型与OperateType映射

### 第一阶段任务
| 任务ID | 任务名称 | OperateType |
|--------|----------|-------------|
| workTeam | 工作团队确认 | 0 |
| workPlan | 工作计划确认 | 1 |
| management | 管理制度确认 | 2 |
| sealManagement | 印章确认 | 3 |
| legalProcedure | 法律程序确认 | 4 |

### 第二阶段任务
| 任务ID | 任务名称 | OperateType |
|--------|----------|-------------|
| propertyReceipt | 财产接管确认 | 0 |
| emergency | 应急预案确认 | 1 |
| propertyPlan | 财产处置计划确认 | 2 |
| personnelEmp | 人事管理确认 | 3 |
| internalAffairs | 内部事务确认 | 4 |
| businessManagement | 经营管理确认 | 5 |

### 第三阶段任务
| 任务ID | 任务名称 | OperateType |
|--------|----------|-------------|
| propertyInvestigation | 财产调查 | 0 |
| bankExpenses | 银行费用 | 1 |
| rightsClaim | 权利主张 | 2 |
| reclaimReview | 回收审核 | 3 |
| litigationArbitration | 诉讼仲裁 | 4 |
| creditorClaim | 债权人申报 | 5 |
| socialSF | 社保费用表 | 6 |
| taxVerification | 税收核定表 | 7 |

## 3. 更新接口配置

| 阶段 | 更新接口URL |
|------|-------------|
| 第一阶段 | http://192.168.0.107:8085/api/web/update1?token=ff3378dd6264d6a0d4293d322e738a85 |
| 第二阶段 | http://192.168.0.107:8085/api/web/update2?token=5781352a1e8bd95e5fa74f0ff47074c5 |
| 第三阶段 | http://192.168.0.107:8085/api/web/update3?token=da90b1901ed746289dd074c1af9dfa55 |

## 4. 任务操作流程

### 4.1 新增任务
- 点击"新增"按钮，进入新增页面
- 填写任务表单数据
- 点击"保存"或"保存并确认"按钮
- 调用对应任务类型的新增接口

### 4.2 编辑任务
- 点击"编辑"按钮，进入编辑页面
- 修改任务表单数据
- 点击"保存"或"保存并确认"按钮
- 根据任务所属阶段，调用对应的update接口
- 传递参数：OperateType、SEP_EUSER、SEP_EDATE、ZT等

### 4.3 完成任务
- 点击"完成"按钮
- 调用对应阶段的update接口
- 设置ZT=1（完成状态）
- 传递参数：OperateType、SEP_EUSER、SEP_EDATE

### 4.4 跳过任务
- 点击"跳过"按钮
- 根据任务所属阶段，调用对应的update接口
- 设置ZT=2（跳过状态）
- 传递参数：OperateType、SEP_EUSER、SEP_EDATE

### 4.5 撤回操作
- 点击"撤回"按钮
- 根据任务所属阶段，调用对应的update接口
- 设置ZT=0（未确认状态）
- 传递参数：OperateType、SEP_EUSER、SEP_EDATE

## 5. 模糊点与问题

### 5.1 第四、五阶段任务处理
- 第四、五阶段任务的API接口配置缺失
- 第四、五阶段任务的OperateType映射关系未明确

### 5.2 任务状态管理
- 任务状态（未确认、完成、跳过）的后端存储字段不统一
- 部分任务使用`DQZT`字段，部分任务使用`zt`字段

### 5.3 API接口调用
- 部分任务的新增接口与修改接口分离，部分任务共用同一接口
- 第三阶段任务的API调用实现与其他阶段不一致

### 5.4 数据结构一致性
- 不同任务类型的API返回数据结构不一致
- 部分任务返回分页数据（包含records字段），部分任务直接返回数组或单个对象

### 5.5 权限与操作人管理
- 操作人信息获取方式不一致（部分使用uName，部分使用U_USER）
- 缺少统一的权限管理机制

## 6. 建议改进

### 6.1 统一API接口规范
- 所有任务类型采用统一的API接口格式
- 统一返回数据结构，包括状态码、消息、数据列表等

### 6.2 完善阶段配置
- 补充第四、五阶段任务的API接口配置
- 明确所有任务类型的OperateType映射关系

### 6.3 优化状态管理
- 统一任务状态的后端存储字段
- 完善状态转换逻辑，确保前端与后端状态一致

### 6.4 增强错误处理
- 完善API调用错误处理机制
- 提供更详细的错误信息，便于调试和用户理解

### 6.5 统一操作人信息
- 统一操作人信息的获取方式和存储字段
- 实现统一的权限验证机制

## 7. 代码优化建议

### 7.1 组件化设计
- 将任务流程组件拆分为更小的可复用组件
- 提取公共逻辑，如API调用、状态管理等

### 7.2 类型安全
- 完善TypeScript类型定义
- 确保所有API调用和数据处理都有类型支持

### 7.3 错误边界
- 添加错误边界处理，防止单个任务失败影响整个流程
- 实现重试机制，提高系统健壮性

### 7.4 性能优化
- 优化API调用，减少不必要的网络请求
- 实现数据缓存，提高页面加载速度

### 7.5 代码可读性
- 优化代码结构，提高可读性
- 添加必要的注释和文档

## 8. 测试建议

### 8.1 单元测试
- 为每个任务类型编写单元测试
- 测试API调用、状态转换、数据处理等核心逻辑

### 8.2 集成测试
- 测试任务流程的完整流程
- 验证不同阶段任务的切换和数据传递

### 8.3 性能测试
- 测试大量任务同时处理的性能
- 测试API调用的响应时间

### 8.4 兼容性测试
- 测试不同浏览器的兼容性
- 测试不同设备的响应式设计

## 9. 后续工作计划

1. 完善第四、五阶段任务的配置和实现
2. 统一API接口规范和数据结构
3. 优化状态管理和错误处理
4. 增强代码类型安全和可读性
5. 编写完整的测试用例
6. 优化性能和用户体验

## 10. 联系方式

如有任何问题或建议，请联系开发团队。
