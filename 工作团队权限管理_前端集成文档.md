# 工作团队权限管理 - 前端集成文档

## 目录

- [1. 概述](#1-概述)
- [2. 数据库表结构](#2-数据库表结构)
- [3. API接口说明](#3-api接口说明)
- [4. 前端集成指南](#4-前端集成指南)
- [5. 权限控制逻辑](#5-权限控制逻辑)
- [6. 常见问题](#6-常见问题)

---

## 1. 概述

本文档描述了工作团队权限管理功能的前端集成方案，包括新增的数据库表结构、API接口说明以及前端代码修改指南。

### 功能特性

- **案件创建者**可以设置工作团队成员
- **团队成员**可以查看和编辑当前案件的所有信息
- **团队成员**可以查看和创建工作计划
- **创建者**可以设置每个成员的查看或修改权限

### 权限级别

| 权限级别 | 说明 | 能力 |
|---------|------|------|
| VIEW | 查看 | 仅能查看案件信息，不能修改 |
| EDIT | 编辑 | 可以查看和修改案件信息 |
| FULL | 完全 | 完全控制，包括删除权限 |

### 团队角色

| 角色代码 | 角色名称 | 说明 |
|---------|---------|------|
| LEADER | 团队负责人 | 负责整个工作团队的统筹管理 |
| ZHZCY | 综合组成员 | 负责综合协调和行政事务 |
| CXZCY | 程序组成员 | 负责法律程序和诉讼事务 |
| CCGLZCY | 财产管理组成员 | 负责破产财产的管理和处置 |
| ZQSHZCY | 债权审核组成员 | 负责债权申报的审核工作 |
| LDRSZCY | 劳动人事组成员 | 负责劳动人事相关事务 |
| ZZQLZCY | 主张权利组成员 | 负责主张债权人权利的工作 |

---

## 2. 数据库表结构

### 2.1 WORK_TEAM_MEMBER（工作团队成员表）

| 字段名 | 数据类型 | 说明 |
|-------|---------|------|
| ID | int | 主键，自增 |
| CASE_ID | int | 关联案件ID |
| USER_ID | int | 用户ID |
| TEAM_ROLE | nvarchar(50) | 团队角色 |
| PERMISSION_LEVEL | nvarchar(20) | 权限级别（VIEW/EDIT/FULL） |
| IS_ACTIVE | bit | 是否激活 |
| SEP_AUSER | nvarchar(50) | 创建者 |
| SEP_ADATE | datetime | 创建时间 |
| SEP_EUSER | nvarchar(50) | 修改者 |
| SEP_EDATE | datetime | 修改时间 |

### 2.2 WORK_TEAM_PERMISSION（团队成员权限明细表）

| 字段名 | 数据类型 | 说明 |
|-------|---------|------|
| ID | int | 主键，自增 |
| TEAM_MEMBER_ID | int | 关联团队成员ID |
| MODULE_TYPE | nvarchar(50) | 模块类型 |
| PERMISSION_TYPE | nvarchar(50) | 权限类型 |
| IS_ALLOWED | bit | 是否允许 |

### 2.3 WORK_TEAM_ROLE_DICT（团队角色字典表）

| 字段名 | 数据类型 | 说明 |
|-------|---------|------|
| ROLE_CODE | nvarchar(50) | 角色代码，主键 |
| ROLE_NAME | nvarchar(100) | 角色名称 |
| ROLE_DESC | nvarchar(500) | 角色描述 |
| SORT_ORDER | int | 排序 |
| STATUS | nvarchar(10) | 状态 |

---

## 3. API接口说明

### 3.1 基础信息

- **Base URL**: `/api/web`
- **认证方式**: Token认证（通过请求头传递）
- **Content-Type**: `application/json`

### 3.2 接口列表

#### 3.2.1 设置团队成员

**接口地址**: `POST /workteam/setTeamMembers`

**请求参数**:

```json
{
  "caseId": 123,
  "members": [
    {
      "userId": 456,
      "teamRole": "LEADER",
      "permissionLevel": "FULL"
    },
    {
      "userId": 789,
      "teamRole": "CXZCY",
      "permissionLevel": "EDIT"
    }
  ]
}
```

**请求参数说明**:

| 参数名 | 类型 | 必填 | 说明 |
|-------|------|------|------|
| caseId | Integer | 是 | 案件ID |
| members | Array | 是 | 团队成员列表 |
| userId | Integer | 是 | 用户ID |
| teamRole | String | 是 | 团队角色代码 |
| permissionLevel | String | 是 | 权限级别（VIEW/EDIT/FULL） |

**响应示例**:

```json
{
  "code": 200,
  "message": "团队成员设置成功",
  "data": null
}
```

**权限要求**: 仅案件创建者可调用

---

#### 3.2.2 获取团队成员列表

**接口地址**: `GET /workteam/getTeamMembers`

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|-------|------|------|------|
| caseId | Integer | 是 | 案件ID |

**响应示例**:

```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "caseId": 123,
      "userId": 456,
      "userName": "张三",
      "userCode": "zhangsan",
      "teamRole": "LEADER",
      "teamRoleName": "团队负责人",
      "permissionLevel": "FULL",
      "isActive": true
    },
    {
      "id": 2,
      "caseId": 123,
      "userId": 789,
      "userName": "李四",
      "userCode": "lisi",
      "teamRole": "CXZCY",
      "teamRoleName": "程序组成员",
      "permissionLevel": "EDIT",
      "isActive": true
    }
  ]
}
```

---

#### 3.2.3 添加团队成员

**接口地址**: `POST /workteam/addTeamMember`

**请求参数**:

```json
{
  "caseId": 123,
  "userId": 456,
  "teamRole": "ZHZCY",
  "permissionLevel": "VIEW"
}
```

**响应示例**:

```json
{
  "code": 200,
  "message": "添加团队成员成功",
  "data": null
}
```

**权限要求**: 仅案件创建者可调用

---

#### 3.2.4 更新团队成员

**接口地址**: `POST /workteam/updateTeamMember`

**请求参数**:

```json
{
  "id": 1,
  "caseId": 123,
  "userId": 456,
  "teamRole": "LEADER",
  "permissionLevel": "EDIT"
}
```

**响应示例**:

```json
{
  "code": 200,
  "message": "更新团队成员成功",
  "data": null
}
```

**权限要求**: 仅案件创建者可调用

---

#### 3.2.5 移除团队成员

**接口地址**: `POST /workteam/removeTeamMember`

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|-------|------|------|------|
| memberId | Integer | 是 | 团队成员ID |

**响应示例**:

```json
{
  "code": 200,
  "message": "移除团队成员成功",
  "data": null
}
```

**权限要求**: 仅案件创建者可调用

---

#### 3.2.6 获取可访问的案件列表

**接口地址**: `GET /workteam/getMyAccessibleCases`

**说明**: 获取当前用户有权限访问的所有案件（包括自己创建的案件和团队案件）

**响应示例**:

```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "sepId": 123,
      "ah": "（2025）破产字第001号",
      "ajmc": "XX公司破产清算案",
      "creatorId": 456,
      "slfy": "XX市中级人民法院"
    },
    {
      "sepId": 124,
      "ah": "（2025）破产字第002号",
      "ajmc": "YY公司破产重整案",
      "creatorId": 789,
      "slfy": "XX市中级人民法院"
    }
  ]
}
```

---

#### 3.2.7 获取团队角色列表

**接口地址**: `GET /workteam/getAllTeamRoles` 或 `GET /workteam/getActiveTeamRoles`

**响应示例**:

```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "roleCode": "LEADER",
      "roleName": "团队负责人",
      "roleDesc": "负责整个工作团队的统筹管理",
      "sortOrder": 1,
      "status": "1"
    },
    {
      "roleCode": "ZHZCY",
      "roleName": "综合组成员",
      "roleDesc": "负责综合协调和行政事务",
      "sortOrder": 2,
      "status": "1"
    }
  ]
}
```

---

#### 3.2.8 保存成员权限（细粒度）

**接口地址**: `POST /workteam/saveMemberPermissions`

**请求参数**:

```json
{
  "memberId": 1,
  "permissions": [
    {
      "moduleType": "CASE",
      "permissionType": "VIEW",
      "isAllowed": true
    },
    {
      "moduleType": "CASE",
      "permissionType": "EDIT",
      "isAllowed": true
    },
    {
      "moduleType": "PLAN",
      "permissionType": "CREATE",
      "isAllowed": true
    }
  ]
}
```

**模块类型说明**:

| 模块类型 | 说明 |
|---------|------|
| CASE | 案件模块 |
| PLAN | 计划模块 |
| DEBTOR | 债务人模块 |
| CREDITOR | 债权人模块 |
| DOCUMENT | 文档模块 |

**响应示例**:

```json
{
  "code": 200,
  "message": "权限设置成功",
  "data": null
}
```

---

#### 3.2.9 获取成员权限

**接口地址**: `GET /workteam/getMemberPermissions`

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|-------|------|------|------|
| memberId | Integer | 是 | 团队成员ID |

**响应示例**:

```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "teamMemberId": 1,
      "moduleType": "CASE",
      "permissionType": "VIEW",
      "isAllowed": true
    }
  ]
}
```

---

#### 3.2.10 检查案件访问权限

**接口地址**: `GET /workteam/canAccessCase`

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|-------|------|------|------|
| caseId | Integer | 是 | 案件ID |
| permission | String | 否 | 权限类型（VIEW/EDIT/DELETE），默认VIEW |

**响应示例**:

```json
{
  "code": 200,
  "message": "success",
  "data": true
}
```

---

#### 3.2.11 修改案件查询接口

**接口地址**: `GET /api/web/selectAllCase`

**说明**: 已修改为返回当前用户有权限访问的所有案件

**响应示例**:

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "count": 100,
    "pages": 10,
    "records": [...]
  }
}
```

---

#### 3.2.12 查询我的案件

**接口地址**: `GET /api/web/selectMyCases`

**说明**: 仅返回当前用户创建的案件

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|-------|------|------|------|
| page | Integer | 否 | 页码，默认1 |
| size | Integer | 否 | 每页条数，默认10 |

---

#### 3.2.13 查询团队案件

**接口地址**: `GET /api/web/selectTeamCases`

**说明**: 仅返回当前用户作为团队成员的案件（不包含自己创建的）

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|-------|------|------|------|
| page | Integer | 否 | 页码，默认1 |
| size | Integer | 否 | 每页条数，默认10 |

---

#### 3.2.14 检查案件权限

**接口地址**: `GET /api/web/checkCasePermission`

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|-------|------|------|------|
| caseId | Integer | 是 | 案件ID |
| permission | String | 否 | 权限类型，默认VIEW |

**响应示例**:

```json
{
  "code": 200,
  "message": "success",
  "data": true
}
```

---

#### 3.2.15 获取我的团队成员信息

**接口地址**: `GET /api/web/getMyTeamMemberInfo`

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|-------|------|------|------|
| caseId | Integer | 是 | 案件ID |

**响应示例**:

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "caseId": 123,
    "userId": 456,
    "teamRole": "CXZCY",
    "teamRoleName": "程序组成员",
    "permissionLevel": "EDIT",
    "isActive": true
  }
}
```

---

## 4. 前端集成指南

### 4.1 新增API模块

建议在API模块中新增workTeam.js文件：

```javascript
// src/api/workTeam.js

import request from '@/utils/request'

const api = {
  setTeamMembers: '/api/web/workteam/setTeamMembers',
  getTeamMembers: '/api/web/workteam/getTeamMembers',
  getActiveTeamMembers: '/api/web/workteam/getActiveTeamMembers',
  addTeamMember: '/api/web/workteam/addTeamMember',
  updateTeamMember: '/api/web/workteam/updateTeamMember',
  removeTeamMember: '/api/web/workteam/removeTeamMember',
  getMyAccessibleCases: '/api/web/workteam/getMyAccessibleCases',
  getAllTeamRoles: '/api/web/workteam/getAllTeamRoles',
  getActiveTeamRoles: '/api/web/workteam/getActiveTeamRoles',
  saveMemberPermissions: '/api/web/workteam/saveMemberPermissions',
  getMemberPermissions: '/api/web/workteam/getMemberPermissions',
  canAccessCase: '/api/web/workteam/canAccessCase',
  getTeamMemberByCaseAndUser: '/api/web/workteam/getTeamMemberByCaseAndUser'
}

export function setTeamMembers(data) {
  return request({
    url: api.setTeamMembers,
    method: 'post',
    data
  })
}

export function getTeamMembers(caseId) {
  return request({
    url: api.getTeamMembers,
    method: 'get',
    params: { caseId }
  })
}

export function getActiveTeamMembers(caseId) {
  return request({
    url: api.getActiveTeamMembers,
    method: 'get',
    params: { caseId }
  })
}

export function addTeamMember(data) {
  return request({
    url: api.addTeamMember,
    method: 'post',
    data
  })
}

export function updateTeamMember(data) {
  return request({
    url: api.updateTeamMember,
    method: 'post',
    data
  })
}

export function removeTeamMember(memberId) {
  return request({
    url: api.removeTeamMember,
    method: 'post',
    params: { memberId }
  })
}

export function getMyAccessibleCases() {
  return request({
    url: api.getMyAccessibleCases,
    method: 'get'
  })
}

export function getAllTeamRoles() {
  return request({
    url: api.getAllTeamRoles,
    method: 'get'
  })
}

export function getActiveTeamRoles() {
  return request({
    url: api.getActiveTeamRoles,
    method: 'get'
  })
}

export function saveMemberPermissions(data) {
  return request({
    url: api.saveMemberPermissions,
    method: 'post',
    data
  })
}

export function getMemberPermissions(memberId) {
  return request({
    url: api.getMemberPermissions,
    method: 'get',
    params: { memberId }
  })
}

export function canAccessCase(caseId, permission = 'VIEW') {
  return request({
    url: api.canAccessCase,
    method: 'get',
    params: { caseId, permission }
  })
}

export function getTeamMemberByCaseAndUser(caseId, userId) {
  return request({
    url: api.getTeamMemberByCaseAndUser,
    method: 'get',
    params: { caseId, userId }
  })
}
```

### 4.2 案件列表页面修改

修改案件列表页面，区分我的案件和团队案件：

```vue
<template>
  <div class="case-list">
    <el-tabs v-model="activeTab" @tab-change="handleTabChange">
      <el-tab-pane label="我的案件" name="myCases">
        <case-table :cases="myCases" @view="handleViewCase" @edit="handleEditCase" />
      </el-tab-pane>
      <el-tab-pane label="团队案件" name="teamCases">
        <case-table :cases="teamCases" @view="handleViewCase" @edit="handleEditCase" />
      </el-tab-pane>
      <el-tab-pane label="全部案件" name="allCases">
        <case-table :cases="allCases" @view="handleViewCase" @edit="handleEditCase" />
      </el-tab-pane>
    </el-tabs>
  </div>
</template>

<script>
import { getMyCases, getTeamCases, getAllCases } from '@/api/case'
import { getMyAccessibleCases } from '@/api/workTeam'

export default {
  data() {
    return {
      activeTab: 'myCases',
      myCases: [],
      teamCases: [],
      allCases: []
    }
  },
  created() {
    this.loadCases()
  },
  methods: {
    async loadCases() {
      const userId = this.$store.getters.userId
      
      // 获取可访问的案件
      const accessibleCases = await getMyAccessibleCases()
      
      // 区分我的案件和团队案件
      this.myCases = accessibleCases.filter(c => c.creatorId === userId)
      this.teamCases = accessibleCases.filter(c => c.creatorId !== userId)
      
      // 加载全部案件（需要权限）
      const allResult = await getAllCases()
      this.allCases = allResult.data.records
    },
    handleTabChange(tab) {
      // 切换tab时加载对应数据
    },
    handleViewCase(caseId) {
      this.$router.push(`/case/detail/${caseId}`)
    },
    handleEditCase(caseId) {
      this.$router.push(`/case/edit/${caseId}`)
    }
  }
}
</script>
```

### 4.3 团队管理组件

创建团队管理组件TeamMemberManage.vue：

```vue
<template>
  <div class="team-manage">
    <el-button type="primary" @click="handleAddMember" v-if="isCreator">
      添加成员
    </el-button>
    
    <el-table :data="teamMembers" style="width: 100%; margin-top: 20px;">
      <el-table-column prop="userName" label="成员姓名" />
      <el-table-column prop="teamRoleName" label="团队角色" />
      <el-table-column prop="permissionLevel" label="权限级别">
        <template #default="{ row }">
          <el-tag :type="getPermissionTagType(row.permissionLevel)">
            {{ getPermissionLabel(row.permissionLevel) }}
          </el-tag>
        </template>
      </el-table-column>
      <el-table-column prop="isActive" label="状态">
        <template #default="{ row }">
          <el-tag :type="row.isActive ? 'success' : 'danger'">
            {{ row.isActive ? '激活' : '禁用' }}
          </el-tag>
        </template>
      </el-table-column>
      <el-table-column label="操作" v-if="isCreator">
        <template #default="{ row }">
          <el-button size="small" @click="handleEditMember(row)">编辑</el-button>
          <el-button size="small" type="danger" @click="handleRemoveMember(row)">
            移除
          </el-button>
        </template>
      </el-table-column>
    </el-table>
    
    <!-- 添加/编辑成员对话框 -->
    <el-dialog :title="dialogTitle" v-model="dialogVisible">
      <el-form :model="memberForm" label-width="80px">
        <el-form-item label="成员">
          <el-select v-model="memberForm.userId" filterable placeholder="选择成员">
            <el-option
              v-for="user in availableUsers"
              :key="user.uPid"
              :label="user.uName"
              :value="user.uPid"
            />
          </el-select>
        </el-form-item>
        <el-form-item label="团队角色">
          <el-select v-model="memberForm.teamRole" placeholder="选择角色">
            <el-option
              v-for="role in teamRoles"
              :key="role.roleCode"
              :label="role.roleName"
              :value="role.roleCode"
            />
          </el-select>
        </el-form-item>
        <el-form-item label="权限级别">
          <el-select v-model="memberForm.permissionLevel" placeholder="选择权限">
            <el-option label="查看" value="VIEW" />
            <el-option label="编辑" value="EDIT" />
            <el-option label="完全控制" value="FULL" />
          </el-select>
        </el-form-item>
      </el-form>
      <template #footer>
        <el-button @click="dialogVisible = false">取消</el-button>
        <el-button type="primary" @click="handleSaveMember">确定</el-button>
      </template>
    </el-dialog>
  </div>
</template>

<script>
import { getTeamMembers, addTeamMember, updateTeamMember, removeTeamMember, getActiveTeamRoles } from '@/api/workTeam'
import { getAllUsers } from '@/api/user'

export default {
  props: {
    caseId: {
      type: Number,
      required: true
    },
    isCreator: {
      type: Boolean,
      default: false
    }
  },
  data() {
    return {
      teamMembers: [],
      teamRoles: [],
      availableUsers: [],
      dialogVisible: false,
      dialogTitle: '添加成员',
      memberForm: {
        id: null,
        userId: null,
        teamRole: '',
        permissionLevel: 'VIEW'
      }
    }
  },
  created() {
    this.loadTeamMembers()
    this.loadTeamRoles()
    this.loadAvailableUsers()
  },
  methods: {
    async loadTeamMembers() {
      const result = await getTeamMembers(this.caseId)
      this.teamMembers = result.data || []
    },
    async loadTeamRoles() {
      const result = await getActiveTeamRoles()
      this.teamRoles = result.data || []
    },
    async loadAvailableUsers() {
      const result = await getAllUsers()
      this.availableUsers = result.data || []
    },
    getPermissionTagType(level) {
      const types = {
        VIEW: 'info',
        EDIT: 'warning',
        FULL: 'danger'
      }
      return types[level] || 'info'
    },
    getPermissionLabel(level) {
      const labels = {
        VIEW: '查看',
        EDIT: '编辑',
        FULL: '完全控制'
      }
      return labels[level] || level
    },
    handleAddMember() {
      this.dialogTitle = '添加成员'
      this.memberForm = {
        id: null,
        userId: null,
        teamRole: '',
        permissionLevel: 'VIEW'
      }
      this.dialogVisible = true
    },
    handleEditMember(row) {
      this.dialogTitle = '编辑成员'
      this.memberForm = {
        id: row.id,
        userId: row.userId,
        teamRole: row.teamRole,
        permissionLevel: row.permissionLevel
      }
      this.dialogVisible = true
    },
    async handleSaveMember() {
      try {
        const data = {
          caseId: this.caseId,
          ...this.memberForm
        }
        
        if (this.memberForm.id) {
          await updateTeamMember(data)
        } else {
          await addTeamMember(data)
        }
        
        this.dialogVisible = false
        this.loadTeamMembers()
        this.$message.success('保存成功')
      } catch (error) {
        this.$message.error('保存失败')
      }
    },
    async handleRemoveMember(row) {
      try {
        await this.$confirm('确定要移除该成员吗？', '提示')
        await removeTeamMember(row.id)
        this.loadTeamMembers()
        this.$message.success('移除成功')
      } catch (error) {
        // 用户取消
      }
    }
  }
}
</script>
```

### 4.4 案件详情页面权限控制

在案件详情页面，根据权限控制操作按钮的显示：

```vue
<template>
  <div class="case-detail">
    <div class="actions">
      <el-button 
        v-if="canEdit" 
        type="primary" 
        @click="handleEdit"
      >
        编辑
      </el-button>
      <el-button 
        v-if="canDelete" 
        type="danger" 
        @click="handleDelete"
      >
        删除
      </el-button>
    </div>
    
    <team-manage 
      :caseId="caseId" 
      :isCreator="isCreator"
    />
  </div>
</template>

<script>
import { canAccessCase } from '@/api/workTeam'
import TeamManage from './TeamManage.vue'

export default {
  components: { TeamManage },
  props: {
    caseId: {
      type: Number,
      required: true
    }
  },
  data() {
    return {
      canEdit: false,
      canDelete: false,
      isCreator: false
    }
  },
  created() {
    this.checkPermissions()
  },
  methods: {
    async checkPermissions() {
      const userId = this.$store.getters.userId
      
      // 检查编辑权限
      const editResult = await canAccessCase(this.caseId, 'EDIT')
      this.canEdit = editResult.data
      
      // 检查删除权限
      const deleteResult = await canAccessCase(this.caseId, 'DELETE')
      this.canDelete = deleteResult.data
      
      // 检查是否是创建者
      const caseInfo = await getCaseInfo(this.caseId)
      this.isCreator = caseInfo.data.creatorId === userId
    },
    handleEdit() {
      this.$router.push(`/case/edit/${this.caseId}`)
    },
    async handleDelete() {
      try {
        await this.$confirm('确定要删除该案件吗？', '提示')
        await deleteCase(this.caseId)
        this.$message.success('删除成功')
        this.$router.push('/case/list')
      } catch (error) {
        // 用户取消
      }
    }
  }
}
</script>
```

---

## 5. 权限控制逻辑

### 5.1 权限检查流程

```
用户访问案件
    ↓
检查是否是案件创建者
    ├─ 是 → 拥有完全控制权限
    └─ 否 → 继续检查
        ↓
检查是否是团队成员且处于激活状态
    ├─ 否 → 无权访问
    └─ 是 → 继续检查
        ↓
根据权限级别判断
    ├─ VIEW → 只能查看
    ├─ EDIT → 可以查看和编辑
    └─ FULL → 完全控制
```

### 5.2 前端权限控制策略

1. **列表展示**：根据权限过滤可显示的数据
2. **按钮控制**：根据权限显示/隐藏操作按钮
3. **接口防护**：后端接口已做权限校验，前端仅做UI层面的优化

### 5.3 权限缓存建议

建议在前端缓存用户的权限信息，避免频繁请求：

```javascript
// src/store/modules/permission.js

const state = {
  casePermissions: {} // { caseId: { view: true, edit: false, delete: false } }
}

const mutations = {
  SET_CASE_PERMISSION(state, { caseId, permissions }) {
    state.casePermissions[caseId] = permissions
  }
}

const actions = {
  async checkCasePermission({ commit }, { caseId, permission }) {
    const result = await canAccessCase(caseId, permission)
    const hasPermission = result.data
    
    if (!state.casePermissions[caseId]) {
      state.casePermissions[caseId] = {}
    }
    state.casePermissions[caseId][permission] = hasPermission
    
    return hasPermission
  },
  
  getCasePermission({ state }, { caseId, permission }) {
    return state.casePermissions[caseId]?.[permission]
  }
}
```

---

## 6. 常见问题

### Q1: 如何判断当前用户是否是案件创建者？

```javascript
// 方法1: 通过案件信息判断
const caseInfo = await getCaseInfo(caseId)
const isCreator = caseInfo.data.creatorId === userId

// 方法2: 调用API检查
const result = await canAccessCase(caseId, 'FULL')
// 如果有FULL权限，说明是创建者或拥有完全控制权
```

### Q2: 团队成员如何查看工作计划？

团队成员只要有VIEW及以上权限，即可查看工作计划。工作计划表WORK_PLAN已添加CASE_ID字段关联案件。

### Q3: 如何设置细粒度权限？

如果需要更细致的权限控制（如不同模块不同权限），可以使用saveMemberPermissions接口设置模块级权限：

```javascript
const permissions = [
  { moduleType: 'CASE', permissionType: 'VIEW', isAllowed: true },
  { moduleType: 'CASE', permissionType: 'EDIT', isAllowed: false },
  { moduleType: 'PLAN', permissionType: 'CREATE', isAllowed: true }
]
await saveMemberPermissions({ memberId: 1, permissions })
```

### Q4: 权限变更后是否需要重新登录？

不需要。权限变更后，下次刷新页面或重新请求时会获取最新的权限信息。

### Q5: 如何处理权限请求失败？

后端接口已做权限校验，如果请求被拒绝，会返回403错误码。建议在全局拦截器中处理：

```javascript
// response interceptor
service.interceptors.response.use(
  response => {
    // ...
  },
  error => {
    if (error.response.status === 403) {
      Message.error('您没有权限执行此操作')
    }
    return Promise.reject(error)
  }
)
```

---

## 附录：API快速参考

### 团队管理接口

| 接口 | 方法 | 说明 |
|------|------|------|
| /api/web/workteam/setTeamMembers | POST | 设置团队成员（批量） |
| /api/web/workteam/getTeamMembers | GET | 获取团队成员列表 |
| /api/web/workteam/getActiveTeamMembers | GET | 获取激活的团队成员 |
| /api/web/workteam/addTeamMember | POST | 添加团队成员 |
| /api/web/workteam/updateTeamMember | POST | 更新团队成员 |
| /api/web/workteam/removeTeamMember | POST | 移除团队成员 |
| /api/web/workteam/getMyAccessibleCases | GET | 获取可访问的案件 |
| /api/web/workteam/getAllTeamRoles | GET | 获取所有团队角色 |
| /api/web/workteam/getActiveTeamRoles | GET | 获取激活的团队角色 |
| /api/web/workteam/saveMemberPermissions | POST | 保存成员权限 |
| /api/web/workteam/getMemberPermissions | GET | 获取成员权限 |
| /api/web/workteam/canAccessCase | GET | 检查案件访问权限 |

### 案件相关接口变更

| 接口 | 方法 | 说明 |
|------|------|------|
| /api/web/selectAllCase | GET | 查询所有有权限的案件 |
| /api/web/selectMyCases | GET | 查询自己创建的案件 |
| /api/web/selectTeamCases | GET | 查询团队案件 |
| /api/web/checkCasePermission | GET | 检查案件权限 |
| /api/web/getMyTeamMemberInfo | GET | 获取我的团队成员信息 |

---

**文档版本**: v1.0  
**更新日期**: 2025-12-31  
**维护者**: 后端开发团队
