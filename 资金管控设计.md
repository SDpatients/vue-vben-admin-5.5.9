# 资金管控模块设计方案

## 1. 模块概述

### 1.1 背景
在破产案件管理中，资金管控是核心环节之一。需要对破产案件的资金流入、流出进行严格的记录、监控和管理，确保资金使用合规、透明，同时提供清晰的资金报表和审计轨迹。

### 1.2 目标
- 实现破产案件资金的全流程管理
- 记录资金的流入、流出明细
- 提供资金分类统计和报表
- 支持资金操作的审计追踪
- 确保资金数据的安全性和准确性

### 1.3 范围
本模块主要包含以下功能：
- 资金账户管理
- 资金流入记录
- 资金流出记录
- 资金流水查询
- 资金统计报表
- 操作日志审计

## 2. 数据库设计

### 2.1 数据库表结构

#### 2.1.1 资金账户表 (`fund_account`)

| 字段名 | 数据类型 | 长度 | 主键 | 允许空 | 描述 |
|--------|----------|------|------|--------|------|
| `account_id` | `BIGINT` | 20 | ✅ | ❌ | 账户ID |
| `case_no` | `VARCHAR` | 50 | ❌ | ❌ | 关联案件案号 |
| `case_name` | `VARCHAR` | 200 | ❌ | ❌ | 关联案件名称 |
| `account_name` | `VARCHAR` | 100 | ❌ | ❌ | 账户名称 |
| `account_type` | `VARCHAR` | 50 | ❌ | ❌ | 账户类型（基本账户、专用账户等） |
| `initial_balance` | `DECIMAL` | 18,2 | ❌ | ❌ | 初始余额 |
| `current_balance` | `DECIMAL` | 18,2 | ❌ | ❌ | 当前余额 |
| `bank_name` | `VARCHAR` | 100 | ❌ | ✅ | 银行 |
| `bank_account` | `VARCHAR` | 50 | ❌ | ✅ | 银行账号 |
| `status` | `VARCHAR` | 20 | ❌ | ❌ | 状态（正常、冻结） |
| `create_time` | `DATETIME` | - | ❌ | ❌ | 创建时间 |
| `create_user` | `VARCHAR` | 50 | ❌ | ❌ | 创建人 |
| `update_time` | `DATETIME` | - | ❌ | ✅ | 更新时间 |
| `update_user` | `VARCHAR` | 50 | ❌ | ✅ | 更新人 |

#### 2.1.2 资金分类表 (`fund_category`)

| 字段名 | 数据类型 | 长度 | 主键 | 允许空 | 描述 |
|--------|----------|------|------|--------|------|
| `category_id` | `BIGINT` | 20 | ✅ | ❌ | 分类ID |
| `category_name` | `VARCHAR` | 100 | ❌ | ❌ | 分类名称 |
| `category_type` | `VARCHAR` | 20 | ❌ | ❌ | 分类类型（收入、支出） |
| `parent_id` | `BIGINT` | 20 | ❌ | ✅ | 父分类ID |
| `sort_order` | `INT` | 10 | ❌ | ❌ | 排序顺序 |
| `status` | `VARCHAR` | 20 | ❌ | ❌ | 状态（启用、禁用） |
| `create_time` | `DATETIME` | - | ❌ | ❌ | 创建时间 |
| `create_user` | `VARCHAR` | 50 | ❌ | ❌ | 创建人 |

#### 2.1.3 资金流水表 (`fund_flow`)

| 字段名 | 数据类型 | 长度 | 主键 | 允许空 | 描述 |
|--------|----------|------|------|--------|------|
| `flow_id` | `BIGINT` | 20 | ✅ | ❌ | 流水ID |
| `case_no` | `VARCHAR` | 50 | ❌ | ❌ | 关联案件案号 |
| `case_name` | `VARCHAR` | 200 | ❌ | ❌ | 关联案件名称 |
| `account_id` | `BIGINT` | 20 | ❌ | ❌ | 关联账户ID |
| `flow_type` | `VARCHAR` | 20 | ❌ | ❌ | 流水类型（收入、支出） |
| `category_id` | `BIGINT` | 20 | ❌ | ❌ | 资金分类ID |
| `amount` | `DECIMAL` | 18,2 | ❌ | ❌ | 金额 |
| `balance_before` | `DECIMAL` | 18,2 | ❌ | ❌ | 操作前余额 |
| `balance_after` | `DECIMAL` | 18,2 | ❌ | ❌ | 操作后余额 |
| `transaction_date` | `DATETIME` | - | ❌ | ❌ | 交易日期 |
| `description` | `VARCHAR` | 500 | ❌ | ✅ | 交易描述 |
| `related_document` | `VARCHAR` | 200 | ❌ | ✅ | 关联文档（路径或ID） |
| `operator` | `VARCHAR` | 50 | ❌ | ❌ | 操作人 |
| `operation_time` | `DATETIME` | - | ❌ | ❌ | 操作时间 |
| `remark` | `VARCHAR` | 500 | ❌ | ✅ | 备注 |

#### 2.1.4 资金审批表 (`fund_approval`)

| 字段名 | 数据类型 | 长度 | 主键 | 允许空 | 描述 |
|--------|----------|------|------|--------|------|
| `approval_id` | `BIGINT` | 20 | ✅ | ❌ | 审批ID |
| `flow_id` | `BIGINT` | 20 | ❌ | ❌ | 关联流水ID |
| `case_no` | `VARCHAR` | 50 | ❌ | ❌ | 关联案件案号 |
| `amount` | `DECIMAL` | 18,2 | ❌ | ❌ | 审批金额 |
| `approval_status` | `VARCHAR` | 20 | ❌ | ❌ | 审批状态（待审批、已通过、已拒绝） |
| `approval_content` | `VARCHAR` | 500 | ❌ | ✅ | 审批内容 |
| `approver` | `VARCHAR` | 50 | ❌ | ✅ | 审批人 |
| `approval_time` | `DATETIME` | - | ❌ | ✅ | 审批时间 |
| `create_time` | `DATETIME` | - | ❌ | ❌ | 创建时间 |

#### 2.1.5 操作日志表 (`fund_operation_log`)

| 字段名 | 数据类型 | 长度 | 主键 | 允许空 | 描述 |
|--------|----------|------|------|--------|------|
| `log_id` | `BIGINT` | 20 | ✅ | ❌ | 日志ID |
| `case_no` | `VARCHAR` | 50 | ❌ | ✅ | 关联案件案号 |
| `operation_type` | `VARCHAR` | 50 | ❌ | ❌ | 操作类型 |
| `operation_content` | `VARCHAR` | 1000 | ❌ | ❌ | 操作内容 |
| `operator` | `VARCHAR` | 50 | ❌ | ❌ | 操作人 |
| `operation_time` | `DATETIME` | - | ❌ | ❌ | 操作时间 |
| `ip_address` | `VARCHAR` | 50 | ❌ | ✅ | IP地址 |
| `browser_info` | `VARCHAR` | 200 | ❌ | ✅ | 浏览器信息 |

### 2.2 数据库索引设计

| 表名 | 索引字段 | 索引类型 | 描述 |
|------|----------|----------|------|
| `fund_account` | `case_no` | 普通索引 | 加速按案件查询账户 |
| `fund_account` | `account_id` | 主键索引 | 主键，唯一标识账户 |
| `fund_flow` | `case_no` | 普通索引 | 加速按案件查询流水 |
| `fund_flow` | `account_id` | 普通索引 | 加速按账户查询流水 |
| `fund_flow` | `transaction_date` | 普通索引 | 加速按日期查询流水 |
| `fund_flow` | `flow_type` | 普通索引 | 加速按类型查询流水 |
| `fund_category` | `category_type` | 普通索引 | 加速按类型查询分类 |
| `fund_approval` | `flow_id` | 普通索引 | 加速关联流水查询审批 |
| `fund_approval` | `approval_status` | 普通索引 | 加速按状态查询审批 |
| `fund_operation_log` | `case_no` | 普通索引 | 加速按案件查询日志 |
| `fund_operation_log` | `operation_time` | 普通索引 | 加速按时间查询日志 |

## 3. 功能设计

### 3.1 功能模块划分

| 模块 | 主要功能 |
|------|----------|
| 账户管理 | 账户的新增、编辑、查询、冻结/解冻 |
| 资金流入 | 记录资金流入明细 |
| 资金流出 | 记录资金流出明细 |
| 资金流水 | 资金流水的查询、导出 |
| 统计报表 | 资金统计、收支分析、余额报表 |
| 审批管理 | 资金操作的审批流程 |
| 操作日志 | 操作日志的查询、导出 |

### 3.2 核心功能详细设计

#### 3.2.1 账户管理

**功能描述**：管理破产案件的资金账户，包括基本账户、专用账户等。

**操作流程**：
1. 新增账户：填写账户信息 → 保存 → 生成初始账户记录
2. 编辑账户：选择账户 → 修改信息 → 保存 → 更新账户记录
3. 冻结账户：选择账户 → 点击冻结 → 确认 → 更新账户状态
4. 查询账户：输入查询条件 → 执行查询 → 显示账户列表

**数据流转**：
- 新增/编辑账户时，记录操作日志
- 冻结/解冻账户时，更新账户状态并记录操作日志

#### 3.2.2 资金流入

**功能描述**：记录破产案件的资金流入情况，包括来源、金额、时间等。

**操作流程**：
1. 进入资金流入页面 → 填写流入信息（案件ID、账户、金额、分类、日期、描述等）
2. 上传关联文档（可选）
3. 提交 → 系统验证 → 保存流水记录 → 更新账户余额
4. 记录操作日志

**数据流转**：
- 保存资金流水记录
- 更新账户当前余额
- 记录操作日志
- （可选）触发审批流程

#### 3.2.3 资金流出

**功能描述**：记录破产案件的资金流出情况，包括用途、金额、时间等。

**操作流程**：
1. 进入资金流出页面 → 填写流出信息（案件ID、账户、金额、分类、日期、描述等）
2. 上传关联文档（可选）
3. 提交 → 系统验证（余额是否充足） → 保存流水记录 → 更新账户余额
4. 记录操作日志

**数据流转**：
- 验证账户余额是否充足
- 保存资金流水记录
- 更新账户当前余额
- 记录操作日志
- （可选）触发审批流程

#### 3.2.4 资金流水查询

**功能描述**：查询和导出资金流水明细。

**查询条件**：
- 案号
- 账户
- 流水类型（收入/支出）
- 资金分类
- 时间范围
- 金额范围

**导出功能**：
- 支持Excel格式导出
- 可选择导出字段
- 支持按查询条件导出

#### 3.2.5 统计报表

**功能描述**：提供资金统计和分析报表。

**报表类型**：
1. 账户余额报表：显示各账户的当前余额
2. 收支明细报表：按时间段显示资金收支明细
3. 收支汇总报表：按分类汇总资金收支情况
4. 月度收支报表：按月份统计资金收支
5. 资金趋势报表：显示资金余额变化趋势

**图表展示**：
- 饼图：显示资金分类占比
- 柱状图：显示月度收支对比
- 折线图：显示资金余额趋势

#### 3.2.6 审批管理

**功能描述**：实现资金操作的审批流程。

**审批流程**：
1. 资金操作提交 → 系统生成审批请求
2. 审批人收到审批通知 → 查看详情
3. 审批人审批（通过/拒绝） → 系统更新审批状态
4. 审批结果通知申请人

**审批规则**：
- 可配置审批流程（单级/多级）
- 可配置审批金额阈值
- 可配置审批人

#### 3.2.7 操作日志

**功能描述**：记录所有资金操作的日志，用于审计和追溯。

**日志内容**：
- 操作人
- 操作时间
- 操作类型
- 操作内容
- IP地址
- 浏览器信息

**查询功能**：
- 按案号查询
- 按操作人查询
- 按操作时间查询
- 按操作类型查询

**导出功能**：支持Excel格式导出操作日志。

## 4. 技术实现方案

### 4.1 技术栈

#### 4.1.1 后端技术栈
- 框架：Spring Boot
- 数据库：MySQL
- ORM：MyBatis Plus
- 缓存：Redis（可选，用于缓存统计数据）
- 安全框架：Spring Security
- 日志框架：SLF4J + Logback

#### 4.1.2 前端技术栈
- 框架：Vue 3 + TypeScript
- UI组件库：Element Plus
- 状态管理：Pinia
- 路由：Vue Router
- 图表库：ECharts
- HTTP客户端：Axios

### 4.2 接口设计

#### 4.2.1 账户管理接口

| 接口名称 | 请求方法 | 请求路径 | 功能描述 |
|----------|----------|----------|----------|
| 新增账户 | POST | `/api/fund/account` | 新增资金账户 |
| 查询账户列表 | GET | `/api/fund/account/list` | 查询资金账户列表 |
| 查询账户详情 | GET | `/api/fund/account/{accountId}` | 查询账户详情 |
| 更新账户 | PUT | `/api/fund/account/{accountId}` | 更新账户信息 |
| 冻结账户 | PUT | `/api/fund/account/{accountId}/freeze` | 冻结账户 |
| 解冻账户 | PUT | `/api/fund/account/{accountId}/unfreeze` | 解冻账户 |

#### 4.2.2 资金流水接口

| 接口名称 | 请求方法 | 请求路径 | 功能描述 |
|----------|----------|----------|----------|
| 资金流入 | POST | `/api/fund/flow/in` | 记录资金流入 |
| 资金流出 | POST | `/api/fund/flow/out` | 记录资金流出 |
| 查询流水列表 | GET | `/api/fund/flow/list` | 查询资金流水列表 |
| 查询流水详情 | GET | `/api/fund/flow/{flowId}` | 查询流水详情 |
| 导出流水 | GET | `/api/fund/flow/export` | 导出资金流水 |

#### 4.2.3 资金分类接口

| 接口名称 | 请求方法 | 请求路径 | 功能描述 |
|----------|----------|----------|----------|
| 新增分类 | POST | `/api/fund/category` | 新增资金分类 |
| 查询分类列表 | GET | `/api/fund/category/list` | 查询资金分类列表 |
| 更新分类 | PUT | `/api/fund/category/{categoryId}` | 更新资金分类 |
| 删除分类 | DELETE | `/api/fund/category/{categoryId}` | 删除资金分类 |

#### 4.2.4 统计报表接口

| 接口名称 | 请求方法 | 请求路径 | 功能描述 |
|----------|----------|----------|----------|
| 获取账户余额报表 | GET | `/api/fund/report/balance` | 获取账户余额报表 |
| 获取收支明细报表 | GET | `/api/fund/report/details` | 获取收支明细报表 |
| 获取收支汇总报表 | GET | `/api/fund/report/summary` | 获取收支汇总报表 |
| 获取月度收支报表 | GET | `/api/fund/report/monthly` | 获取月度收支报表 |
| 获取资金趋势报表 | GET | `/api/fund/report/trend` | 获取资金趋势报表 |

#### 4.2.5 审批管理接口

| 接口名称 | 请求方法 | 请求路径 | 功能描述 |
|----------|----------|----------|----------|
| 获取审批列表 | GET | `/api/fund/approval/list` | 获取审批列表 |
| 审批资金操作 | PUT | `/api/fund/approval/{approvalId}` | 审批资金操作 |

#### 4.2.6 操作日志接口

| 接口名称 | 请求方法 | 请求路径 | 功能描述 |
|----------|----------|----------|----------|
| 查询操作日志 | GET | `/api/fund/log/list` | 查询操作日志 |
| 导出操作日志 | GET | `/api/fund/log/export` | 导出操作日志 |

### 4.3 前端页面设计

#### 4.3.1 页面结构

| 页面名称 | 主要功能 | 路径 |
|----------|----------|------|
| 账户管理 | 账户的增删改查 | `/fund/account` |
| 资金流入 | 记录资金流入 | `/fund/flow/in` |
| 资金流出 | 记录资金流出 | `/fund/flow/out` |
| 资金流水 | 查询资金流水 | `/fund/flow/list` |
| 统计报表 | 查看资金报表 | `/fund/report` |
| 审批管理 | 处理审批请求 | `/fund/approval` |
| 操作日志 | 查询操作日志 | `/fund/log` |

#### 4.3.2 页面设计原则

1. **简洁明了**：界面简洁，操作流程清晰
2. **响应式设计**：适配不同屏幕尺寸
3. **直观易用**：提供直观的数据展示和操作界面
4. **数据可视化**：使用图表直观展示资金数据
5. **操作反馈**：提供明确的操作反馈和错误提示

### 4.4 安全设计

1. **权限控制**：
   - 基于角色的权限控制
   - 细粒度的功能权限管理
   - 数据级别的权限控制（按案件）

2. **数据安全**：
   - 敏感数据加密存储
   - 数据传输加密
   - 定期数据备份

3. **操作安全**：
   - 操作日志完整记录
   - 关键操作二次确认
   - 异常操作监控和告警

## 5. 系统集成

### 5.1 与案件管理系统集成

- 通过案件ID关联案件信息
- 从案件管理系统获取案件基本信息
- 向案件管理系统推送资金相关信息

### 5.2 与文档管理系统集成

- 关联资金操作相关的文档
- 支持从文档管理系统上传和查看关联文档

### 5.3 与消息通知系统集成

- 资金操作审批通知
- 资金余额预警通知
- 重要操作提醒

## 6. 实施计划

### 6.1 阶段划分

| 阶段 | 主要工作 | 时间 |
|------|----------|------|
| 需求分析 | 详细需求调研和分析 | 1周 |
| 设计阶段 | 数据库设计、接口设计、前端设计 | 1周 |
| 开发阶段 | 后端开发、前端开发 | 3周 |
| 测试阶段 | 单元测试、集成测试、系统测试 | 1周 |
| 部署上线 | 系统部署、用户培训 | 1周 |

### 6.2 关键里程碑

1. 数据库设计完成
2. 核心功能开发完成
3. 系统测试通过
4. 系统上线运行

## 7. 运维与监控

### 7.1 系统监控

- 数据库监控：监控数据库性能和状态
- 接口监控：监控接口调用情况和响应时间
- 日志监控：监控系统日志，及时发现异常

### 7.2 日常运维

- 定期数据备份
- 系统性能优化
- 安全漏洞修复
- 功能迭代更新

### 7.3 问题处理流程

1. 问题报告
2. 问题分析
3. 问题修复
4. 问题验证
5. 问题闭环

## 8. 风险评估

### 8.1 风险识别

| 风险类型 | 风险描述 | 影响程度 | 概率 |
|----------|----------|----------|------|
| 需求变更 | 需求频繁变更 | 中 | 中 |
| 数据安全 | 敏感数据泄露 | 高 | 低 |
| 系统性能 | 大数据量下性能下降 | 中 | 中 |
| 集成风险 | 与其他系统集成困难 | 中 | 中 |

### 8.2 风险应对措施

| 风险类型 | 应对措施 |
|----------|----------|
| 需求变更 | 建立需求变更管理流程，严格控制变更范围 |
| 数据安全 | 加强数据加密和访问控制，定期进行安全审计 |
| 系统性能 | 优化数据库查询，使用缓存技术，定期进行性能测试 |
| 集成风险 | 提前进行系统集成测试，建立良好的接口文档 |

## 9. 总结

本设计方案为破产案件项目提供了一个完整的资金管控模块设计，包括数据库设计、功能设计、技术实现方案等。该模块能够满足破产案件资金管理的需求，实现资金的全流程管理、记录和监控，提供清晰的统计报表和审计轨迹。

通过本模块的实施，可以提高破产案件资金管理的效率和透明度，确保资金使用合规，同时为案件管理提供准确的资金数据支持。

## 10. SQL Server 2008 创建表语句

### 10.1 创建资金账户表 (`fund_account`)
```sql
CREATE TABLE [dbo].[fund_account] (
    [account_id] [BIGINT] IDENTITY(1,1) NOT NULL,
    [case_no] [VARCHAR](50) NOT NULL,
    [case_name] [VARCHAR](200) NOT NULL,
    [account_name] [VARCHAR](100) NOT NULL,
    [account_type] [VARCHAR](50) NOT NULL,
    [initial_balance] [DECIMAL](18,2) NOT NULL,
    [current_balance] [DECIMAL](18,2) NOT NULL,
    [bank_name] [VARCHAR](100) NULL,
    [bank_account] [VARCHAR](50) NULL,
    [status] [VARCHAR](20) NOT NULL,
    [create_time] [DATETIME] NOT NULL DEFAULT (GETDATE()),
    [create_user] [VARCHAR](50) NOT NULL,
    [update_time] [DATETIME] NULL,
    [update_user] [VARCHAR](50) NULL,
    CONSTRAINT [PK_fund_account] PRIMARY KEY CLUSTERED 
    (
        [account_id] ASC
    )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO

-- 创建普通索引
CREATE NONCLUSTERED INDEX [IX_fund_account_case_no] ON [dbo].[fund_account]
(
    [case_no] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
```

### 10.2 创建资金分类表 (`fund_category`)
```sql
CREATE TABLE [dbo].[fund_category] (
    [category_id] [BIGINT] IDENTITY(1,1) NOT NULL,
    [category_name] [VARCHAR](100) NOT NULL,
    [category_type] [VARCHAR](20) NOT NULL,
    [parent_id] [BIGINT] NULL,
    [sort_order] [INT] NOT NULL,
    [status] [VARCHAR](20) NOT NULL,
    [create_time] [DATETIME] NOT NULL DEFAULT (GETDATE()),
    [create_user] [VARCHAR](50) NOT NULL,
    CONSTRAINT [PK_fund_category] PRIMARY KEY CLUSTERED 
    (
        [category_id] ASC
    )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO

-- 创建普通索引
CREATE NONCLUSTERED INDEX [IX_fund_category_type] ON [dbo].[fund_category]
(
    [category_type] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
```

### 10.3 创建资金流水表 (`fund_flow`)
```sql
CREATE TABLE [dbo].[fund_flow] (
    [flow_id] [BIGINT] IDENTITY(1,1) NOT NULL,
    [case_no] [VARCHAR](50) NOT NULL,
    [case_name] [VARCHAR](200) NOT NULL,
    [account_id] [BIGINT] NOT NULL,
    [flow_type] [VARCHAR](20) NOT NULL,
    [category_id] [BIGINT] NOT NULL,
    [amount] [DECIMAL](18,2) NOT NULL,
    [balance_before] [DECIMAL](18,2) NOT NULL,
    [balance_after] [DECIMAL](18,2) NOT NULL,
    [transaction_date] [DATETIME] NOT NULL,
    [description] [VARCHAR](500) NULL,
    [related_document] [VARCHAR](200) NULL,
    [operator] [VARCHAR](50) NOT NULL,
    [operation_time] [DATETIME] NOT NULL DEFAULT (GETDATE()),
    [remark] [VARCHAR](500) NULL,
    CONSTRAINT [PK_fund_flow] PRIMARY KEY CLUSTERED 
    (
        [flow_id] ASC
    )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO

-- 创建普通索引
CREATE NONCLUSTERED INDEX [IX_fund_flow_case_no] ON [dbo].[fund_flow]
(
    [case_no] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO

CREATE NONCLUSTERED INDEX [IX_fund_flow_account_id] ON [dbo].[fund_flow]
(
    [account_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO

CREATE NONCLUSTERED INDEX [IX_fund_flow_transaction_date] ON [dbo].[fund_flow]
(
    [transaction_date] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO

CREATE NONCLUSTERED INDEX [IX_fund_flow_type] ON [dbo].[fund_flow]
(
    [flow_type] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
```

### 10.4 创建资金审批表 (`fund_approval`)
```sql
CREATE TABLE [dbo].[fund_approval] (
    [approval_id] [BIGINT] IDENTITY(1,1) NOT NULL,
    [flow_id] [BIGINT] NOT NULL,
    [case_no] [VARCHAR](50) NOT NULL,
    [amount] [DECIMAL](18,2) NOT NULL,
    [approval_status] [VARCHAR](20) NOT NULL,
    [approval_content] [VARCHAR](500) NULL,
    [approver] [VARCHAR](50) NULL,
    [approval_time] [DATETIME] NULL,
    [create_time] [DATETIME] NOT NULL DEFAULT (GETDATE()),
    CONSTRAINT [PK_fund_approval] PRIMARY KEY CLUSTERED 
    (
        [approval_id] ASC
    )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO

-- 创建普通索引
CREATE NONCLUSTERED INDEX [IX_fund_approval_flow_id] ON [dbo].[fund_approval]
(
    [flow_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO

CREATE NONCLUSTERED INDEX [IX_fund_approval_status] ON [dbo].[fund_approval]
(
    [approval_status] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
```

### 10.5 创建操作日志表 (`fund_operation_log`)
```sql
CREATE TABLE [dbo].[fund_operation_log] (
    [log_id] [BIGINT] IDENTITY(1,1) NOT NULL,
    [case_no] [VARCHAR](50) NULL,
    [operation_type] [VARCHAR](50) NOT NULL,
    [operation_content] [VARCHAR](1000) NOT NULL,
    [operator] [VARCHAR](50) NOT NULL,
    [operation_time] [DATETIME] NOT NULL DEFAULT (GETDATE()),
    [ip_address] [VARCHAR](50) NULL,
    [browser_info] [VARCHAR](200) NULL,
    CONSTRAINT [PK_fund_operation_log] PRIMARY KEY CLUSTERED 
    (
        [log_id] ASC
    )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO

-- 创建普通索引
CREATE NONCLUSTERED INDEX [IX_fund_operation_log_case_no] ON [dbo].[fund_operation_log]
(
    [case_no] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO

CREATE NONCLUSTERED INDEX [IX_fund_operation_log_time] ON [dbo].[fund_operation_log]
(
    [operation_time] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
```

## 11. 初始数据

### 11.1 资金分类初始数据
```sql
INSERT INTO [dbo].[fund_category] ([category_name], [category_type], [parent_id], [sort_order], [status], [create_user])
VALUES 
('资产处置收入', '收入', NULL, 1, '启用', 'admin'),
('破产费用', '支出', NULL, 2, '启用', 'admin'),
('职工债权', '支出', NULL, 3, '启用', 'admin'),
('税收债权', '支出', NULL, 4, '启用', 'admin'),
('普通债权', '支出', NULL, 5, '启用', 'admin')
GO
```

### 11.2 资金账户初始数据
```sql
INSERT INTO [dbo].[fund_account] ([case_no], [case_name], [account_name], [account_type], [initial_balance], [current_balance], [bank_name], [bank_account], [status], [create_user])
VALUES 
('CASE2025001', 'XX公司破产清算案', '破产案件基本账户', '基本账户', 100000.00, 150000.00, '中国银行', '6212261234567890123', '正常', 'admin'),
('CASE2025002', 'YY企业重整案', '破产案件专用账户', '专用账户', 50000.00, 80000.00, '建设银行', '6227001234567890456', '正常', 'admin')
GO
```

### 11.3 资金流水初始数据
```sql
INSERT INTO [dbo].[fund_flow] ([case_no], [case_name], [account_id], [flow_type], [category_id], [amount], [balance_before], [balance_after], [transaction_date], [description], [operator])
VALUES 
('CASE2025001', 'XX公司破产清算案', 1, '收入', 1, 50000.00, 100000.00, 150000.00, '2025-01-10 14:30:00', '房屋拍卖收入', 'admin'),
('CASE2025001', 'XX公司破产清算案', 1, '支出', 2, 15000.00, 150000.00, 135000.00, '2025-01-15 09:45:00', '支付律师费', 'admin'),
('CASE2025002', 'YY企业重整案', 2, '收入', 1, 30000.00, 50000.00, 80000.00, '2025-01-20 16:20:00', '设备拍卖收入', 'admin')
GO
```
