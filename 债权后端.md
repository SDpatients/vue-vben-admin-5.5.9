# 债权后端实现文档

## 一、数据库表设计

### 1. 债权人信息表 (creditor_info)

```sql
CREATE TABLE creditor_info (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '债权人ID',
    case_id VARCHAR(50) NOT NULL COMMENT '案件ID',
    creditor_name VARCHAR(200) NOT NULL COMMENT '债权人名称',
    creditor_type VARCHAR(50) COMMENT '债权人类型（金融机构/企业/个人/其他）',
    contact_phone VARCHAR(20) COMMENT '联系电话',
    contact_email VARCHAR(100) COMMENT '联系邮箱',
    address VARCHAR(500) COMMENT '地址',
    id_number VARCHAR(50) COMMENT '证件号码',
    legal_representative VARCHAR(100) COMMENT '法定代表人',
    registered_capital VARCHAR(50) COMMENT '注册资本',
    status VARCHAR(20) DEFAULT 'ACTIVE' COMMENT '状态（ACTIVE/INACTIVE）',
    created_by VARCHAR(50) COMMENT '创建人',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_by VARCHAR(50) COMMENT '更新人',
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_case_id (case_id),
    INDEX idx_creditor_name (creditor_name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='债权人信息表';
```

### 2. 债权登记表 (claim_registration)

```sql
CREATE TABLE claim_registration (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '债权ID',
    case_id VARCHAR(50) NOT NULL COMMENT '案件ID',
    case_name VARCHAR(200) COMMENT '案件名称',
    debtor VARCHAR(200) COMMENT '债务人',
    polizi_account VARCHAR(100) COMMENT '破栗子账号',
    creditor_name VARCHAR(200) NOT NULL COMMENT '债权人姓名或名称',
    creditor_type VARCHAR(50) COMMENT '债权人类型',
    credit_code VARCHAR(50) COMMENT '统一社会信用代码',
    legal_representative VARCHAR(100) COMMENT '法定代表人',
    service_address VARCHAR(500) COMMENT '送达地址',
    agent_name VARCHAR(100) COMMENT '代理人姓名',
    agent_phone VARCHAR(20) COMMENT '代理人电话',
    agent_id_card VARCHAR(50) COMMENT '代理人身份证号码',
    agent_address VARCHAR(500) COMMENT '代理人联系地址',
    account_name VARCHAR(200) COMMENT '账户名称',
    bank_account VARCHAR(50) COMMENT '银行账号',
    bank_name VARCHAR(200) COMMENT '开户银行',
    principal DECIMAL(18,2) DEFAULT 0.00 COMMENT '申报本金',
    interest DECIMAL(18,2) DEFAULT 0.00 COMMENT '申报利息',
    penalty DECIMAL(18,2) DEFAULT 0.00 COMMENT '申报违约金',
    other_losses DECIMAL(18,2) DEFAULT 0.00 COMMENT '申报其他损失',
    total_amount DECIMAL(18,2) DEFAULT 0.00 COMMENT '申报总金额',
    has_court_judgment TINYINT(1) DEFAULT 0 COMMENT '是否有法院判决或仲裁裁决',
    has_execution TINYINT(1) DEFAULT 0 COMMENT '是否已申请执行',
    has_collateral TINYINT(1) DEFAULT 0 COMMENT '是否有抵押物或质押物',
    claim_nature VARCHAR(50) COMMENT '债权性质',
    claim_type VARCHAR(50) COMMENT '债权种类',
    claim_facts TEXT COMMENT '债权事实与理由描述',
    creditor_category VARCHAR(50) COMMENT '债权人类别',
    claim_nature_manager VARCHAR(50) COMMENT '债权性质(管理人自填)',
    claim_identifier VARCHAR(50) COMMENT '债权标识',
    evidence_list TEXT COMMENT '债权申报证据清单',
    evidence_materials TEXT COMMENT '证据材料',
    evidence_attachments JSON COMMENT '证据材料附件',
    remarks TEXT COMMENT '备注',
    registration_status VARCHAR(20) DEFAULT 'PENDING' COMMENT '登记状态（PENDING/APPROVED/REJECTED）',
    created_by VARCHAR(50) COMMENT '创建人',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_by VARCHAR(50) COMMENT '更新人',
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_case_id (case_id),
    INDEX idx_creditor_name (creditor_name),
    INDEX idx_registration_status (registration_status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='债权登记表';
```

## 二、后端API接口设计

### 1. 债权人信息相关接口

#### 1.1 获取案件下的债权人列表
- **接口路径**: `/api/web/getCreditorsByCase`
- **请求方式**: GET
- **请求参数**:
  - `caseId`: 案件ID
  - `page`: 页码
  - `size`: 每页大小
- **返回数据**:
```json
{
  "status": "1",
  "data": {
    "count": 100,
    "pages": 10,
    "records": [
      {
        "id": "1",
        "caseId": "AJ2023001",
        "creditorName": "某某银行股份有限公司",
        "creditorType": "金融机构",
        "contactPhone": "13800138000",
        "contactEmail": "bank@example.com",
        "address": "北京市朝阳区",
        "idNumber": "91110000123456789X",
        "legalRepresentative": "张三",
        "registeredCapital": "1000万",
        "status": "ACTIVE",
        "createdTime": "2023-01-15 10:00:00"
      }
    ]
  }
}
```

#### 1.2 批量新增债权人
- **接口路径**: `/api/web/batchAddCreditors`
- **请求方式**: POST
- **请求参数**:
```json
{
  "caseId": "AJ2023001",
  "creditorsList": [
    {
      "creditorName": "某某银行股份有限公司",
      "creditorType": "金融机构",
      "contactPhone": "13800138000",
      "contactEmail": "bank@example.com",
      "address": "北京市朝阳区",
      "idNumber": "91110000123456789X",
      "legalRepresentative": "张三",
      "registeredCapital": "1000万"
    }
  ]
}
```
- **返回数据**:
```json
{
  "status": "1",
  "data": {
    "successCount": 10,
    "failedCount": 0
  }
}
```

### 2. 债权登记表相关接口

#### 2.1 获取案件下的债权登记列表
- **接口路径**: `/api/web/getClaims`
- **请求方式**: GET
- **请求参数**:
  - `caseId`: 案件ID
  - `page`: 页码
  - `size`: 每页大小
  - `creditorName`: 债权人名称（可选）
  - `registrationStatus`: 登记状态（可选）
- **返回数据**:
```json
{
  "status": "1",
  "data": {
    "count": 50,
    "pages": 5,
    "records": [
      {
        "id": "1",
        "caseId": "AJ2023001",
        "caseName": "浙江杭良锅炉制造有限公司破产清算案",
        "debtor": "浙江杭良锅炉制造有限公司",
        "poliziAccount": "polizi123",
        "creditorName": "某某银行股份有限公司",
        "creditorType": "金融机构",
        "creditCode": "91110000123456789X",
        "legalRepresentative": "张三",
        "serviceAddress": "北京市朝阳区",
        "agentName": "李四",
        "agentPhone": "13900139000",
        "agentIdCard": "110101199001011234",
        "agentAddress": "北京市海淀区",
        "accountName": "某某银行",
        "bankAccount": "6222021234567890123",
        "bankName": "工商银行",
        "principal": "1000000.00",
        "interest": "50000.00",
        "penalty": "10000.00",
        "otherLosses": "5000.00",
        "totalAmount": "1065000.00",
        "hasCourtJudgment": 1,
        "hasExecution": 1,
        "hasCollateral": 0,
        "claimNature": "普通债权",
        "claimType": "借款债权",
        "claimFacts": "借款事实与理由...",
        "creditorCategory": "金融机构",
        "claimNatureManager": "普通债权",
        "claimIdentifier": "已确认",
        "evidenceList": "借款合同、还款计划等",
        "evidenceMaterials": "证据材料描述...",
        "evidenceAttachments": [],
        "remarks": "备注信息",
        "registrationStatus": "PENDING",
        "createdTime": "2023-01-15 10:00:00"
      }
    ]
  }
}
```

#### 2.2 新增债权登记
- **接口路径**: `/api/web/addClaim`
- **请求方式**: POST
- **请求参数**:
```json
{
  "caseId": "AJ2023001",
  "caseName": "浙江杭良锅炉制造有限公司破产清算案",
  "debtor": "浙江杭良锅炉制造有限公司",
  "poliziAccount": "polizi123",
  "creditorName": "某某银行股份有限公司",
  "creditorType": "金融机构",
  "creditCode": "91110000123456789X",
  "legalRepresentative": "张三",
  "serviceAddress": "北京市朝阳区",
  "agentName": "李四",
  "agentPhone": "13900139000",
  "agentIdCard": "110101199001011234",
  "agentAddress": "北京市海淀区",
  "accountName": "某某银行",
  "bankAccount": "6222021234567890123",
  "bankName": "工商银行",
  "principal": "1000000.00",
  "interest": "50000.00",
  "penalty": "10000.00",
  "otherLosses": "5000.00",
  "totalAmount": "1065000.00",
  "hasCourtJudgment": true,
  "hasExecution": true,
  "hasCollateral": false,
  "claimNature": "普通债权",
  "claimType": "借款债权",
  "claimFacts": "借款事实与理由...",
  "creditorCategory": "金融机构",
  "claimNatureManager": "普通债权",
  "claimIdentifier": "已确认",
  "evidenceList": "借款合同、还款计划等",
  "evidenceMaterials": "证据材料描述...",
  "evidenceAttachments": [],
  "remarks": "备注信息",
  "registrationStatus": "PENDING"
}
```
- **返回数据**:
```json
{
  "status": "1",
  "data": {
    "id": "1"
  }
}
```

#### 2.3 批量导入债权登记
- **接口路径**: `/api/web/batchImportClaims`
- **请求方式**: POST
- **Content-Type**: multipart/form-data
- **请求参数**:
  - `file`: Excel文件
  - `caseId`: 案件ID
- **返回数据**:
```json
{
  "status": "1",
  "data": {
    "count": 50,
    "successCount": 48,
    "failedCount": 2
  }
}
```

#### 2.4 导出债权登记表
- **接口路径**: `/api/web/exportClaims/{caseId}`
- **请求方式**: GET
- **请求参数**:
  - `caseId`: 案件ID（路径参数）
- **返回数据**: Excel文件流

#### 2.5 获取债权详情
- **接口路径**: `/api/web/getClaimDetail/{claimId}`
- **请求方式**: GET
- **请求参数**:
  - `claimId`: 债权ID（路径参数）
- **返回数据**:
```json
{
  "status": "1",
  "data": {
    "id": "1",
    "caseId": "AJ2023001",
    "creditorName": "某某银行股份有限公司",
    ...
  }
}
```

#### 2.6 更新债权登记
- **接口路径**: `/api/web/updateClaim/{claimId}`
- **请求方式**: POST
- **请求参数**: 同新增债权登记
- **返回数据**:
```json
{
  "status": "1"
}
```

#### 2.7 删除债权登记
- **接口路径**: `/api/web/deleteClaim/{claimId}`
- **请求方式**: POST
- **请求参数**:
  - `claimId`: 债权ID（路径参数）
- **返回数据**:
```json
{
  "status": "1"
}
```

## 三、后端实现要点

### 1. Controller层实现

```java
@RestController
@RequestMapping("/api/web")
public class ClaimController {

    @Autowired
    private ClaimService claimService;

    @GetMapping("/getClaims")
    public Result<PageResult<ClaimInfo>> getClaims(
            @RequestParam String caseId,
            @RequestParam Integer page,
            @RequestParam Integer size,
            @RequestParam(required = false) String creditorName,
            @RequestParam(required = false) String registrationStatus) {
        PageResult<ClaimInfo> result = claimService.getClaims(caseId, page, size, creditorName, registrationStatus);
        return Result.success(result);
    }

    @PostMapping("/addClaim")
    public Result<Map<String, String>> addClaim(@RequestBody ClaimInfo claimInfo) {
        String id = claimService.addClaim(claimInfo);
        return Result.success(Map.of("id", id));
    }

    @PostMapping("/batchImportClaims")
    public Result<Map<String, Integer>> batchImportClaims(
            @RequestParam("file") MultipartFile file,
            @RequestParam("caseId") String caseId) {
        Map<String, Integer> result = claimService.batchImportClaims(file, caseId);
        return Result.success(result);
    }

    @GetMapping("/exportClaims/{caseId}")
    public void exportClaims(@PathVariable String caseId, HttpServletResponse response) {
        claimService.exportClaims(caseId, response);
    }

    @GetMapping("/getClaimDetail/{claimId}")
    public Result<ClaimInfo> getClaimDetail(@PathVariable String claimId) {
        ClaimInfo claimInfo = claimService.getClaimDetail(claimId);
        return Result.success(claimInfo);
    }

    @PostMapping("/updateClaim/{claimId}")
    public Result<Void> updateClaim(@PathVariable String claimId, @RequestBody ClaimInfo claimInfo) {
        claimService.updateClaim(claimId, claimInfo);
        return Result.success();
    }

    @PostMapping("/deleteClaim/{claimId}")
    public Result<Void> deleteClaim(@PathVariable String claimId) {
        claimService.deleteClaim(claimId);
        return Result.success();
    }
}

@RestController
@RequestMapping("/api/web")
public class CreditorController {

    @Autowired
    private CreditorService creditorService;

    @GetMapping("/getCreditorsByCase")
    public Result<PageResult<CreditorInfo>> getCreditorsByCase(
            @RequestParam String caseId,
            @RequestParam Integer page,
            @RequestParam Integer size) {
        PageResult<CreditorInfo> result = creditorService.getCreditorsByCase(caseId, page, size);
        return Result.success(result);
    }

    @PostMapping("/batchAddCreditors")
    public Result<Map<String, Integer>> batchAddCreditors(@RequestBody Map<String, Object> params) {
        String caseId = (String) params.get("caseId");
        List<CreditorInfo> creditorsList = (List<CreditorInfo>) params.get("creditorsList");
        Map<String, Integer> result = creditorService.batchAddCreditors(caseId, creditorsList);
        return Result.success(result);
    }
}
```

### 2. Service层实现

```java
@Service
public class ClaimServiceImpl implements ClaimService {

    @Autowired
    private ClaimMapper claimMapper;

    @Override
    public PageResult<ClaimInfo> getClaims(String caseId, Integer page, Integer size, 
                                         String creditorName, String registrationStatus) {
        PageHelper.startPage(page, size);
        List<ClaimInfo> list = claimMapper.getClaims(caseId, creditorName, registrationStatus);
        PageInfo<ClaimInfo> pageInfo = new PageInfo<>(list);
        return new PageResult<>(pageInfo.getTotal(), pageInfo.getPages(), list);
    }

    @Override
    public String addClaim(ClaimInfo claimInfo) {
        claimInfo.setId(generateId());
        claimInfo.setCreatedTime(new Date());
        claimInfo.setRegistrationStatus("PENDING");
        claimMapper.insert(claimInfo);
        return claimInfo.getId();
    }

    @Override
    public Map<String, Integer> batchImportClaims(MultipartFile file, String caseId) {
        List<ClaimInfo> claims = ExcelUtils.parseExcel(file, ClaimInfo.class);
        int successCount = 0;
        int failedCount = 0;
        for (ClaimInfo claim : claims) {
            try {
                claim.setCaseId(caseId);
                claim.setId(generateId());
                claim.setCreatedTime(new Date());
                claim.setRegistrationStatus("PENDING");
                claimMapper.insert(claim);
                successCount++;
            } catch (Exception e) {
                failedCount++;
                log.error("导入债权失败", e);
            }
        }
        return Map.of("count", claims.size(), "successCount", successCount, "failedCount", failedCount);
    }

    @Override
    public void exportClaims(String caseId, HttpServletResponse response) {
        List<ClaimInfo> claims = claimMapper.getClaimsByCaseId(caseId);
        ExcelUtils.exportExcel(claims, "债权登记表", ClaimInfo.class, response);
    }

    @Override
    public ClaimInfo getClaimDetail(String claimId) {
        return claimMapper.selectById(claimId);
    }

    @Override
    public void updateClaim(String claimId, ClaimInfo claimInfo) {
        claimInfo.setId(claimId);
        claimInfo.setUpdatedTime(new Date());
        claimMapper.updateById(claimInfo);
    }

    @Override
    public void deleteClaim(String claimId) {
        claimMapper.deleteById(claimId);
    }
}

@Service
public class CreditorServiceImpl implements CreditorService {

    @Autowired
    private CreditorMapper creditorMapper;

    @Override
    public PageResult<CreditorInfo> getCreditorsByCase(String caseId, Integer page, Integer size) {
        PageHelper.startPage(page, size);
        List<CreditorInfo> list = creditorMapper.getCreditorsByCaseId(caseId);
        PageInfo<CreditorInfo> pageInfo = new PageInfo<>(list);
        return new PageResult<>(pageInfo.getTotal(), pageInfo.getPages(), list);
    }

    @Override
    public Map<String, Integer> batchAddCreditors(String caseId, List<CreditorInfo> creditorsList) {
        int successCount = 0;
        int failedCount = 0;
        for (CreditorInfo creditor : creditorsList) {
            try {
                creditor.setCaseId(caseId);
                creditor.setId(generateId());
                creditor.setCreatedTime(new Date());
                creditor.setStatus("ACTIVE");
                creditorMapper.insert(creditor);
                successCount++;
            } catch (Exception e) {
                failedCount++;
                log.error("添加债权人失败", e);
            }
        }
        return Map.of("successCount", successCount, "failedCount", failedCount);
    }
}
```

### 3. Mapper层实现

```java
@Mapper
public interface ClaimMapper {

    List<ClaimInfo> getClaims(@Param("caseId") String caseId,
                              @Param("creditorName") String creditorName,
                              @Param("registrationStatus") String registrationStatus);

    List<ClaimInfo> getClaimsByCaseId(@Param("caseId") String caseId);

    void insert(ClaimInfo claimInfo);

    ClaimInfo selectById(@Param("id") String id);

    void updateById(ClaimInfo claimInfo);

    void deleteById(@Param("id") String id);
}

@Mapper
public interface CreditorMapper {

    List<CreditorInfo> getCreditorsByCaseId(@Param("caseId") String caseId);

    void insert(CreditorInfo creditorInfo);
}
```

### 4. XML映射文件

```xml
<!-- ClaimMapper.xml -->
<mapper namespace="com.example.mapper.ClaimMapper">
    <select id="getClaims" resultType="com.example.entity.ClaimInfo">
        SELECT * FROM claim_registration
        WHERE case_id = #{caseId}
        <if test="creditorName != null and creditorName != ''">
            AND creditor_name LIKE CONCAT('%', #{creditorName}, '%')
        </if>
        <if test="registrationStatus != null and registrationStatus != ''">
            AND registration_status = #{registrationStatus}
        </if>
        ORDER BY created_time DESC
    </select>

    <select id="getClaimsByCaseId" resultType="com.example.entity.ClaimInfo">
        SELECT * FROM claim_registration
        WHERE case_id = #{caseId}
        ORDER BY created_time DESC
    </select>

    <insert id="insert" parameterType="com.example.entity.ClaimInfo">
        INSERT INTO claim_registration (
            id, case_id, case_name, debtor, polizi_account, creditor_name, creditor_type,
            credit_code, legal_representative, service_address, agent_name, agent_phone,
            agent_id_card, agent_address, account_name, bank_account, bank_name, principal,
            interest, penalty, other_losses, total_amount, has_court_judgment, has_execution,
            has_collateral, claim_nature, claim_type, claim_facts, creditor_category,
            claim_nature_manager, claim_identifier, evidence_list, evidence_materials,
            evidence_attachments, remarks, registration_status, created_by, created_time
        ) VALUES (
            #{id}, #{caseId}, #{caseName}, #{debtor}, #{poliziAccount}, #{creditorName}, #{creditorType},
            #{creditCode}, #{legalRepresentative}, #{serviceAddress}, #{agentName}, #{agentPhone},
            #{agentIdCard}, #{agentAddress}, #{accountName}, #{bankAccount}, #{bankName}, #{principal},
            #{interest}, #{penalty}, #{otherLosses}, #{totalAmount}, #{hasCourtJudgment}, #{hasExecution},
            #{hasCollateral}, #{claimNature}, #{claimType}, #{claimFacts}, #{creditorCategory},
            #{claimNatureManager}, #{claimIdentifier}, #{evidenceList}, #{evidenceMaterials},
            #{evidenceAttachments}, #{remarks}, #{registrationStatus}, #{createdBy}, #{createdTime}
        )
    </insert>

    <select id="selectById" resultType="com.example.entity.ClaimInfo">
        SELECT * FROM claim_registration WHERE id = #{id}
    </select>

    <update id="updateById" parameterType="com.example.entity.ClaimInfo">
        UPDATE claim_registration
        <set>
            <if test="caseName != null">case_name = #{caseName},</if>
            <if test="debtor != null">debtor = #{debtor},</if>
            <if test="creditorName != null">creditor_name = #{creditorName},</if>
            <if test="totalAmount != null">total_amount = #{totalAmount},</if>
            <if test="registrationStatus != null">registration_status = #{registrationStatus},</if>
            updated_time = #{updatedTime}
        </set>
        WHERE id = #{id}
    </update>

    <delete id="deleteById">
        DELETE FROM claim_registration WHERE id = #{id}
    </delete>
</mapper>

<!-- CreditorMapper.xml -->
<mapper namespace="com.example.mapper.CreditorMapper">
    <select id="getCreditorsByCaseId" resultType="com.example.entity.CreditorInfo">
        SELECT * FROM creditor_info
        WHERE case_id = #{caseId}
        ORDER BY created_time DESC
    </select>

    <insert id="insert" parameterType="com.example.entity.CreditorInfo">
        INSERT INTO creditor_info (
            id, case_id, creditor_name, creditor_type, contact_phone, contact_email,
            address, id_number, legal_representative, registered_capital, status, created_by, created_time
        ) VALUES (
            #{id}, #{caseId}, #{creditorName}, #{creditorType}, #{contactPhone}, #{contactEmail},
            #{address}, #{idNumber}, #{legalRepresentative}, #{registeredCapital}, #{status}, #{createdBy}, #{createdTime}
        )
    </insert>
</mapper>
```

## 四、Excel导入导出实现

### 1. 导入模板格式

| 案件名称 | 债务人 | 破栗子账号 | 债权人姓名或名称 | 债权人类型 | 统一社会信用代码 | 法定代表人 | 送达地址 | 代理人姓名 | 代理人电话 | 代理人身份证号码 | 代理人联系地址 | 账户名称 | 银行账号 | 开户银行 | 申报本金 | 申报利息 | 申报违约金 | 申报其他损失 | 是否有法院判决或仲裁裁决 | 是否已申请执行 | 是否有抵押物或质押物 | 债权性质 | 债权种类 | 债权事实与理由描述 | 债权人类别 | 债权性质(管理人自填) | 债权标识 | 债权申报证据清单 | 证据材料 | 备注 |
|---------|--------|-----------|-----------------|-----------|---------------|-----------|---------|-----------|-----------|---------------|---------------|---------|---------|---------|---------|---------|-----------|-------------|-------------------|-------------|-----------------|---------|---------|-------------------|---------|-------------------|---------|---------------|---------|------|

### 2. Excel工具类

```java
public class ExcelUtils {

    public static <T> List<T> parseExcel(MultipartFile file, Class<T> clazz) {
        try (InputStream inputStream = file.getInputStream()) {
            Workbook workbook = WorkbookFactory.create(inputStream);
            Sheet sheet = workbook.getSheetAt(0);
            List<T> result = new ArrayList<>();
            
            for (int i = 1; i <= sheet.getLastRowNum(); i++) {
                Row row = sheet.getRow(i);
                if (row == null) continue;
                
                T obj = clazz.getDeclaredConstructor().newInstance();
                // 解析每一行数据并映射到对象
                // ...
                result.add(obj);
            }
            
            return result;
        } catch (Exception e) {
            throw new RuntimeException("解析Excel失败", e);
        }
    }

    public static <T> void exportExcel(List<T> data, String sheetName, Class<T> clazz, 
                                      HttpServletResponse response) {
        try {
            Workbook workbook = new XSSFWorkbook();
            Sheet sheet = workbook.createSheet(sheetName);
            
            // 创建表头
            Row headerRow = sheet.createRow(0);
            // ...
            
            // 填充数据
            for (int i = 0; i < data.size(); i++) {
                Row row = sheet.createRow(i + 1);
                // ...
            }
            
            response.setContentType("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet");
            response.setHeader("Content-Disposition", "attachment; filename=" + URLEncoder.encode(sheetName + ".xlsx", "UTF-8"));
            
            workbook.write(response.getOutputStream());
            workbook.close();
        } catch (Exception e) {
            throw new RuntimeException("导出Excel失败", e);
        }
    }
}
```

## 五、注意事项

1. **数据验证**: 在接收前端数据时，需要进行严格的数据验证，确保数据的完整性和正确性。

2. **权限控制**: 需要根据用户角色控制访问权限，确保只有授权用户才能进行相关操作。

3. **事务管理**: 批量操作时需要使用事务，确保数据的一致性。

4. **文件上传**: 证据材料附件需要上传到文件服务器，并保存文件ID。

5. **日志记录**: 所有关键操作都需要记录日志，便于问题追踪。

6. **异常处理**: 需要完善的异常处理机制，给用户友好的错误提示。

7. **分页查询**: 列表查询需要使用分页，避免一次性加载过多数据。

8. **索引优化**: 数据库表需要建立合适的索引，提高查询效率。
