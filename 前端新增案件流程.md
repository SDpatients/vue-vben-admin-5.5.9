# 前端新增案件流程

## 1. 新增案件接口

### 1.1 接口信息
- **接口地址**：`/api/web/AddOneCase`
- **请求方式**：`POST`
- **权限要求**：需要有 `case:add` 权限

### 1.2 接口功能
- 用于创建新的破产案件
- 支持同时添加工作团队成员（可选）

## 2. 请求参数

### 2.1 主要参数说明
| 参数名 | 类型 | 描述 | 是否必填 | 备注 |
| --- | --- | --- | --- | --- |
| sepLd | Integer | 立案年度 | 是 | 例如：2025 |
| sepMd | Integer | 立案月份 | 是 | 例如：1 |
| sepNd | String | 立案文号 | 是 | 例如："001" |
| ah | String | 案号 | 是 | 例如："(2025)沪破字第001号" |
| ajmc | String | 案件名称 | 是 | 例如："上海某某有限公司破产清算案" |
| slrq | Date | 受理日期 | 是 | 格式：YYYY-MM-DD |
| ajly | String | 案件来源 | 是 | 例如："债权人申请" |
| slfy | String | 受理法院 | 是 | 例如："上海市第一中级人民法院" |
| zdjg | String | 指定机构 | 是 | 例如："某某律师事务所" |
| glrfzr | String | 管理人负责人 | 是 | 例如："张三" |
| sfjhs | String | 是否已核审 | 是 | 可选值："是"/"否" |
| ay | String | 案由 | 是 | 例如："破产清算" |
| ajjd | String | 案件阶段 | 是 | 例如："受理阶段" |
| zqsbjzsj | Date | 债权申报截止时间 | 否 | 格式：YYYY-MM-DD |
| larq | Date | 立案日期 | 否 | 格式：YYYY-MM-DD |
| jarq | Date | 结案日期 | 否 | 格式：YYYY-MM-DD |
| pcsj | Date | 破产时间 | 否 | 格式：YYYY-MM-DD |
| zjsj | Date | 终结时间 | 否 | 格式：YYYY-MM-DD |
| zxsj | Date | 注销时间 | 否 | 格式：YYYY-MM-DD |
| gdsj | Date | 归档时间 | 否 | 格式：YYYY-MM-DD |
| beizhu | String | 备注 | 否 | 案件相关备注信息 |
| wjsc | String | 文件上传 | 否 | 文件存储路径或标识 |
| cbry | String | 承办人员 | 否 | 例如："李四" |
| reviewerId | Integer | 审核人ID | 否 | 审核该案件的用户ID |
| teamMembers | List<WorkTeamMember> | 工作团队成员列表 | 否 | 用于同时添加团队成员 |

### 2.2 工作团队成员参数（teamMembers）
| 参数名 | 类型 | 描述 | 是否必填 | 备注 |
| --- | --- | --- | --- | --- |
| userId | Integer | 用户ID | 是 | 团队成员的用户ID |
| roleId | Integer | 角色ID | 是 | 团队成员的角色ID |
| permissions | List<String> | 权限列表 | 否 | 团队成员的具体权限 |

## 3. 请求示例

### 3.1 仅创建案件（不添加团队成员）
```json
{
  "sepLd": 2025,
  "sepMd": 1,
  "sepNd": "001",
  "ah": "(2025)沪破字第001号",
  "ajmc": "上海某某有限公司破产清算案",
  "slrq": "2025-01-01",
  "ajly": "债权人申请",
  "slfy": "上海市第一中级人民法院",
  "zdjg": "某某律师事务所",
  "glrfzr": "张三",
  "sfjhs": "否",
  "ay": "破产清算",
  "ajjd": "受理阶段",
  "zqsbjzsj": "2025-03-01",
  "beizhu": "备注信息",
  "cbry": "李四"
}
```

### 3.2 创建案件并同时添加团队成员
```json
{
  "sepLd": 2025,
  "sepMd": 1,
  "sepNd": "001",
  "ah": "(2025)沪破字第001号",
  "ajmc": "上海某某有限公司破产清算案",
  "slrq": "2025-01-01",
  "ajly": "债权人申请",
  "slfy": "上海市第一中级人民法院",
  "zdjg": "某某律师事务所",
  "glrfzr": "张三",
  "sfjhs": "否",
  "ay": "破产清算",
  "ajjd": "受理阶段",
  "zqsbjzsj": "2025-03-01",
  "beizhu": "备注信息",
  "cbry": "李四",
  "teamMembers": [
    {
      "userId": 2,
      "roleId": 3,
      "permissions": ["case:view", "case:edit"]
    },
    {
      "userId": 3,
      "roleId": 4,
      "permissions": ["case:view"]
    }
  ]
}
```

## 4. 响应示例

### 4.1 成功响应
```json
{
  "code": 200,
  "msg": "案件添加成功",
  "data": null
}
```

### 4.2 失败响应
```json
{
  "code": 500,
  "msg": "无权创建案件",
  "data": null
}
```

## 5. 流程说明

### 5.1 基本流程
1. 前端收集案件基本信息
2. 调用 `/api/web/AddOneCase` 接口创建案件
3. 接收响应，根据响应结果提示用户
4. 如果需要添加团队成员，可在创建案件时同时传递 `teamMembers` 参数，或后续调用工作团队成员管理接口

### 5.2 后续操作
- **分配工作团队成员**：如果创建案件时未添加团队成员，可后续调用工作团队成员管理接口
- **设置案件权限**：根据需要为案件设置详细权限
- **更新案件信息**：调用 `/api/web/updateCase` 或 `/api/web/updateBCase` 接口更新案件信息
- **案件审核**：由审核人员调用 `/api/web/approveCase` 或 `/api/web/rejectCase` 接口进行审核

## 6. 注意事项

1. 所有日期格式需统一为 `YYYY-MM-DD`
2. 案件创建后，创建人自动获得该案件的所有权限
3. 如果同时添加团队成员，需确保团队成员的用户ID和角色ID存在且有效
4. 案件创建后，可通过 `/api/web/selectOneCase` 接口查询案件详情
5. 案件创建后，可通过 `/api/web/checkCasePermission` 接口检查用户对该案件的权限

## 7. 相关接口

| 接口名称 | 接口地址 | 请求方式 | 功能描述 |
| --- | --- | --- | --- |
| 查询案件详情 | `/api/web/selectOneCase` | GET | 查询单个案件的详细信息 |
| 更新案件信息 | `/api/web/updateCase` | POST | 更新案件基本信息 |
| 更新案件信息（备用） | `/api/web/updateBCase` | POST | 更新案件基本信息（备用接口） |
| 检查案件权限 | `/api/web/checkCasePermission` | GET | 检查用户对指定案件的权限 |
| 获取团队成员信息 | `/api/web/getMyTeamMemberInfo` | GET | 获取当前用户在指定案件中的团队成员信息 |

## 8. 工作团队相关API

### 8.1 设置团队成员
- **接口地址**：`/api/web/workteam/setTeamMembers`
- **请求方式**：`POST`
- **功能描述**：批量设置案件的工作团队成员
- **权限要求**：只有案件创建者可以设置团队成员

**请求参数**：
```json
{
  "caseId": 1,  // 案件ID
  "members": [  // 团队成员列表
    {
      "userId": 2,  // 用户ID
      "roleId": 3   // 角色ID
    }
  ],
  "permissions": [  // 权限列表（可选）
    {
      "memberId": 1,  // 成员ID
      "moduleType": "case",  // 模块类型
      "permissionType": "view",  // 权限类型
      "isAllowed": true  // 是否允许
    }
  ]
}
```

### 8.2 获取团队成员
- **接口地址**：`/api/web/workteam/getTeamMembers`
- **请求方式**：`GET`
- **功能描述**：获取案件的所有团队成员
- **请求参数**：
  - `caseId`：案件ID（必填）

### 8.3 获取活跃团队成员
- **接口地址**：`/api/web/workteam/getActiveTeamMembers`
- **请求方式**：`GET`
- **功能描述**：获取案件的活跃团队成员
- **请求参数**：
  - `caseId`：案件ID（必填）

### 8.4 添加团队成员
- **接口地址**：`/api/web/workteam/addTeamMember`
- **请求方式**：`POST`
- **功能描述**：添加单个团队成员
- **权限要求**：只有案件创建者可以添加团队成员

**请求参数**：
```json
{
  "caseId": 1,  // 案件ID
  "userId": 2,  // 用户ID
  "roleId": 3   // 角色ID
}
```

### 8.5 更新团队成员
- **接口地址**：`/api/web/workteam/updateTeamMember`
- **请求方式**：`POST`
- **功能描述**：更新团队成员信息
- **权限要求**：只有案件创建者可以修改团队成员

**请求参数**：
```json
{
  "id": 1,  // 团队成员ID
  "caseId": 1,  // 案件ID
  "userId": 2,  // 用户ID
  "roleId": 4   // 新角色ID
}
```

### 8.6 移除团队成员
- **接口地址**：`/api/web/workteam/removeTeamMember`
- **请求方式**：`POST`
- **功能描述**：移除团队成员
- **权限要求**：只有案件创建者可以移除团队成员
- **请求参数**：
  - `memberId`：团队成员ID（必填）

### 8.7 获取我的可访问案件
- **接口地址**：`/api/web/workteam/getMyAccessibleCases`
- **请求方式**：`GET`
- **功能描述**：获取当前用户可访问的所有案件

### 8.8 获取所有团队角色
- **接口地址**：`/api/web/workteam/getAllTeamRoles`
- **请求方式**：`GET`
- **功能描述**：获取所有团队角色

### 8.9 获取活跃团队角色
- **接口地址**：`/api/web/workteam/getActiveTeamRoles`
- **请求方式**：`GET`
- **功能描述**：获取所有活跃的团队角色

### 8.10 保存成员权限
- **接口地址**：`/api/web/workteam/saveMemberPermissions`
- **请求方式**：`POST`
- **功能描述**：保存团队成员的权限
- **权限要求**：只有案件创建者可以设置权限

**请求参数**：
```json
{
  "memberId": 1,  // 成员ID
  "permissions": [  // 权限列表
    {
      "moduleType": "case",  // 模块类型
      "permissionType": "view",  // 权限类型
      "isAllowed": true  // 是否允许
    }
  ]
}
```

### 8.11 获取成员权限
- **接口地址**：`/api/web/workteam/getMemberPermissions`
- **请求方式**：`GET`
- **功能描述**：获取团队成员的权限
- **请求参数**：
  - `memberId`：团队成员ID（必填）

### 8.12 检查案件访问权限
- **接口地址**：`/api/web/workteam/canAccessCase`
- **请求方式**：`GET`
- **功能描述**：检查用户是否可以访问指定案件
- **请求参数**：
  - `caseId`：案件ID（必填）
  - `permission`：权限类型（可选，默认：VIEW）

### 8.13 根据案件和用户获取团队成员
- **接口地址**：`/api/web/workteam/getTeamMemberByCaseAndUser`
- **请求方式**：`GET`
- **功能描述**：根据案件ID和用户ID获取团队成员信息
- **请求参数**：
  - `caseId`：案件ID（必填）
  - `userId`：用户ID（必填）

### 8.14 获取所有工作团队
- **接口地址**：`/api/web/getAllWorkTeam`
- **请求方式**：`GET`
- **功能描述**：获取所有工作团队列表

### 8.15 添加工作团队（备用接口）
- **接口地址**：`/api/web/addWorkTeam`
- **请求方式**：`POST`
- **功能描述**：添加工作团队成员（备用接口）

**请求参数**：
```json
{
  "caseId": 1,  // 案件ID（必填）
  "userId": 2,  // 用户ID（必填）
  "roleId": 3   // 角色ID
}
```

## 9. 工作团队操作流程

### 9.1 基本流程
1. 案件创建成功后，案件创建者可以设置团队成员
2. 调用 `/api/web/workteam/setTeamMembers` 接口批量设置团队成员，或调用 `/api/web/workteam/addTeamMember` 接口逐个添加
3. 为团队成员设置权限，可通过 `setTeamMembers` 接口同时设置，或后续调用 `/api/web/workteam/saveMemberPermissions` 接口单独设置
4. 团队成员可以通过 `/api/web/workteam/getMyAccessibleCases` 接口获取自己可访问的案件
5. 可以通过 `/api/web/workteam/getTeamMembers` 接口查看案件的所有团队成员

### 9.2 注意事项
1. 只有案件创建者可以管理团队成员和权限
2. 团队成员添加后，自动获得案件的基本访问权限
3. 可以根据需要为不同团队成员设置不同的权限
4. 权限设置支持按模块和操作类型进行精细化控制
5. 可以通过 `/api/web/workteam/canAccessCase` 接口检查用户对案件的具体权限
