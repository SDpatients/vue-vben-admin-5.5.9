# 案件流程任务提交API文档

## 基础信息

- **Base URL**: `/api/case-task-submissions`
- **Content-Type**: `application/json`
- **响应格式**: 所有接口统一返回 `Result` 格式

### 统一响应格式

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {}
}
```

---

## API接口列表

### 1. 创建任务提交

创建新的任务提交记录。

**接口地址**: `POST /api/case-task-submissions`

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| caseTaskId | Long | 是 | 任务ID |
| submissionTitle | String | 是 | 提交标题 |
| submissionContent | String | 否 | 提交内容 |
| submissionType | String | 否 | 提交类型（默认：NORMAL） |

**请求示例**:

```json
{
  "caseTaskId": 1,
  "submissionTitle": "任务完成报告",
  "submissionContent": "任务已完成，详见附件",
  "submissionType": "NORMAL"
}
```

**响应示例**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "submissionId": 1,
    "submissionNumber": 1
  }
}
```

---

### 2. 查询任务提交列表

分页查询指定任务的提交记录。

**接口地址**: `GET /api/case-task-submissions`

**请求参数**:

| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| caseTaskId | Long | 是 | - | 任务ID |
| page | Integer | 否 | 1 | 页码（从1开始） |
| size | Integer | 否 | 10 | 每页大小 |

**请求示例**:

```
GET /api/case-task-submissions?caseTaskId=1&page=1&size=10
```

**响应示例**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "content": [
      {
        "id": 1,
        "caseTaskId": 1,
        "submissionTitle": "任务完成报告",
        "submissionContent": "任务已完成，详见附件",
        "submissionType": "NORMAL",
        "submissionNumber": 1,
        "status": "PENDING",
        "creatorName": "张三",
        "reviewerId": null,
        "reviewOpinion": null,
        "reviewTime": null,
        "createTime": "2026-01-21T10:00:00",
        "updateTime": "2026-01-21T10:00:00",
        "fileCount": 2
      }
    ],
    "pageable": {
      "pageNumber": 0,
      "pageSize": 10
    },
    "totalElements": 1,
    "totalPages": 1,
    "last": true,
    "first": true
  }
}
```

---

### 3. 查询单个提交详情

根据提交ID查询详细信息。

**接口地址**: `GET /api/case-task-submissions/{id}`

**路径参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 提交ID |

**请求示例**:

```
GET /api/case-task-submissions/1
```

**响应示例**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 1,
    "caseTaskId": 1,
    "submissionTitle": "任务完成报告",
    "submissionContent": "任务已完成，详见附件",
    "submissionType": "NORMAL",
    "submissionNumber": 1,
    "status": "PENDING",
    "creatorName": "张三",
    "reviewerId": null,
    "reviewOpinion": null,
    "reviewTime": null,
    "createTime": "2026-01-21T10:00:00",
    "updateTime": "2026-01-21T10:00:00",
    "fileCount": 2
  }
}
```

---

### 4. 审核任务提交

对任务提交进行审核。

**接口地址**: `PUT /api/case-task-submissions/{id}/review`

**路径参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 提交ID |

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| reviewOpinion | String | 是 | 审核意见 |
| status | String | 是 | 审核状态（APPROVED:通过, REJECTED:驳回） |

**请求示例**:

```json
{
  "reviewOpinion": "审核通过，工作完成质量良好",
  "status": "APPROVED"
}
```

**响应示例**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 1,
    "caseTaskId": 1,
    "submissionTitle": "任务完成报告",
    "submissionContent": "任务已完成，详见附件",
    "submissionType": "NORMAL",
    "submissionNumber": 1,
    "status": "APPROVED",
    "creatorName": "张三",
    "reviewerId": 2,
    "reviewOpinion": "审核通过，工作完成质量良好",
    "reviewTime": "2026-01-21T11:00:00",
    "createTime": "2026-01-21T10:00:00",
    "updateTime": "2026-01-21T11:00:00",
    "fileCount": 2
  }
}
```

---

### 5. 删除任务提交

删除指定的任务提交记录。

**接口地址**: `DELETE /api/case-task-submissions/{id}`

**路径参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 提交ID |

**请求示例**:

```
DELETE /api/case-task-submissions/1
```

**响应示例**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

---

### 6. 查询最新提交记录

查询指定任务的最新提交记录列表。

**接口地址**: `GET /api/case-task-submissions/latest`

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| caseTaskId | Long | 是 | 任务ID |
| limit | Integer | 否 | 返回数量限制（不传则返回全部） |

**请求示例**:

```
GET /api/case-task-submissions/latest?caseTaskId=1&limit=5
```

**响应示例**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": [
    {
      "id": 3,
      "caseTaskId": 1,
      "submissionTitle": "任务完成报告 v3",
      "submissionType": "NORMAL",
      "submissionNumber": 3,
      "status": "PENDING",
      "creatorName": "张三",
      "createTime": "2026-01-21T12:00:00",
      "fileCount": 1
    },
    {
      "id": 2,
      "caseTaskId": 1,
      "submissionTitle": "任务完成报告 v2",
      "submissionType": "NORMAL",
      "submissionNumber": 2,
      "status": "REJECTED",
      "creatorName": "张三",
      "createTime": "2026-01-21T11:00:00",
      "fileCount": 2
    }
  ]
}
```

---

### 7. 上传任务提交文件

为任务提交上传附件文件。

**接口地址**: `POST /api/case-task-submissions/{submissionId}/files`

**路径参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| submissionId | Long | 是 | 提交ID |

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| file | File | 是 | 上传的文件 |
| description | String | 否 | 文件描述 |

**请求示例**:

```
POST /api/case-task-submissions/1/files
Content-Type: multipart/form-data

file: [二进制文件]
description: "相关证明材料"
```

**响应示例**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 1,
    "originalFileName": "证明材料.pdf",
    "filePath": "/uploads/2026/01/21/xxx.pdf",
    "fileSize": 1024000,
    "uploadTime": "2026-01-21T10:30:00"
  }
}
```

---

### 8. 查询任务提交文件列表

查询指定任务提交的所有文件。

**接口地址**: `GET /api/case-task-submissions/{submissionId}/files`

**路径参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| submissionId | Long | 是 | 提交ID |

**请求示例**:

```
GET /api/case-task-submissions/1/files
```

**响应示例**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": [
    {
      "id": 1,
      "originalFileName": "证明材料.pdf",
      "filePath": "/uploads/2026/01/21/xxx.pdf",
      "fileSize": 1024000,
      "uploadTime": "2026-01-21T10:30:00",
      "uploadUserName": "张三"
    },
    {
      "id": 2,
      "originalFileName": "附件.docx",
      "filePath": "/uploads/2026/01/21/yyy.docx",
      "fileSize": 512000,
      "uploadTime": "2026-01-21T10:35:00",
      "uploadUserName": "张三"
    }
  ]
}
```

---

### 9. 删除任务提交文件

删除指定的任务提交文件。

**接口地址**: `DELETE /api/case-task-submissions/{submissionId}/files/{fileId}`

**路径参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| submissionId | Long | 是 | 提交ID |
| fileId | Long | 是 | 文件ID |

**请求示例**:

```
DELETE /api/case-task-submissions/1/files/1
```

**响应示例**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

---

## 数据字典

### 提交状态 (status)

| 值 | 说明 |
|----|------|
| PENDING | 待审核 |
| APPROVED | 已通过 |
| REJECTED | 已驳回 |

### 提交类型 (submissionType)

| 值 | 说明 |
|----|------|
| NORMAL | 普通提交 |
| SUPPLEMENTARY | 补充提交 |

---

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| 200 | 操作成功 |
| 400 | 请求参数错误 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

---

## 注意事项

1. 所有时间字段格式均为 ISO 8601 标准格式（如：`2026-01-21T10:00:00`）
2. 文件上传接口使用 `multipart/form-data` 格式
3. 分页查询时，`page` 参数从 1 开始
4. 审核操作只能对状态为 `PENDING` 的提交进行
5. 删除操作为逻辑删除，数据不会真正从数据库中删除
