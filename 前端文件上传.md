# 案件管理系统 - 前端文件上传指南

## 1. 概述

本文档详细描述了案件管理系统中文件上传功能的前端实现指南，包括后端提供的API接口、前端调用示例和注意事项，旨在帮助前端开发人员快速集成文件上传功能。

## 2. API接口列表

| 接口名称 | URL | 请求方法 | 功能描述 |
|---------|-----|---------|---------|
| 上传文件 | `/api/web/uploadCaseFile` | `POST` | 上传单个文件 |
| 批量上传文件 | `/api/web/batchUploadCaseFiles` | `POST` | 批量上传多个文件 |
| 获取案件文件列表 | `/api/web/getCaseFiles` | `GET` | 获取指定案件的所有文件 |
| 下载文件 | `/api/web/downloadCaseFile/{fileId}` | `GET` | 下载指定文件 |
| 删除文件 | `/api/web/deleteCaseFile/{fileId}` | `DELETE` | 删除指定文件 |

## 3. API接口详细说明

### 3.1 上传文件接口

#### 请求信息
- **URL**：`/api/web/uploadCaseFile`
- **方法**：`POST`
- **请求类型**：`multipart/form-data`

#### 请求参数
| 参数名 | 类型 | 位置 | 必填 | 描述 |
|--------|------|------|------|------|
| token | STRING | Query | 是 | 认证令牌 |
| SEP_ID | STRING | Query | 是 | 案件ID |
| file | FILE | Form | 是 | 要上传的文件 |

#### 成功响应
```json
{
  "status": "1",
  "msg": "文件上传成功",
  "data": {
    "id": "文件UUID",
    "name": "文件名",
    "url": "文件访问URL",
    "size": 1024000,
    "type": "application/pdf",
    "uploadTime": "2023-01-01 12:00:00"
  }
}
```

#### 失败响应
```json
{
  "status": "0",
  "msg": "文件上传失败",
  "data": "错误原因描述"
}
```

### 3.2 批量上传文件接口

#### 请求信息
- **URL**：`/api/web/batchUploadCaseFiles`
- **方法**：`POST`
- **请求类型**：`multipart/form-data`

#### 请求参数
| 参数名 | 类型 | 位置 | 必填 | 描述 |
|--------|------|------|------|------|
| token | STRING | Query | 是 | 认证令牌 |
| SEP_ID | STRING | Query | 是 | 案件ID |
| files | FILE[] | Form | 是 | 要上传的文件数组 |

#### 成功响应
```json
{
  "status": "1",
  "msg": "文件上传成功",
  "data": [
    {
      "id": "文件UUID1",
      "name": "文件名1",
      "url": "文件访问URL1",
      "size": 1024000,
      "type": "application/pdf",
      "uploadTime": "2023-01-01 12:00:00"
    },
    {
      "id": "文件UUID2",
      "name": "文件名2",
      "url": "文件访问URL2",
      "size": 2048000,
      "type": "image/jpeg",
      "uploadTime": "2023-01-01 12:00:01"
    }
  ]
}
```

#### 失败响应
```json
{
  "status": "0",
  "msg": "文件上传失败",
  "data": "错误原因描述"
}
```

### 3.3 获取案件文件列表接口

#### 请求信息
- **URL**：`/api/web/getCaseFiles`
- **方法**：`GET`

#### 请求参数
| 参数名 | 类型 | 位置 | 必填 | 描述 |
|--------|------|------|------|------|
| token | STRING | Query | 是 | 认证令牌 |
| SEP_ID | STRING | Query | 是 | 案件ID |
| page | INTEGER | Query | 否 | 页码，默认1 |
| size | INTEGER | Query | 否 | 每页数量，默认10 |

#### 成功响应
```json
{
  "status": "1",
  "msg": "查询成功",
  "data": {
    "records": [
      {
        "id": "文件UUID",
        "name": "文件名",
        "url": "文件访问URL",
        "size": 1024000,
        "type": "application/pdf",
        "uploadTime": "2023-01-01 12:00:00",
        "uploadUser": "上传用户名"
      }
    ],
    "total": 10,
    "page": 1,
    "size": 10
  }
}
```

#### 失败响应
```json
{
  "status": "0",
  "msg": "查询失败",
  "data": "错误原因描述"
}
```

### 3.4 下载文件接口

#### 请求信息
- **URL**：`/api/web/downloadCaseFile/{fileId}`
- **方法**：`GET`

#### 请求参数
| 参数名 | 类型 | 位置 | 必填 | 描述 |
|--------|------|------|------|------|
| token | STRING | Query | 是 | 认证令牌 |
| fileId | STRING | Path | 是 | 文件ID |

#### 响应信息
- **成功响应**：文件流（浏览器会自动触发下载）
- **失败响应**：
  ```json
  {
    "status": "0",
    "msg": "文件下载失败",
    "data": "错误原因描述"
  }
  ```

### 3.5 删除文件接口

#### 请求信息
- **URL**：`/api/web/deleteCaseFile/{fileId}`
- **方法**：`DELETE`

#### 请求参数
| 参数名 | 类型 | 位置 | 必填 | 描述 |
|--------|------|------|------|------|
| token | STRING | Query | 是 | 认证令牌 |
| fileId | STRING | Path | 是 | 文件ID |

#### 成功响应
```json
{
  "status": "1",
  "msg": "文件删除成功",
  "data": null
}
```

#### 失败响应
```json
{
  "status": "0",
  "msg": "文件删除失败",
  "data": "错误原因描述"
}
```

## 3. 前端实现示例

### 3.1 使用原生JavaScript实现文件上传

```javascript
// 单文件上传
function uploadSingleFile() {
    const fileInput = document.getElementById('fileInput');
    const file = fileInput.files[0];
    const caseId = '案件ID';
    const token = '认证令牌';
    
    const formData = new FormData();
    formData.append('file', file);
    formData.append('SEP_ID', caseId);
    
    const xhr = new XMLHttpRequest();
    xhr.open('POST', `/api/web/uploadCaseFile?token=${token}`, true);
    
    xhr.onload = function() {
        if (xhr.status === 200) {
            const response = JSON.parse(xhr.responseText);
            if (response.status === '1') {
                console.log('文件上传成功', response.data);
                alert('文件上传成功');
            } else {
                console.error('文件上传失败', response.msg);
                alert('文件上传失败：' + response.msg);
            }
        } else {
            console.error('请求失败', xhr.statusText);
            alert('请求失败：' + xhr.statusText);
        }
    };
    
    xhr.onerror = function() {
        console.error('网络错误');
        alert('网络错误');
    };
    
    xhr.send(formData);
}

// 批量文件上传
function uploadMultipleFiles() {
    const fileInput = document.getElementById('filesInput');
    const files = fileInput.files;
    const caseId = '案件ID';
    const token = '认证令牌';
    
    const formData = new FormData();
    for (let i = 0; i < files.length; i++) {
        formData.append('files', files[i]);
    }
    formData.append('SEP_ID', caseId);
    
    const xhr = new XMLHttpRequest();
    xhr.open('POST', `/api/web/batchUploadCaseFiles?token=${token}`, true);
    
    xhr.onload = function() {
        if (xhr.status === 200) {
            const response = JSON.parse(xhr.responseText);
            if (response.status === '1') {
                console.log('批量文件上传成功', response.data);
                alert('批量文件上传成功');
            } else {
                console.error('批量文件上传失败', response.msg);
                alert('批量文件上传失败：' + response.msg);
            }
        } else {
            console.error('请求失败', xhr.statusText);
            alert('请求失败：' + xhr.statusText);
        }
    };
    
    xhr.onerror = function() {
        console.error('网络错误');
        alert('网络错误');
    };
    
    xhr.send(formData);
}
```

### 3.2 使用Axios实现文件上传

```javascript
// 安装Axios：npm install axios
import axios from 'axios';

// 设置Axios默认配置
axios.defaults.baseURL = 'http://localhost:8080'; // 后端服务地址

// 单文件上传
async function uploadSingleFile(file, caseId, token) {
    try {
        const formData = new FormData();
        formData.append('file', file);
        formData.append('SEP_ID', caseId);
        
        const response = await axios.post('/api/web/uploadCaseFile', formData, {
            params: { token },
            headers: {
                'Content-Type': 'multipart/form-data'
            }
        });
        
        if (response.data.status === '1') {
            console.log('文件上传成功', response.data.data);
            return response.data.data;
        } else {
            console.error('文件上传失败', response.data.msg);
            throw new Error(response.data.msg);
        }
    } catch (error) {
        console.error('上传失败', error);
        throw error;
    }
}

// 批量文件上传
async function uploadMultipleFiles(files, caseId, token) {
    try {
        const formData = new FormData();
        for (let i = 0; i < files.length; i++) {
            formData.append('files', files[i]);
        }
        formData.append('SEP_ID', caseId);
        
        const response = await axios.post('/api/web/batchUploadCaseFiles', formData, {
            params: { token },
            headers: {
                'Content-Type': 'multipart/form-data'
            }
        });
        
        if (response.data.status === '1') {
            console.log('批量文件上传成功', response.data.data);
            return response.data.data;
        } else {
            console.error('批量文件上传失败', response.data.msg);
            throw new Error(response.data.msg);
        }
    } catch (error) {
        console.error('批量上传失败', error);
        throw error;
    }
}

// 获取案件文件列表
async function getCaseFiles(caseId, token, page = 1, size = 10) {
    try {
        const response = await axios.get('/api/web/getCaseFiles', {
            params: {
                token,
                SEP_ID: caseId,
                page,
                size
            }
        });
        
        if (response.data.status === '1') {
            console.log('获取文件列表成功', response.data.data);
            return response.data.data;
        } else {
            console.error('获取文件列表失败', response.data.msg);
            throw new Error(response.data.msg);
        }
    } catch (error) {
        console.error('获取文件列表失败', error);
        throw error;
    }
}

// 删除文件
async function deleteFile(fileId, token) {
    try {
        const response = await axios.delete(`/api/web/deleteCaseFile/${fileId}`, {
            params: { token }
        });
        
        if (response.data.status === '1') {
            console.log('文件删除成功');
            return true;
        } else {
            console.error('文件删除失败', response.data.msg);
            throw new Error(response.data.msg);
        }
    } catch (error) {
        console.error('删除文件失败', error);
        throw error;
    }
}
```

### 3.3 使用Vue + Axios实现文件上传

```vue
<template>
  <div class="file-upload-container">
    <h3>文件上传</h3>
    
    <!-- 单文件上传 -->
    <div class="upload-section">
      <h4>单文件上传</h4>
      <input type="file" ref="singleFile" @change="handleSingleFileChange" />
      <button @click="handleSingleUpload">上传</button>
    </div>
    
    <!-- 批量文件上传 -->
    <div class="upload-section">
      <h4>批量文件上传</h4>
      <input type="file" ref="multipleFiles" multiple @change="handleMultipleFileChange" />
      <button @click="handleMultipleUpload">批量上传</button>
    </div>
    
    <!-- 文件列表 -->
    <div class="file-list-section">
      <h4>文件列表</h4>
      <div v-if="fileList.length > 0">
        <table>
          <thead>
            <tr>
              <th>文件名</th>
              <th>大小</th>
              <th>类型</th>
              <th>上传时间</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="file in fileList" :key="file.id">
              <td>{{ file.name }}</td>
              <td>{{ formatFileSize(file.size) }}</td>
              <td>{{ file.type }}</td>
              <td>{{ file.uploadTime }}</td>
              <td>
                <button @click="downloadFile(file.id, file.name)">下载</button>
                <button @click="deleteFile(file.id)">删除</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div v-else>
        暂无文件
      </div>
    </div>
  </div>
</template>

<script>
import axios from 'axios';

export default {
  name: 'FileUpload',
  data() {
    return {
      caseId: '案件ID',
      token: '认证令牌',
      singleFile: null,
      multipleFiles: [],
      fileList: []
    };
  },
  mounted() {
    // 初始化时获取文件列表
    this.getFileList();
  },
  methods: {
    // 处理单文件选择
    handleSingleFileChange(event) {
      this.singleFile = event.target.files[0];
    },
    
    // 处理多文件选择
    handleMultipleFileChange(event) {
      this.multipleFiles = event.target.files;
    },
    
    // 单文件上传
    async handleSingleUpload() {
      if (!this.singleFile) {
        alert('请选择文件');
        return;
      }
      
      try {
        const formData = new FormData();
        formData.append('file', this.singleFile);
        formData.append('SEP_ID', this.caseId);
        
        const response = await axios.post('/api/web/uploadCaseFile', formData, {
          params: { token: this.token },
          headers: {
            'Content-Type': 'multipart/form-data'
          }
        });
        
        if (response.data.status === '1') {
          alert('文件上传成功');
          this.getFileList(); // 刷新文件列表
          this.$refs.singleFile.value = ''; // 清空文件选择
          this.singleFile = null;
        } else {
          alert('文件上传失败：' + response.data.msg);
        }
      } catch (error) {
        console.error('上传失败', error);
        alert('上传失败：' + error.message);
      }
    },
    
    // 批量文件上传
    async handleMultipleUpload() {
      if (this.multipleFiles.length === 0) {
        alert('请选择文件');
        return;
      }
      
      try {
        const formData = new FormData();
        for (let i = 0; i < this.multipleFiles.length; i++) {
          formData.append('files', this.multipleFiles[i]);
        }
        formData.append('SEP_ID', this.caseId);
        
        const response = await axios.post('/api/web/batchUploadCaseFiles', formData, {
          params: { token: this.token },
          headers: {
            'Content-Type': 'multipart/form-data'
          }
        });
        
        if (response.data.status === '1') {
          alert('批量文件上传成功');
          this.getFileList(); // 刷新文件列表
          this.$refs.multipleFiles.value = ''; // 清空文件选择
          this.multipleFiles = [];
        } else {
          alert('批量文件上传失败：' + response.data.msg);
        }
      } catch (error) {
        console.error('批量上传失败', error);
        alert('批量上传失败：' + error.message);
      }
    },
    
    // 获取文件列表
    async getFileList() {
      try {
        const response = await axios.get('/api/web/getCaseFiles', {
          params: {
            token: this.token,
            SEP_ID: this.caseId
          }
        });
        
        if (response.data.status === '1') {
          this.fileList = response.data.data.records;
        } else {
          alert('获取文件列表失败：' + response.data.msg);
        }
      } catch (error) {
        console.error('获取文件列表失败', error);
        alert('获取文件列表失败：' + error.message);
      }
    },
    
    // 下载文件
    downloadFile(fileId, fileName) {
      // 使用a标签下载
      const link = document.createElement('a');
      link.href = `/api/web/downloadCaseFile/${fileId}?token=${this.token}`;
      link.download = fileName;
      link.click();
    },
    
    // 删除文件
    async deleteFile(fileId) {
      if (!confirm('确定要删除此文件吗？')) {
        return;
      }
      
      try {
        const response = await axios.delete(`/api/web/deleteCaseFile/${fileId}`, {
          params: { token: this.token }
        });
        
        if (response.data.status === '1') {
          alert('文件删除成功');
          this.getFileList(); // 刷新文件列表
        } else {
          alert('文件删除失败：' + response.data.msg);
        }
      } catch (error) {
        console.error('删除文件失败', error);
        alert('删除文件失败：' + error.message);
      }
    },
    
    // 格式化文件大小
    formatFileSize(size) {
      if (size < 1024) {
        return size + ' B';
      } else if (size < 1024 * 1024) {
        return (size / 1024).toFixed(2) + ' KB';
      } else {
        return (size / (1024 * 1024)).toFixed(2) + ' MB';
      }
    }
  }
};
</script>

<style scoped>
.file-upload-container {
  max-width: 800px;
  margin: 0 auto;
  padding: 20px;
}

.upload-section {
  margin-bottom: 20px;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 5px;
}

.file-list-section {
  margin-top: 30px;
}

input[type="file"] {
  margin-right: 10px;
  margin-bottom: 10px;
}

button {
  margin: 5px;
  padding: 5px 10px;
  background-color: #4CAF50;
  color: white;
  border: none;
  border-radius: 3px;
  cursor: pointer;
}

button:hover {
  background-color: #45a049;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}

table, th, td {
  border: 1px solid #ddd;
}

th, td {
  padding: 8px;
  text-align: left;
}

th {
  background-color: #f2f2f2;
}
</style>
```

## 4. 注意事项

### 4.1 文件限制

- **单个文件大小限制**：10MB
- **支持的文件格式**：
  - 文档：.doc, .docx
  - 图片：.jpg, .png
  - PDF：.pdf
  - 表格：.xls, .xlsx

### 4.2 前端验证

在调用后端API之前，建议前端先进行验证：

```javascript
// 文件大小验证
function validateFileSize(file, maxSize = 10 * 1024 * 1024) {
    if (file.size > maxSize) {
        alert('文件大小不能超过10MB');
        return false;
    }
    return true;
}

// 文件类型验证
function validateFileType(file) {
    const allowedTypes = ['application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                          'image/jpeg', 'image/png', 'application/pdf',
                          'application/vnd.ms-excel', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'];
    
    const allowedExtensions = ['.doc', '.docx', '.jpg', '.png', '.pdf', '.xls', '.xlsx'];
    const fileName = file.name.toLowerCase();
    const fileType = file.type;
    
    if (!allowedTypes.includes(fileType) && !allowedExtensions.some(ext => fileName.endsWith(ext))) {
        alert('不支持的文件类型');
        return false;
    }
    return true;
}
```

### 4.3 错误处理

在调用API时，建议添加适当的错误处理：

```javascript
try {
    // API调用
} catch (error) {
    if (error.response) {
        // 服务器返回了错误状态码
        console.error('服务器错误：', error.response.status, error.response.data);
        alert('服务器错误：' + error.response.data.msg);
    } else if (error.request) {
        // 请求发送成功但没有收到响应
        console.error('网络错误：', error.request);
        alert('网络错误，请检查网络连接');
    } else {
        // 请求配置错误
        console.error('请求错误：', error.message);
        alert('请求错误：' + error.message);
    }
}
```

### 4.4 跨域问题

如果前端和后端部署在不同的域名下，可能会遇到跨域问题。请确保后端已经配置了CORS（跨域资源共享）。

### 4.5 进度显示

对于大文件上传，可以添加进度显示功能：

```javascript
// 使用Axios监听上传进度
const response = await axios.post('/api/web/uploadCaseFile', formData, {
    params: { token },
    headers: {
        'Content-Type': 'multipart/form-data'
    },
    onUploadProgress: (progressEvent) => {
        const percentCompleted = Math.round((progressEvent.loaded * 100) / progressEvent.total);
        console.log('上传进度：', percentCompleted + '%');
        // 更新UI显示进度
        document.getElementById('progressBar').style.width = percentCompleted + '%';
        document.getElementById('progressText').textContent = percentCompleted + '%';
    }
});
```

## 5. 浏览器兼容性

- Chrome 6+、Firefox 4+、Safari 5+、Edge 12+ 支持 `XMLHttpRequest Level 2`，可以使用 `FormData` 进行文件上传
- IE 10+ 支持文件上传功能，但建议使用 polyfill 或降级方案

## 6. 常见问题及解决方案

### 6.1 问题：文件上传时提示"请求实体过大"
解决方案：检查后端配置，确保 `spring.servlet.multipart.max-request-size` 和 `spring.servlet.multipart.max-file-size` 设置正确

### 6.2 问题：上传大文件时超时
解决方案：
- 优化网络连接
- 考虑使用分片上传（后端需支持）
- 增加服务器超时时间

### 6.3 问题：跨域请求被拒绝
解决方案：
- 确保后端配置了正确的 CORS 头
- 使用代理服务器
- 在开发环境中配置 Webpack Dev Server 代理

### 6.4 问题：文件下载时文件名乱码
解决方案：
- 确保后端正确设置了 `Content-Disposition` 头，并对文件名进行了 URL 编码
- 前端在下载时指定正确的文件名

## 7. 总结

本文档详细介绍了案件管理系统中文件上传功能的前端实现指南，包括后端API接口、前端调用示例和注意事项。前端开发人员可以根据本文档快速集成文件上传功能，实现单文件上传、批量上传、文件列表展示、文件下载和删除等功能。

在实现过程中，建议前端开发人员注意文件大小和类型的验证、错误处理、进度显示等细节，以提供良好的用户体验。如果遇到问题，可以参考本文档的常见问题及解决方案，或联系后端开发人员获取帮助。