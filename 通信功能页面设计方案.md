# 通信功能页面设计方案

## 1. 设计概述

基于Vue-Vben-Admin项目的设计规范，实现通信功能第一阶段的页面设计，包括联系人管理、实时聊天等核心功能。设计遵循项目现有的UI/UX规范，采用响应式设计，适配不同屏幕尺寸。

## 2. 页面布局设计

### 2.1 整体布局结构

通信功能采用经典的三栏/两栏布局，根据屏幕尺寸自动调整：

- **桌面端（≥1200px）**：三栏布局
  - 左侧：联系人列表（300px）
  - 中间：聊天会话列表（350px）
  - 右侧：聊天窗口（自适应剩余宽度）

- **平板端（768px-1199px）**：两栏布局
  - 左侧：联系人/会话列表（320px）
  - 右侧：聊天窗口（自适应剩余宽度）

- **移动端（<768px）**：单栏布局
  - 全屏显示当前页面，通过底部导航切换功能

### 2.2 页面布局图

```
+------------------------------------------+ 桌面端三栏布局
|                                          |
|  +-------------+  +-------------+  +-----+ |
|  |             |  |             |  |     | |
|  |  联系人列表 |  |  会话列表   |  | 聊  | |
|  |             |  |             |  | 天  | |
|  |             |  |             |  | 窗  | |
|  |             |  |             |  | 口  | |
|  |             |  |             |  |     | |
|  +-------------+  +-------------+  +-----+ |
|                                          |
+------------------------------------------+

+-------------------------------+ 平板端两栏布局
|                               |
|  +-------------+  +-----------+ |
|  |             |  |           | |
|  |  联系人/会话 |  |  聊天窗口 | |
|  |  列表        |  |           | |
|  |             |  |           | |
|  |             |  |           | |
|  |             |  |           | |
|  +-------------+  +-----------+ |
|                               |
+-------------------------------+

+-----------------+ 移动端单栏布局
|                 |
|  +-----------+  |
|  |           |  |
|  |  当前页面 |  |
|  |           |  |
|  |           |  |
|  +-----------+  |
|                 |
|  +-----------+  |
|  |  底部导航 |  |
|  +-----------+  |
|                 |
+-----------------+
```

## 3. 页面设计详情

### 3.1 聊天主页面（ChatHome.vue）

**页面路径**：`/chat`

**布局结构**：
- 顶部：页面标题、搜索栏
- 左侧：联系人列表
- 中间：聊天会话列表
- 右侧：欢迎页面或最近聊天记录

**关键组件设计**：

1. **联系人列表组件（ContactList.vue）**
   - 显示联系人列表，支持分组显示
   - 联系人项包含：头像、姓名、在线状态、最近消息预览
   - 支持搜索、筛选、排序功能
   - 支持联系人置顶

2. **会话列表组件（SessionList.vue）**
   - 显示聊天会话列表，按最后消息时间排序
   - 会话项包含：头像、姓名、最近消息、时间、未读消息数
   - 支持会话置顶、删除功能

3. **搜索栏组件（SearchBar.vue）**
   - 支持全局搜索联系人、会话、消息
   - 搜索结果实时显示
   - 支持搜索历史记录

**交互设计**：
- 点击联系人：打开聊天窗口，开始新会话
- 点击会话：打开对应聊天窗口，显示历史消息
- 支持拖拽调整各栏宽度

### 3.2 聊天详情页（ChatDetail.vue）

**页面路径**：`/chat/contact/:id`

**布局结构**：
- 顶部：联系人信息、操作按钮（返回、更多）
- 中间：消息列表区域
- 底部：消息输入区域

**关键组件设计**：

1. **聊天窗口组件（ChatWindow.vue）**
   - 包含消息列表和消息输入区域
   - 支持消息发送、接收、显示
   - 支持消息状态显示（发送中、已发送、已读）
   - 支持消息撤回功能

2. **消息列表组件（MessageList.vue）**
   - 显示聊天消息，支持滚动加载历史消息
   - 消息项包含：头像、姓名、消息内容、时间、状态
   - 支持不同类型消息的展示（文本、图片、文件）
   - 支持消息气泡样式，区分发送方和接收方

3. **消息输入组件（MessageInput.vue）**
   - 支持文本输入，表情选择
   - 支持文件上传、图片发送
   - 支持消息发送快捷键（Enter）
   - 支持消息草稿保存

**交互设计**：
- 输入消息：实时显示输入状态
- 发送消息：显示发送状态，成功后更新消息列表
- 接收消息：自动滚动到底部，显示新消息
- 支持消息长按操作（撤回、复制、删除）

### 3.3 联系人管理页（ContactManagement.vue）

**页面路径**：`/chat/contacts`

**布局结构**：
- 顶部：页面标题、操作按钮（新增联系人、导入/导出）
- 左侧：联系人分组列表
- 右侧：联系人列表、搜索栏

**关键组件设计**：

1. **联系人卡片组件（ContactCard.vue）**
   - 显示联系人基本信息
   - 包含头像、姓名、电话、邮箱等
   - 支持编辑、删除、聊天等操作按钮

2. **联系人分组组件（ContactGroup.vue）**
   - 显示联系人分组列表
   - 支持分组创建、编辑、删除
   - 支持拖拽调整分组顺序

3. **联系人列表组件（ContactList.vue）**
   - 显示联系人列表，支持分页
   - 支持按分组筛选
   - 支持批量操作（删除、移动分组）

**交互设计**：
- 点击联系人卡片：显示联系人详情
- 点击编辑按钮：进入联系人编辑页
- 点击删除按钮：弹出确认对话框，删除联系人
- 支持拖拽联系人到不同分组

### 3.4 联系人编辑页（ContactEdit.vue）

**页面路径**：`/chat/contacts/add` 或 `/chat/contacts/edit/:id`

**布局结构**：
- 顶部：页面标题、操作按钮（保存、取消）
- 中间：联系人信息表单

**关键组件设计**：

1. **联系人表单组件（ContactForm.vue）**
   - 包含姓名、电话、邮箱、头像等字段
   - 支持表单验证
   - 支持头像上传和预览

**交互设计**：
- 表单输入：实时验证字段合法性
- 保存按钮：点击后提交表单，成功后返回联系人管理页
- 取消按钮：点击后返回联系人管理页，放弃修改

## 4. 组件结构设计

```
src/views/chat/
├── components/
│   ├── ChatLayout.vue          # 聊天主布局
│   ├── ContactList.vue         # 联系人列表
│   ├── SessionList.vue         # 会话列表
│   ├── ChatWindow.vue          # 聊天窗口
│   ├── MessageList.vue         # 消息列表
│   ├── MessageInput.vue        # 消息输入框
│   ├── FileUpload.vue          # 文件上传组件
│   ├── ContactCard.vue         # 联系人卡片
│   ├── SearchBar.vue           # 搜索栏
│   └── ContactForm.vue         # 联系人表单
├── pages/
│   ├── ChatHome.vue            # 聊天主页
│   ├── ChatDetail.vue          # 聊天详情页
│   ├── ContactManagement.vue   # 联系人管理页
│   └── ContactEdit.vue         # 联系人编辑页
└── stores/
    ├── chat.ts                 # 聊天状态管理
    ├── contact.ts              # 联系人状态管理
    └── websocket.ts            # WebSocket状态管理
```

## 5. 路由设计

```typescript
const routes = [
  {
    path: '/chat',
    name: 'Chat',
    component: ChatLayout,
    meta: {
      title: '通信',
      icon: 'message',
      order: 10,
    },
    children: [
      {
        path: '',
        name: 'ChatHome',
        component: ChatHome,
        meta: {
          title: '聊天主页',
        },
      },
      {
        path: 'contact/:id',
        name: 'ChatDetail',
        component: ChatDetail,
        meta: {
          title: '聊天详情',
        },
      },
      {
        path: 'contacts',
        name: 'ContactManagement',
        component: ContactManagement,
        meta: {
          title: '联系人管理',
        },
      },
      {
        path: 'contacts/add',
        name: 'ContactAdd',
        component: ContactEdit,
        meta: {
          title: '新增联系人',
        },
      },
      {
        path: 'contacts/edit/:id',
        name: 'ContactEdit',
        component: ContactEdit,
        meta: {
          title: '编辑联系人',
        },
      },
    ],
  },
];
```

## 6. 状态管理设计

### 6.1 Chat Store

```typescript
interface ChatState {
  // 当前聊天会话
  currentContact: Contact | null;
  // 聊天会话列表
  sessions: ChatSession[];
  // 当前聊天消息
  messages: ChatMessage[];
  // WebSocket连接状态
  isConnected: boolean;
  // 未读消息总数
  totalUnread: number;
  // 消息输入状态
  typingStatus: Record<number, boolean>;
}
```

### 6.2 Contact Store

```typescript
interface ContactState {
  // 联系人列表
  contacts: Contact[];
  // 联系人分组
  groups: ContactGroup[];
  // 搜索关键词
  searchKeyword: string;
  // 选中的分组
  selectedGroup: number | null;
  // 当前编辑的联系人
  currentContact: Contact | null;
}
```

### 6.3 WebSocket Store

```typescript
interface WebSocketState {
  // 连接状态
  isConnected: boolean;
  // 重连次数
  reconnectAttempts: number;
  // 最大重连次数
  maxReconnectAttempts: number;
  // 心跳检测状态
  heartbeatStatus: boolean;
}
```

## 7. 响应式设计

### 7.1 断点设计

| 设备类型 | 屏幕宽度 | 布局模式 |
|---------|---------|---------|
| 移动端 | <768px | 单栏布局 |
| 平板端 | 768px-1199px | 两栏布局 |
| 桌面端 | ≥1200px | 三栏布局 |

### 7.2 响应式适配策略

1. **布局适配**
   - 使用CSS Grid和Flexbox实现响应式布局
   - 根据屏幕宽度调整栏数和宽度
   - 移动端使用底部导航切换功能

2. **组件适配**
   - 按钮大小、间距随屏幕宽度调整
   - 字体大小使用相对单位（rem）
   - 图片和媒体资源自适应容器大小

3. **交互适配**
   - 桌面端支持鼠标悬停效果
   - 移动端支持触摸手势
   - 弹出层位置根据屏幕大小调整

## 8. UI/UX设计规范

### 8.1 颜色方案

| 颜色类型 | 颜色值 | 用途 |
|---------|-------|------|
| 主色调 | #408AED | 按钮、链接、强调元素 |
| 辅助色 | #67C23A | 成功状态、在线状态 |
| 警告色 | #E6A23C | 警告状态、提示信息 |
| 错误色 | #F56C6C | 错误状态、删除操作 |
| 中性色 | #303133 | 主要文字 |
| 中性色 | #606266 | 次要文字 |
| 中性色 | #909399 | 辅助文字 |
| 中性色 | #C0C4CC | 边框、分割线 |
| 中性色 | #F5F7FA | 背景色 |

### 8.2 字体方案

- 主字体：PingFang SC, Microsoft YaHei, sans-serif
- 字体大小：
  - 标题：18px-24px
  - 正文：14px-16px
  - 辅助文字：12px-13px

### 8.3 间距方案

- 基础间距：8px
- 组件间距：16px
- 页面间距：24px

### 8.4 圆角方案

- 按钮、卡片：4px-8px
- 头像、消息气泡：8px-16px

## 9. 交互设计

### 9.1 页面跳转逻辑

```
+-----------------+     +-----------------+     +-----------------+
|  聊天主页面     | --> |  聊天详情页     | <-- |  联系人管理页   |
|  (ChatHome)     |     |  (ChatDetail)   |     |  (ContactManagement) |
+-----------------+     +-----------------+     +-----------------+
          ^                      |                      |
          |                      |                      v
          |                      |              +-----------------+
          |                      |              |  联系人编辑页   |
          |                      |              |  (ContactEdit)  |
          |                      |              +-----------------+
          |                      |                      ^
          |                      |                      |
          +----------------------+----------------------+
```

### 9.2 核心交互流程

1. **聊天流程**
   - 用户进入聊天主页面
   - 选择联系人或会话
   - 进入聊天详情页
   - 输入消息，发送
   - 接收消息，显示
   - 查看消息状态

2. **联系人管理流程**
   - 用户进入联系人管理页
   - 查看联系人列表
   - 点击新增联系人，进入编辑页
   - 填写联系人信息，保存
   - 返回联系人管理页，查看新增联系人

3. **WebSocket连接流程**
   - 用户登录系统
   - 自动建立WebSocket连接
   - 监听连接状态
   - 连接断开时自动重连
   - 显示连接状态提示

## 10. 性能优化

1. **组件懒加载**
   - 使用Vue Router的动态导入功能，实现组件懒加载
   - 减少初始加载时间

2. **虚拟滚动**
   - 消息列表和联系人列表使用虚拟滚动
   - 优化大量数据渲染性能

3. **图片优化**
   - 头像和图片使用懒加载
   - 图片压缩和格式优化

4. **WebSocket优化**
   - 实现心跳检测机制
   - 优化消息推送逻辑
   - 减少不必要的网络请求

## 11. 测试计划

### 11.1 单元测试
- 组件功能测试
- Store状态管理测试
- 工具函数测试

### 11.2 集成测试
- 消息收发流程测试
- WebSocket连接测试
- 联系人管理流程测试

### 11.3 E2E测试
- 完整聊天流程测试
- 多设备兼容性测试
- 异常情况处理测试

## 12. 部署计划

1. **开发环境**
   - 本地开发：使用Vite开发服务器
   - 测试环境：部署到测试服务器

2. **生产环境**
   - 构建优化：代码分割、懒加载
   - 静态资源：CDN加速
   - 性能监控：集成监控工具

## 13. 后续扩展

1. **第二阶段功能**
   - 文件上传下载
   - 图片消息支持
   - 消息撤回功能
   - 聊天记录搜索

2. **第三阶段功能**
   - 联系人分组管理
   - 聊天置顶功能
   - 消息通知优化
   - 性能优化和错误处理

## 14. 结论

本设计方案基于Vue-Vben-Admin项目的设计规范，实现了通信功能第一阶段的页面设计。设计遵循了项目现有的UI/UX规范，采用了响应式设计，适配不同屏幕尺寸。方案包括了页面布局图、关键组件设计说明以及各模块间的跳转逻辑，为后续的开发工作提供了清晰的指导。
