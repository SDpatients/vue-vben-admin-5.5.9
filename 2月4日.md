## 一、接口详细说明
### 1. 模板管理接口 1.1 创建模板
接口： POST /api/v1/document-templates

功能： 创建新的文档导出模板

请求参数：

```
{
  "templateName": "债权申报合同模板",
  "templateCode": 
  "CLAIM_CONTRACT_001",
  "templateType": "WORD",
  "description": "用于生成债权申报相关
  合同文档",
  "configJson": "{\"layout\": 
  \"A4\", \"orientation\": 
  \"portrait\"}",
  "isDefault": false,
  "fields": [
    {
      "fieldName": "caseName",
      "fieldLabel": "案件名称",
      "fieldType": "TEXT",
      "sourceField": "bankruptCase.
      caseName",
      "defaultValue": "",
      "sortOrder": 1,
      "isRequired": true,
      "formatPattern": ""
    },
    {
      "fieldName": "creditorName",
      "fieldLabel": "债权人名称",
      "fieldType": "TEXT",
      "sourceField": "creditorInfo.
      creditorName",
      "defaultValue": "",
      "sortOrder": 2,
      "isRequired": true,
      "formatPattern": ""
    },
    {
      "fieldName": "claimAmount",
      "fieldLabel": "债权金额",
      "fieldType": "NUMBER",
      "sourceField": 
      "claimRegistration.
      totalAmount",
      "defaultValue": "0.00",
      "sortOrder": 3,
      "isRequired": true,
      "formatPattern": "#,##0.00"
    },
    {
      "fieldName": "registerDate",
      "fieldLabel": "登记日期",
      "fieldType": "DATE",
      "sourceField": 
      "claimRegistration.
      createTime",
      "defaultValue": "",
      "sortOrder": 4,
      "isRequired": false,
      "formatPattern": "yyyy年MM月dd
      日"
    }
  ]
}
```
字段说明：

字段 类型 必填 说明 templateName string 是 模板名称，最多100字符 templateCode string 是 模板编码，唯一，最多50字符 templateType string 是 模板类型：WORD/EXCEL description string 否 模板描述，最多500字符 configJson string 否 前端配置JSON isDefault boolean 否 是否默认模板 fields array 否 字段映射列表

字段类型说明：

类型 说明 TEXT 文本 NUMBER 数字 DATE 日期 LIST 列表 IMAGE 图片 TABLE 表格

成功响应：

```
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "templateName": "债权申报合同模板
    ",
    "templateCode": 
    "CLAIM_CONTRACT_001",
    "templateType": "WORD",
    "description": "用于生成债权申报相
    关合同文档",
    "filePath": null,
    "configJson": "{\"layout\": 
    \"A4\", \"orientation\": 
    \"portrait\"}",
    "isDefault": false,
    "status": "ACTIVE",
    "createTime": 
    "2026-02-04T10:30:00",
    "updateTime": 
    "2026-02-04T10:30:00",
    "createUserId": 1,
    "updateUserId": 1
  }
}
``` 1.2 更新模板
接口： PUT /api/v1/document-templates/{id}

功能： 更新模板信息

请求参数：

```
{
  "id": 1,
  "templateName": "债权申报合同模板
  （更新）",
  "description": "更新后的描述",
  "configJson": "{\"layout\": 
  \"A4\", \"orientation\": 
  \"landscape\"}",
  "isDefault": true,
  "status": "ACTIVE",
  "fields": [
    {
      "fieldName": "caseName",
      "fieldLabel": "案件名称",
      "fieldType": "TEXT",
      "sourceField": "bankruptCase.
      caseName",
      "sortOrder": 1,
      "isRequired": true
    }
  ]
}
``` 1.3 删除模板
接口： DELETE /api/v1/document-templates/{id}

功能： 软删除模板

路径参数： id - 模板ID

成功响应：

```
{
  "code": 200,
  "message": "success",
  "data": null
}
``` 1.4 获取模板列表
接口： GET /api/v1/document-templates

功能： 获取所有激活的模板

成功响应：

```
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "templateName": "债权申报合同模
      板",
      "templateCode": 
      "CLAIM_CONTRACT_001",
      "templateType": "WORD",
      "description": "用于生成债权申报
      相关合同文档",
      "isDefault": true,
      "status": "ACTIVE",
      "createTime": 
      "2026-02-04T10:30:00",
      "updateTime": 
      "2026-02-04T10:30:00"
    },
    {
      "id": 2,
      "templateName": "债权人清单报表
      ",
      "templateCode": 
      "CREDITOR_LIST_001",
      "templateType": "EXCEL",
      "description": "债权人清单导出
      ",
      "isDefault": false,
      "status": "ACTIVE",
      "createTime": 
      "2026-02-04T11:00:00",
      "updateTime": 
      "2026-02-04T11:00:00"
    }
  ]
}
``` 1.5 按类型获取模板
接口： GET /api/v1/document-templates/type/{templateType}

功能： 根据类型筛选模板

路径参数： templateType - WORD 或 EXCEL

成功响应： 同上
 1.6 获取模板详情
接口： GET /api/v1/document-templates/{id}

功能： 获取单个模板详情

成功响应：

```
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "templateName": "债权申报合同模板
    ",
    "templateCode": 
    "CLAIM_CONTRACT_001",
    "templateType": "WORD",
    "description": "用于生成债权申报相
    关合同文档",
    "filePath": null,
    "configJson": "{\"layout\": 
    \"A4\"}",
    "isDefault": true,
    "status": "ACTIVE",
    "createTime": 
    "2026-02-04T10:30:00",
    "updateTime": 
    "2026-02-04T10:30:00",
    "createUserId": 1,
    "updateUserId": 1
  }
}
``` 1.7 根据编码获取模板
接口： GET /api/v1/document-templates/code/{templateCode}

功能： 根据模板编码查询

路径参数： templateCode - 模板编码
 1.8 设置默认模板
接口： POST /api/v1/document-templates/{id}/set-default

功能： 设置某类型下的默认模板

路径参数： id - 模板ID

查询参数： templateType - 模板类型（WORD/EXCEL）

成功响应：

```
{
  "code": 200,
  "message": "success",
  "data": null
}
``` 1.9 上传模板文件
接口： POST /api/v1/document-templates/{id}/upload

功能： 上传Word或Excel模板文件

路径参数： id - 模板ID

请求体： multipart/form-data

字段 类型 必填 说明 file File 是 模板文件，支持.docx或.xlsx

成功响应：

```
{
  "code": 200,
  "message": "success",
  "data": "uploads/templates/
  a1b2c3d4-e5f6-7890-abcd-ef12345678
  90.docx"
}
```
### 2. 文档导出接口 2.1 导出Word文档
接口： POST /api/v1/document-templates/{id}/export/word

功能： 根据模板导出Word文档

路径参数： id - 模板ID

请求体：

```
{
  "templateId": 1,
  "fileName": "债权申报合同",
  "data": {
    "caseName": "某某公司破产清算案",
    "creditorName": "张三",
    "claimAmount": 1500000.00,
    "registerDate": 
    "2026-02-04T10:30:00",
    "claimFacts": "债务人于2025年1月
    向债权人借款...",
    "evidenceList": [
      {"name": "借款合同", "number": 
      "HT001"},
      {"name": "转账凭证", "number": 
      "PZ002"}
    ]
  }
}
```
响应： 文件流（直接下载）

Content-Type： application/vnd.openxmlformats-officedocument.wordprocessingml.document

Content-Disposition： attachment; filename=债权申报合同_20260204103000.docx
 2.2 导出Excel表格
接口： POST /api/v1/document-templates/{id}/export/excel

功能： 根据模板导出Excel表格

路径参数： id - 模板ID

请求体：

```
{
  "templateId": 2,
  "fileName": "债权人清单",
  "data": {
    "caseName": "某某公司破产清算案",
    "exportDate": "2026-02-04",
    "creditorList": [
      {
        "creditorName": "张三",
        "creditorType": "个人",
        "claimAmount": 1000000,
        "claimNature": "普通债权"
      },
      {
        "creditorName": "某某有限公司
        ",
        "creditorType": "企业",
        "claimAmount": 5000000,
        "claimNature": "优先债权"
      }
    ]
  }
}
```
响应： 文件流（直接下载）

Content-Type： application/vnd.openxmlformats-officedocument.spreadsheetml.sheet

### 3. 导出历史接口 3.1 获取导出历史
接口： GET /api/v1/document-templates/export-history

功能： 获取当前用户的导出历史

成功响应：

```
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "templateId": 1,
      "templateName": "债权申报合同模
      板",
      "exportType": "WORD",
      "fileName": "债权申报合同
      _20260204103000.docx",
      "fileSize": 25600,
      "exportStatus": "SUCCESS",
      "exportedBy": 1,
      "exportedByName": "管理员",
      "exportedTime": 
      "2026-02-04T10:30:00",
      "processingTime": 1500,
      "createTime": 
      "2026-02-04T10:30:00"
    }
  ]
}
``` 3.2 获取指定模板的导出历史
接口： GET /api/v1/document-templates/{id}/export-history

功能： 获取某个模板的导出历史

路径参数： id - 模板ID

## 二、前端使用示例
### 2.1 创建模板（Axios示例）
```
// 创建Word模板
const createTemplate = async () => {
  const response = await axios.post
  ('/api/v1/document-templates', {
    templateName: '债权申报合同模板',
    templateCode: 
    'CLAIM_CONTRACT_001',
    templateType: 'WORD',
    description: '用于生成债权申报相关
    合同文档',
    fields: [
      {
        fieldName: 'caseName',
        fieldLabel: '案件名称',
        fieldType: 'TEXT',
        sourceField: 'bankruptCase.
        caseName',
        isRequired: true,
        sortOrder: 1
      },
      {
        fieldName: 'creditorName',
        fieldLabel: '债权人名称',
        fieldType: 'TEXT',
        sourceField: 'creditorInfo.
        creditorName',
        isRequired: true,
        sortOrder: 2
      },
      {
        fieldName: 'claimAmount',
        fieldLabel: '债权金额',
        fieldType: 'NUMBER',
        sourceField: 
        'claimRegistration.
        totalAmount',
        formatPattern: '#,##0.00',
        isRequired: true,
        sortOrder: 3
      },
      {
        fieldName: 'registerDate',
        fieldLabel: '登记日期',
        fieldType: 'DATE',
        sourceField: 
        'claimRegistration.
        createTime',
        formatPattern: 'yyyy年MM月dd
        日',
        sortOrder: 4
      }
    ]
  });
  return response.data;
};
```
### 2.2 导出Word文档
```
// 导出Word文档
const exportWord = async 
(templateId, data) => {
  const response = await axios.post(
    `/api/v1/document-templates/$
    {templateId}/export/word`,
    {
      templateId: templateId,
      fileName: '债权申报合同',
      data: {
        caseName: '某某公司破产清算案
        ',
        creditorName: '张三',
        claimAmount: 1500000.00,
        registerDate: 
        '2026-02-04T10:30:00'
      }
    },
    {
      responseType: 'blob' // 重要：
      设置响应类型为blob
    }
  );
  
  // 下载文件
  const blob = new Blob([response.
  data], {
    type: 'application/vnd.
    openxmlformats-officedocument.
    wordprocessingml.document'
  });
  const link = document.
  createElement('a');
  link.href = URL.createObjectURL
  (blob);
  link.download = '债权申报合同.
  docx';
  link.click();
};
```
### 2.3 导出Excel表格
```
// 导出Excel表格
const exportExcel = async 
(templateId, data) => {
  const response = await axios.post(
    `/api/v1/document-templates/$
    {templateId}/export/excel`,
    {
      templateId: templateId,
      fileName: '债权人清单',
      data: {
        caseName: '某某公司破产清算案
        ',
        exportDate: '2026-02-04',
        creditorList: [
          { creditorName: '张三', 
          claimAmount: 1000000 },
          { creditorName: '李四', 
          claimAmount: 2000000 }
        ]
      }
    },
    {
      responseType: 'blob'
    }
  );
  
  // 下载文件
  const blob = new Blob([response.
  data], {
    type: 'application/vnd.
    openxmlformats-officedocument.
    spreadsheetml.sheet'
  });
  const link = document.
  createElement('a');
  link.href = URL.createObjectURL
  (blob);
  link.download = '债权人清单.xlsx';
  link.click();
};
```
### 2.4 上传模板文件
```
// 上传模板文件
const uploadTemplateFile = async 
(templateId, file) => {
  const formData = new FormData();
  formData.append('file', file);
  
  const response = await axios.post(
    `/api/v1/document-templates/$
    {templateId}/upload`,
    formData,
    {
      headers: {
        'Content-Type': 'multipart/
        form-data'
      }
    }
  );
  return response.data;
};
```
## 三、注意事项
### 3.1 模板编码规范
- 模板编码必须唯一，建议使用有意义的命名，如： CLAIM_CONTRACT_001 、 CREDITOR_LIST_001
- 只能包含字母、数字、下划线
- 长度不超过50个字符
### 3.2 字段命名规范
- fieldName （占位符名称）：在Word模板中使用 {{fieldName}} 作为占位符
- sourceField （数据源字段）：对应后端数据模型的字段路径，如 bankruptCase.caseName
### 3.3 日期格式
支持的日期格式模式：

模式 示例 yyyy-MM-dd 2026-02-04 yyyy年MM月dd日 2026年02月04日 yyyy-MM-dd HH:mm:ss 2026-02-04 10:30:00 HH:mm:ss 10:30:00

### 3.4 数字格式
支持的数字格式模式：

模式 示例 #,##0.00 1,500,000.00 0.00% 85.50% ¤#,##0.00 ¥1,500,000.00

### 3.5 文件上传限制
- 支持的格式： .docx （Word）、 .xlsx （Excel）
- 不支持 .doc 和 .xls 格式
- 建议文件大小不超过 10MB
### 3.6 导出数据格式
Word模板占位符格式：

```
{{fieldName}} - 普通文本
{{#tableName}} - 表格开始
{{/tableName}} - 表格结束
{{@imageName}} - 图片
```
示例Word模板内容：

```
债权申报合同

案件名称：{{caseName}}
债权人：{{creditorName}}
申报金额：{{claimAmount}} 元
申报日期：{{registerDate}}

债权事实：
{{claimFacts}}
```
Excel模板：

- 使用 EasyExcel 的填充功能
- 在模板单元格中使用 {fieldName} 作为占位符
- 列表数据使用 {.fieldName} 格式
### 3.7 错误处理
常见错误码：

错误信息 说明 模板编码已存在 创建时使用了重复的编码 模板不存在 查询的模板ID不存在 模板类型不是Word文档 对Excel模板调用Word导出接口 只支持 .docx 和 .xlsx 格式的文件 上传了不支持的文件格式 Word导出失败 渲染或导出过程中出错

### 3.8 性能建议
- 大量数据导出时，建议使用异步导出
- 图片字段建议使用压缩后的图片
- 表格数据建议分批处理，避免内存溢出
### 3.9 安全注意事项
- 所有接口需要JWT认证
- 用户只能查看/操作自己有权限的模板
- 导出历史记录用于审计追踪
