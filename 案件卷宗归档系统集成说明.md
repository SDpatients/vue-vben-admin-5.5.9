# 案件卷宗归档系统集成说明

## 📋 概述

本文档说明如何在当前项目中集成案件卷宗归档功能。该功能基于提供的API文档，实现了完整的归档文件管理功能。

## 🗂️ 文件结构

```
apps/web-ele/src/
├── api/
│   ├── core/
│   │   ├── archive.ts          # 归档API接口
│   │   └── index.ts            # API导出（已添加archive导出）
├── router/
│   └── routes/
│       └── modules/
│           └── law.ts           # 路由配置（已添加归档路由）
└── views/
    └── law/
        └── archive-management/  # 归档管理页面
            └── index.vue
```

## 🔧 API接口说明

### 核心API文件位置
- 文件路径：`apps/web-ele/src/api/core/archive.ts`

### 可用的API函数

#### 1. 归档分类管理
```typescript
// 获取归档分类树
getCategoryTreeApi(status?: string)
```

#### 2. 归档文件管理
```typescript
// 上传归档文件
uploadArchiveFileApi(caseId: number, data: UploadArchiveRequest)

// 获取归档文件列表
getArchiveFilesApi(caseId: number, params?: ArchiveListQueryParams)

// 获取归档记录详情
getArchiveRecordApi(recordId: number)

// 更新归档记录
updateArchiveRecordApi(recordId: number, data: UpdateArchiveRequest)

// 删除归档文件
deleteArchiveRecordApi(recordId: number)

// 批量删除归档文件
batchDeleteArchiveRecordsApi(recordIds: number[])
```

#### 3. 文件操作
```typescript
// 下载归档文件
downloadArchiveFileApi(fileId: number)

// 预览归档文件
previewArchiveFileApi(fileId: number)

// 获取预览URL
getArchivePreviewUrl(fileId: number)

// 获取下载URL
getArchiveDownloadUrl(fileId: number)
```

#### 4. 统计功能
```typescript
// 获取归档文件统计
getArchiveStatisticsApi(caseId: number, categoryCode?: string, status?: string)
```

### 工具函数

```typescript
// 验证文件格式
validateFileFormat(fileName: string): boolean

// 验证文件大小
validateFileSize(fileSize: number): boolean

// 格式化文件大小
formatFileSize(bytes: number): string
```

### 常量定义

```typescript
// 访问级别映射
AccessLevelMap = {
  PUBLIC: '公开',
  INTERNAL: '内部',
  CONFIDENTIAL: '机密',
  TOP_SECRET: '绝密',
}

// 记录状态映射
RecordStatusMap = {
  ACTIVE: '激活',
  INACTIVE: '停用',
  DELETED: '删除',
}

// 支持的文件格式
SupportedFileFormats = [
  'pdf', 'doc', 'docx', 'xls', 'xlsx', 
  'ppt', 'pptx', 'jpg', 'jpeg', 'png', 
  'gif', 'bmp', 'txt'
]

// 文件大小限制
MaxFileSizeMB = 50
MaxFileSizeBytes = 52428800
```

## 🎨 页面功能说明

### 页面路径
- 路由路径：`/archive-management/:id`
- 组件路径：`apps/web-ele/src/views/law/archive-management/index.vue`

### 主要功能

#### 1. 归档分类树
- 左侧显示归档分类树
- 支持三级分类结构
- 点击分类节点可筛选文件

#### 2. 文件列表
- 表格展示归档文件列表
- 支持分页显示
- 支持多选操作
- 显示文件基本信息（归档编号、标题、分类、大小、访问级别等）

#### 3. 文件上传
- 点击"上传文件"按钮打开上传对话框
- 支持选择归档分类
- 支持设置文件标题、描述、访问级别
- 自动验证文件格式和大小
- 支持标记为机密文件

#### 4. 文件编辑
- 点击"编辑"按钮可修改文件信息
- 可修改文件标题、描述、访问级别
- 可修改机密标记

#### 5. 文件删除
- 支持单个文件删除
- 支持批量删除
- 删除前有确认提示

#### 6. 文件预览
- 点击"预览"按钮可在对话框中预览文件
- 支持常见文件格式预览

#### 7. 文件下载
- 点击"下载"按钮可下载文件
- 使用文件原始名称下载

#### 8. 搜索功能
- 支持按关键词搜索文件标题或描述
- 支持重置搜索条件

## 🚀 使用方法

### 1. 在案件详情页面添加入口

在案件详情页面（`case-detail/index.vue`）中添加跳转按钮：

```vue
<template>
  <ElButton type="primary" @click="goToArchive">
    案件卷宗归档
  </ElButton>
</template>

<script setup>
import { useRouter } from 'vue-router';

const router = useRouter();

function goToArchive() {
  const caseId = route.params.id;
  router.push(`/archive-management/${caseId}`);
}
</script>
```

### 2. 在案件管理列表中添加入口

在案件管理列表页面（`case-management/index.vue`）的操作列中添加：

```vue
<ElTableColumn label="操作" width="200">
  <template #default="{ row }">
    <ElButton type="primary" link size="small" @click="goToArchive(row.id)">
      卷宗归档
    </ElButton>
  </template>
</ElTableColumn>

<script setup>
function goToArchive(caseId: number) {
  router.push(`/archive-management/${caseId}`);
}
</script>
```

## 📊 数据结构

### 归档分类 (Category)
```typescript
interface Category {
  id: number;
  categoryCode: string;      // 分类代码，如 "0-1-1"
  categoryName: string;      // 分类名称
  parentId: number | null;   // 父级分类ID
  level: number;            // 分类层级（1-3）
  sortOrder: number;        // 排序号
  isRequired: boolean;      // 是否必填
  status: string;           // 状态
  description: string;      // 分类描述
  children?: Category[];    // 子分类
}
```

### 归档记录 (ArchiveRecord)
```typescript
interface ArchiveRecord {
  id: number;
  caseId: number;
  categoryCode: string;
  categoryName: string;
  fileId: number;
  archiveNo: string;              // 归档编号
  fileTitle: string;              // 文件标题
  fileDescription: string;        // 文件描述
  uploadUserId: number;
  uploadUserName: string;
  uploadTime: string;
  status: string;
  isConfidential: boolean;         // 是否机密
  accessLevel: string;            // 访问级别
  version: number;                // 版本号
  parentVersionId: number | null; // 父版本ID
  file: FileInfo;
}
```

### 文件信息 (FileInfo)
```typescript
interface FileInfo {
  id: number;
  originalFileName: string;  // 原始文件名
  fileSize: number;          // 文件大小（字节）
  fileExtension: string;     // 文件扩展名
  mimeType: string;          // MIME类型
}
```

## 🔐 权限说明

### 访问级别
- **PUBLIC**: 公开 - 所有人可见
- **INTERNAL**: 内部 - 系统内部用户可见
- **CONFIDENTIAL**: 机密 - 授权用户可见
- **TOP_SECRET**: 绝密 - 高级授权用户可见

### 机密标记
- 标记为机密的文件需要特殊权限才能访问
- 机密文件在列表中会有特殊标识

## ⚙️ 配置说明

### API基础URL
- 默认使用 `requestClient8085` 客户端
- 基础URL：`/api/v1`（通过Vite代理配置）

### 文件上传限制
- 支持的文件格式：pdf, doc, docx, xls, xlsx, ppt, pptx, jpg, jpeg, png, gif, bmp, txt
- 文件大小限制：50MB

### 分页配置
- 默认每页显示：10条
- 可选每页显示：10, 20, 50, 100条

## 🎯 归档分类结构

### 一级分类（6大类）
1. **零、预重整/庭外重组阶段文件(若适用)**
2. **一、法院程序文件**
3. **二、管理人履职文件**
4. **三、债权人会议文件**
5. **四、资产处置文件**
6. **五、财务文件**
7. **六、案件终结与归档**

### 二级和三级分类
每个一级分类下包含多个二级分类，每个二级分类下包含多个三级分类。完整的分类结构请参考API文档附录A。

## 📝 注意事项

1. **文件上传**
   - 上传前会自动验证文件格式和大小
   - 建议在上传前检查文件是否符合要求

2. **文件预览**
   - 预览功能依赖于浏览器对文件格式的支持
   - 某些格式可能无法在浏览器中直接预览

3. **批量操作**
   - 批量删除时请谨慎操作
   - 删除操作不可恢复

4. **访问控制**
   - 根据用户权限控制文件的访问级别
   - 机密文件需要特殊权限

## 🔍 调试建议

1. **检查API响应**
   - 使用浏览器开发者工具查看网络请求
   - 确认API返回的数据格式正确

2. **查看控制台日志**
   - 检查是否有JavaScript错误
   - 查看API请求和响应的详细信息

3. **测试文件上传**
   - 使用不同格式的文件测试
   - 测试大文件上传（接近50MB）

4. **测试权限控制**
   - 使用不同权限的用户账号测试
   - 验证访问级别控制是否生效

## 📚 相关文档

- [案件卷宗归档API汇总.md](./1月16日案件卷宗API汇总.md) - 完整的API文档
- [项目README.md](./README.md) - 项目总体说明

## 🆘 常见问题

### Q1: 上传文件时提示"不支持的文件格式"
A: 请检查文件格式是否在支持的格式列表中，支持的格式包括：pdf, doc, docx, xls, xlsx, ppt, pptx, jpg, jpeg, png, gif, bmp, txt

### Q2: 上传文件时提示"文件大小不能超过50MB"
A: 请压缩文件或分批上传，单个文件大小不能超过50MB

### Q3: 预览文件时显示空白
A: 某些文件格式可能无法在浏览器中直接预览，请尝试下载后使用本地软件打开

### Q4: 批量删除时提示"请选择要删除的文件"
A: 请先在表格中勾选要删除的文件，然后再点击批量删除按钮

### Q5: 归档分类树为空
A: 请检查后端API是否正常返回分类数据，确认网络连接正常

## 📞 技术支持

如有问题，请联系开发团队或查看项目文档。
