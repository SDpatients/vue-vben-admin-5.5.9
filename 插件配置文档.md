<!-- 功能太复杂，阅读时请配合文章后面的注意事项和文档 -->
<!-- 功能太复杂，阅读时请配合文章后面的注意事项和文档 -->
 
<template>
  <div class="fullcalendar-content">
    <!-- 自定义工具组 -->
    <button @click="switchToView('dayGridMonth')">月视图</button>
    <button @click="switchToView('timeGridWeek')">周视图</button>
    <button @click="switchToView('listDay')">日视图</button>
    <button @click="pageTurning('prev')"><</button>
    <button @click="toToday()">今天</button>
    <button @click="pageTurning('next')">></button>
    <hr>
    <!-- 其他按钮操作 -->
    <div class="fullcalendar-header">
      <span>[左侧]放你想要的东西...</span>
      <span>[右侧]放你想要的东西...</span>
    </div>
    <!-- 日历组件 -->
    <FullCalendar
    ref="FullCalendar_ref"
    :options='_data.calendarOptions'
    />
    <!-- 动态插入数据 -->
    <button @click="getMatter()">刷新</button>
    <button @click="addMatter()">[新增]待办事项</button>
    <button @click="getViewsData()">获取当前日历视图数据</button>
    <button @click="clearAllList()">重置清空日历</button>
  </div>
</template>
 
<script setup>
// vue
import { ref, reactive, onMounted } from 'vue'
 
// components
import FullCalendar from '@fullcalendar/vue3'//核心基础包
import locale from '@fullcalendar/core/locales/zh-cn'//汉化包
import dayGridPlugin from '@fullcalendar/daygrid'//视图-月
import timeGridPlugin from '@fullcalendar/timegrid'//视图-周
import listPlugin from '@fullcalendar/list'//视图-日
 
// refs
const FullCalendar_ref = ref()//日历插件
 
// data
const _data = reactive({
  // 插件配置(https://fullcalendar.io/docs#toc)
  calendarOptions: {
    locale: locale,//语言包
    plugins: [dayGridPlugin, timeGridPlugin, listPlugin],//插件
    initialView: 'dayGridMonth',//日历加载时的初始视图(我这里用月份)
    weekends: true,//是否在日历中包含星期六/星期天列
    // 日历头部按钮功能及位置
    // 这里只用到了标题,其他的全部自定义了,没用它原来的样式太丑了
    headerToolbar: { left: '', center: 'title', right: '' },
    // 事项集合(会根据键值对的start开始时间确定在日历的哪个日期上显示)
    // 更多属性请访问：https://fullcalendar.io/docs/event-object
    events: [],
    // 点击事项触发
    eventClick: (info) => {
      console.log('啥都有：', info)
      alert(`您点击了【${info.event.title}】，处理逻辑...`)
    },
    // 对事项做展示样式、逻辑等处理(最终必须return返回,否则不渲染!)
    // https://fullcalendar.io/docs/content-injection
    eventContent: (info) => {
      // 这块根据逻辑来,api非常灵活,也比较复杂
      // 可以返回html,携带class样式类等等
      // 比如,这个事件是否逾期,如果逾期则标红的需求！
      // -----------------------------------------
      // console.log('啥都有：', info)
      // 获取是否逾期标识
      let isSlippage = info.event.extendedProps.isSlippage
      // 根据逾期标识,决定是否加入 "标红的class: fullcalendar-highlight"
      // fullcalendar-items: 这个样式是由于覆盖了原来的容器,所以里面的内容和样式全需要自己写了!
      let className = isSlippage ? 'fullcalendar-items fullcalendar-highlight' : 'fullcalendar-items'
      // 利用info里的数据,自己组合要显示什么信息和html!当然组件库的也可以用!
      // info.timeText：即事项的开始时间 | info.event.title：即事项的标题
      // 根据业务来即可,需要注意各日月周视图模式下的显示即可！
      return { html: 
        `<span class="${className}" title="${info.event.title}">
          ${info.timeText} ${info.event.title}
        </span>`
      }
    },
    // 监听月周日视图切换
    viewDidMount: (info) => {
      console.log('您切换了视图', info)
    },
    // 更多配置...
  }
})
 
// onMounted
onMounted(() => {
  // 初始模拟请求接口
  // setTimeout(() => {
  //   getMatter()
  // }, 3000)
})
 
// 动态插入事项数据(新增事项)
// https://fullcalendar.io/docs/Calendar-addEvent
const addMatter = () => {
  FullCalendar_ref.value.getApi().addEvent(
    { 
      id: 99,//唯一标识
      title: '动态新增事项',//事项名称
      start: '2024-06-11T12:00:00',//开始时间
      allDay: false,//是否全天(不限时间,无需开始和结束时间)
      isSlippage: false,//[自己的额外业务数据]是否逾期
    }
  )
}
 
// 切换日历视图(mode模式名称)
const switchToView = (mode) => {
  FullCalendar_ref.value.getApi().changeView(mode)
}
 
// 定位到今天
const toToday = () => {
  FullCalendar_ref.value.getApi().today()
}
 
// 日历翻页/左右箭头(mode模式名称)
const pageTurning = (mode) => {
  if(mode == 'prev') {
    FullCalendar_ref.value.getApi().prev();
  }else{
    FullCalendar_ref.value.getApi().next();
  }
}
 
// 重置清空日历列表事项
const clearAllList = () => {
  _data.calendarOptions.events = []
}
 
// 获取当前日历视图数据(啥都有)
const getViewsData = () => {
  let ff = FullCalendar_ref.value.getApi().view
  console.log('当前日历标题(可赋值变量,放到任何位置)：', ff.getCurrentData().viewTitle)
  console.log('更多日历实例', ff.getCurrentData())
}
 
// 模拟接口获取日历列表事项
const getMatter = () => {
  // 假设ajax已获取到了数据
  _data.calendarOptions.events = [
    {
      id: 1,//唯一标识
      title: '起诉张三有限公司',//事项名称
      start: '2024-06-10T14:20:00',//开始时间
      end: '2024-06-10T18:50:00',//结束时间
      allDay: false,//是否全天(不限时间,无需开始和结束时间)
      isSlippage: false,//[自己的额外业务数据]是否逾期
      // ...更多额外参数
    },
    {
      id: 2,
      title: '发放工资',
      start: new Date(),//当前时间
      allDay: false,
      isSlippage: false,
    },
    {
      id: 3,
      title: '计算员工考勤',
      start: '2024-06-13T08:30:00',
      allDay: false,
      isSlippage: false,
    },
    {
      id: 4,
      title: '深夜手机打卡',
      start: '2024-06-13T22:20:00',
      end: '2024-06-13T23:00:00',
      allDay: false,
      isSlippage: false,
    },
    {
      id: 5,
      title: '时刻关注转账进度',
      start: '2024-06-13',
      allDay: true,
      isSlippage: false,
    },
    {
      id: 6,
      title: '起床跑步(忘了)',
      start: '2024-06-13T23:00',
      allDay: false,
      isSlippage: true,
    },
    {
      id: 7,
      title: '购置汽车',
      start: '2024-06-10T19:00:00',
      end: '2024-06-10T22:20:00',
      allDay: false,
      isSlippage: false,
    },
    {
      id: 8,
      title: '逾期特殊样式',
      start: '2024-06-15T11:00:00',
      end: '2024-06-15T12:20:00',
      allDay: false,
      isSlippage: true,
    },
    {
      id: 9,
      title: '自定义渲染逻辑',
      start: '2024-06-15T21:00:00',
      end: '2024-06-15T22:20:00',
      allDay: false,
      isSlippage: true,
    },
    {
      id: 10,
      title: '任务1',
      start: '2024-06-28',
      allDay: true,
      isSlippage: true,
    },
    {
      id: 11,
      title: '任务2',
      start: '2024-06-28',
      allDay: true,
      isSlippage: true,
    },
    {
      id: 12,
      title: '任务3',
      start: '2024-06-28',
      allDay: true,
      isSlippage: false,
    },
  ]
}
</script>
 
<style>
/* 根节点 */
.fullcalendar-content {
  width: 1000px;
  margin: 0 auto;
  cursor: pointer;
  text-align: center;
}
/* 头部弹性布局 */
.fullcalendar-header {
  display: flex;
  justify-content: space-between;
  margin-bottom: -25px;
}
/* 每个待办事项容器的样式 */
.fullcalendar-items {
  /* 文本溢出后显示... */
  overflow: hidden; 
  text-overflow: ellipsis; 
  white-space: nowrap;
  font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
}
/* 逾期事项的样式 */
.fullcalendar-highlight {
  color:red
}
 
/* ----------- 下方为覆盖组件原样式的代码 ---------------- */
/* ----------- 下方为覆盖组件原样式的代码 ---------------- */
/* ----------- 下方为覆盖组件原样式的代码 ---------------- */
 
/* 年月标题 */
.fc .fc-toolbar-title {
  /* background: red; */
  font-size: 20px;
  vertical-align: middle;
}
/* 列头单元格(周日~周六) */
.fc .fc-col-header-cell-cushion {
  /* background: red; */
  display: block;
  text-align: center;
  background: #f3f7ff;
  color: #333;
  padding: 10px 0;
}
/* 日期数字样式 */
.fc .fc-daygrid-day-number {
  font-size: 13px;
}
</style>
