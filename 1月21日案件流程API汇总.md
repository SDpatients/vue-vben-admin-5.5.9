# 1月21日案件流程API汇总

## 1. 概述

本文档描述破产案件任务管理模块的API接口，主要用于管理案件全流程的23个核心任务及其相关文件。所有接口均遵循RESTful风格，使用JSON格式进行数据交互。

## 2. 基础信息

- **Base URL**: `/api/case-tasks`
- **Content-Type**: `application/json`
- **认证方式**: Bearer Token (在请求头中携带)
- **响应格式**: 统一使用 `Result` 包装

### 统一响应格式

```json
{
  "code": 200,
  "message": "success",
  "data": {}
}
```

## 3. API接口列表

### 3.1 查询案件任务列表

**接口说明**: 根据案件ID查询该案件的所有任务，支持按状态和任务编号筛选

**请求方式**: `GET`

**接口路径**: `/api/case-tasks`

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| caseId | Long | 是 | 案件ID |
| status | String | 否 | 任务状态（IN_PROGRESS/COMPLETED/REVIEWING/SKIPPED/REJECTED） |
| taskCode | String | 否 | 任务编号（如TASK_001） |
| page | Integer | 否 | 页码，默认1 |
| size | Integer | 否 | 每页大小，默认10 |

**请求示例**:
``` 
GET /api/case-tasks?caseId=1&status=IN_PROGRESS&page=1&size=10
```

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "content": [
      {
        "id": 1,
        "caseId": 1,
        "taskCode": "TASK_001",
        "taskName": "提交破产申请材料",
        "taskDescription": "申请人",
        "status": "IN_PROGRESS",
        "fileCount": 2,
        "createTime": "2026-01-21T10:00:00",
        "updateTime": "2026-01-21T10:00:00"
      }
    ],
    "pageable": {
      "pageNumber": 0,
      "pageSize": 10,
      "sort": {
        "sorted": true,
        "unsorted": false,
        "empty": false
      }
    },
    "totalPages": 3,
    "totalElements": 23,
    "last": false,
    "first": true,
    "numberOfElements": 10,
    "size": 10,
    "number": 0,
    "empty": false
  }
}
```

**字段说明**:

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | Long | 任务ID |
| caseId | Long | 案件ID |
| taskCode | String | 任务编号（TASK_001 ~ TASK_023） |
| taskName | String | 任务名称 |
| taskDescription | String | 任务描述 |
| status | String | 任务状态 |
| fileCount | Integer | 关联文件数量 |
| createTime | DateTime | 创建时间 |
| updateTime | DateTime | 更新时间 |

---

### 3.2 查询单个任务详情

**接口说明**: 根据任务ID查询任务详细信息，包括关联的文件列表

**请求方式**: `GET`

**接口路径**: `/api/case-tasks/{id}`

**路径参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 任务ID |

**请求示例**:
```
GET /api/case-tasks/1
```

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "caseId": 1,
    "caseNumber": "（2025）破字第001号",
    "taskCode": "TASK_001",
    "taskName": "提交破产申请材料",
    "taskDescription": "需要提交破产申请书及相关证据材料",
    "status": "IN_PROGRESS",
    "files": [
      {
        "id": 1,
        "originalFileName": "破产申请书.pdf",
        "filePath": "C:\\law-upload\\CASE_TASK\\2026-01-21\\xxx.pdf",
        "fileSize": 1024000,
        "uploadTime": "2026-01-21T10:00:00",
        "uploadUserName": "张三"
      }
    ],
    "createTime": "2026-01-21T10:00:00",
    "updateTime": "2026-01-21T10:00:00"
  }
}
```

**字段说明**:

| 字段名 | 类型 | 说明 |
|--------|------|------|
| caseNumber | String | 案件编号 |
| files | Array | 关联的文件列表 |

---

### 3.3 更新任务信息

**接口说明**: 更新任务的描述和状态

**请求方式**: `PATCH`

**接口路径**: `/api/case-tasks/{id}`

**路径参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 任务ID |

**请求体**:

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| taskDescription | String | 否 | 任务描述 |
| status | String | 否 | 任务状态 |

**请求示例**:
```json
{
  "taskDescription": "任务已完成，所有材料已提交",
  "status": "COMPLETED"
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "caseId": 1,
    "taskCode": "TASK_001",
    "taskName": "提交破产申请材料",
    "taskDescription": "任务已完成，所有材料已提交",
    "status": "COMPLETED",
    "fileCount": 2,
    "createTime": "2026-01-21T10:00:00",
    "updateTime": "2026-01-21T11:00:00"
  }
}
```

---

### 3.4 批量更新任务状态

**接口说明**: 批量更新多个任务的状态

**请求方式**: `PUT`

**接口路径**: `/api/case-tasks/batch-status`

**请求体**:

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| taskIds | Array[Long] | 是 | 任务ID列表 |
| status | String | 是 | 任务状态 |

**请求示例**:
```json
{
  "taskIds": [1, 2, 3],
  "status": "COMPLETED"
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "successCount": 3,
    "failCount": 0
  }
}
```

---

### 3.5 案件任务统计

**接口说明**: 查询案件的任务统计信息，包括完成率、各状态任务数量等

**请求方式**: `GET`

**接口路径**: `/api/case-tasks/statistics/{caseId}`

**路径参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| caseId | Long | 是 | 案件ID |

**请求示例**:
```
GET /api/case-tasks/statistics/1
```

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "totalTasks": 23,
    "completedTasks": 5,
    "inProgressTasks": 10,
    "reviewingTasks": 3,
    "skippedTasks": 2,
    "rejectedTasks": 1,
    "completionRate": 21.74,
    "totalFiles": 15
  }
}
```

**字段说明**:

| 字段名 | 类型 | 说明 |
|--------|------|------|
| totalTasks | Integer | 总任务数 |
| completedTasks | Integer | 已完成任务数 |
| inProgressTasks | Integer | 进行中任务数 |
| reviewingTasks | Integer | 核审中任务数 |
| skippedTasks | Integer | 跳过任务数 |
| rejectedTasks | Integer | 被驳回任务数 |
| completionRate | Double | 完成率（百分比） |
| totalFiles | Integer | 总文件数 |

---

### 3.6 上传任务文件

**接口说明**: 为指定任务上传文件

**请求方式**: `POST`

**接口路径**: `/api/case-tasks/{taskId}/files`

**路径参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| taskId | Long | 是 | 任务ID |

**请求参数** (multipart/form-data):

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| file | File | 是 | 文件对象 |
| description | String | 否 | 文件描述 |

**请求示例**:
```
POST /api/case-tasks/1/files
Content-Type: multipart/form-data

file: [二进制文件数据]
description: 破产申请书
```

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "originalFileName": "破产申请书.pdf",
    "filePath": "C:\\law-upload\\CASE_TASK\\2026-01-21\\uuid_破产申请书.pdf",
    "fileSize": 1024000,
    "uploadTime": "2026-01-21T10:00:00"
  }
}
```

**注意事项**:
- 文件大小限制：最大50MB
- 支持的文件类型：根据系统配置
- 文件会自动按日期分类存储

---

### 3.7 查询任务文件列表

**接口说明**: 查询指定任务的所有文件

**请求方式**: `GET`

**接口路径**: `/api/case-tasks/{taskId}/files`

**路径参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| taskId | Long | 是 | 任务ID |

**请求示例**:
```
GET /api/case-tasks/1/files
```

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "originalFileName": "破产申请书.pdf",
      "filePath": "C:\\law-upload\\CASE_TASK\\2026-01-21\\xxx.pdf",
      "fileSize": 1024000,
      "uploadTime": "2026-01-21T10:00:00",
      "uploadUserName": "张三"
    },
    {
      "id": 2,
      "originalFileName": "证据材料.docx",
      "filePath": "C:\\law-upload\\CASE_TASK\\2026-01-21\\yyy.docx",
      "fileSize": 512000,
      "uploadTime": "2026-01-21T11:00:00",
      "uploadUserName": "李四"
    }
  ]
}
```

---

### 3.8 删除任务文件

**接口说明**: 删除指定任务的文件

**请求方式**: `DELETE`

**接口路径**: `/api/case-tasks/{taskId}/files/{fileId}`

**路径参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| taskId | Long | 是 | 任务ID |
| fileId | Long | 是 | 文件ID |

**请求示例**:
```
DELETE /api/case-tasks/1/files/1
```

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```

---

## 4. 任务状态枚举

| 状态值 | 状态名称 | 说明 |
|--------|----------|------|
| IN_PROGRESS | 进行中 | 任务正在进行，默认状态 |
| COMPLETED | 已完成 | 任务已完成 |
| REVIEWING | 核审中 | 任务正在审核 |
| SKIPPED | 跳过 | 任务被跳过 |
| REJECTED | 被驳回 | 任务被驳回 |

---

## 5. 23个核心任务清单

| 序号 | 任务编号 | 任务名称 | 默认描述 |
|------|----------|----------|----------|
| 1 | TASK_001 | 提交破产申请材料 | 申请人 |
| 2 | TASK_002 | 法院立案形式审查 | 法院立案庭 |
| 3 | TASK_003 | 破产原因实质审查 | 法院破产审判庭 |
| 4 | TASK_004 | 同步选任管理人 | 法院 |
| 5 | TASK_005 | 裁定受理并公告 | 法院 |
| 6 | TASK_006 | 全面接管债务人 | 管理人 |
| 7 | TASK_007 | 调查财产及经营状况 | 管理人 |
| 8 | TASK_008 | 决定合同继续履行或解除 | 管理人 |
| 9 | TASK_009 | 追收债务人财产 | 管理人 |
| 10 | TASK_010 | 通知已知债权人并公告 | 管理人 |
| 11 | TASK_011 | 接收、登记债权申报 | 管理人 |
| 12 | TASK_012 | 审查申报债权并编制债权表 | 管理人 |
| 13 | TASK_013 | 筹备第一次债权人会议 | 管理人 |
| 14 | TASK_014 | 召开会议核查债权与议决事项 | 债权人会议 |
| 15 | TASK_015 | 表决通过财产变价/分配方案 | 债权人会议、法院 |
| 16 | TASK_016 | 审查宣告破产条件 | 法院 |
| 17 | TASK_017 | 裁定宣告债务人破产 | 法院 |
| 18 | TASK_018 | 拟定并执行财产变价方案 | 管理人 |
| 19 | TASK_019 | 执行破产财产分配 | 管理人 |
| 20 | TASK_020 | 提请终结破产程序 | 管理人 |
| 21 | TASK_021 | 法院裁定并公告 | 法院 |
| 22 | TASK_022 | 办理企业注销登记 | 管理人 |
| 23 | TASK_023 | 管理人终止执行职务并归档 | 管理人 |

---

## 6. 错误码说明

| 错误码 | 说明 |
|--------|------|
| 200 | 成功 |
| 400 | 请求参数错误 |
| 401 | 未授权 |
| 403 | 无权限 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

**常见错误响应示例**:

```json
{
  "code": 404,
  "message": "案件任务不存在: 999",
  "data": null
}
```

```json
{
  "code": 400,
  "message": "无效的任务状态: INVALID_STATUS",
  "data": null
}
```

```json
{
  "code": 500,
  "message": "文件上传失败：磁盘空间不足",
  "data": null
}
```

---

## 7. 前端开发注意事项

### 7.1 分页处理
- 所有列表接口都支持分页，使用Spring Data的分页格式
- 前端需要处理 `totalElements`（总记录数）和 `totalPages`（总页数）

### 7.2 文件上传
- 使用 `multipart/form-data` 格式上传文件
- 注意文件大小限制（50MB）
- 上传前建议进行文件类型和大小校验

### 7.3 状态显示
- 使用任务状态枚举值进行状态筛选和显示
- 建议在前端维护状态到中文的映射关系

### 7.4 权限控制
- 确保用户只能访问自己有权限的案件任务
- 建议在路由守卫中进行权限校验

### 7.5 时间格式
- 所有时间字段使用ISO 8601格式（如：`2026-01-21T10:00:00`）
- 前端需要根据时区进行转换显示

### 7.6 错误处理
- 统一处理 `Result` 包装的响应
- 根据 `code` 字段判断请求是否成功
- 根据 `message` 字段显示错误提示

---

## 8. 使用示例

### 8.1 查询案件任务并显示进度

```javascript
// 1. 查询任务列表
const response = await fetch('/api/case-tasks?caseId=1&page=1&size=23');
const result = await response.json();

// 2. 查询统计信息
const statsResponse = await fetch('/api/case-tasks/statistics/1');
const stats = await statsResponse.json();

// 3. 显示进度条
const progress = (stats.data.completedTasks / stats.data.totalTasks) * 100;
console.log(`完成率: ${progress}%`);
```

### 8.2 更新任务状态

```javascript
// 更新单个任务状态
const updateTask = async (taskId, status) => {
  const response = await fetch(`/api/case-tasks/${taskId}`, {
    method: 'PATCH',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({ status })
  });
  return response.json();
};

// 批量更新任务状态
const batchUpdate = async (taskIds, status) => {
  const response = await fetch('/api/case-tasks/batch-status', {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({ taskIds, status })
  });
  return response.json();
};
```

### 8.3 上传文件

```javascript
const uploadFile = async (taskId, file) => {
  const formData = new FormData();
  formData.append('file', file);
  formData.append('description', '文件描述');

  const response = await fetch(`/api/case-tasks/${taskId}/files`, {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${token}`
    },
    body: formData
  });
  return response.json();
};
```

---

## 9. 更新日志

| 版本 | 日期 | 说明 |
|------|------|------|
| 1.0 | 2026-01-21 | 初始版本，完成案件任务管理模块API |

---

## 10. 联系方式

如有API使用问题，请联系后端开发团队。
