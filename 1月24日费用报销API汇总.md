# 费用报销API汇总

> 文档版本: v1.0  
> 更新日期: 2026-01-24  
> 适用对象: 前端开发人员

---

## 目录

1. [创建报销单](#1-创建报销单)
2. [查询报销单详情](#2-查询报销单详情)
3. [查询报销单列表](#3-查询报销单列表)
4. [更新报销单](#4-更新报销单)
5. [删除报销单](#5-删除报销单)
6. [审批报销单](#6-审批报销单)
7. [添加报销明细](#7-添加报销明细)
8. [删除报销明细](#8-删除报销明细)
9. [上传报销附件](#9-上传报销附件)
10. [删除报销附件](#10-删除报销附件)

---

## 通用说明

### 基础URL

```
http://your-domain
```

### 请求头

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Content-Type | String | 是 | application/json |
| Authorization | String | 是 | Bearer {token} |

### 通用响应格式

所有接口返回统一的JSON格式：

```json
{
  "code": 200,
  "message": "success",
  "data": {}
}
```

### 状态码说明

| 状态码 | 说明 |
|--------|------|
| 200 | 请求成功 |
| 400 | 请求参数错误 |
| 401 | 未授权 |
| 403 | 禁止访问 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

### 错误码说明

| 错误码 | 错误信息 | 说明 |
|--------|----------|------|
| EXPENSE_001 | 案件不存在 | 指定的案件ID不存在 |
| EXPENSE_002 | 银行账户不存在 | 指定的银行账户ID不存在 |
| EXPENSE_003 | 报销金额不能为负数 | 报销金额必须大于0 |
| EXPENSE_004 | 报销单不存在 | 指定的报销单ID不存在 |
| EXPENSE_005 | 报销单已审批，不能修改 | 报销单已审批，只能查看 |
| EXPENSE_006 | 附件上传失败 | 文件上传失败，请检查文件格式和大小 |

---

## 1. 创建报销单

### 接口信息

- **请求路径**: `/expense-reimbursement`
- **请求方法**: `POST`
- **接口描述**: 创建新的费用报销单

### 请求参数

#### 请求体参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| caseId | Long | 是 | 案件ID |
| fundAccountId | Long | 是 | 律师银行账户ID |
| reimbursementDate | String | 是 | 报销日期，格式：yyyy-MM-dd |
| description | String | 否 | 报销说明，最大500字符 |
| items | Array | 是 | 报销明细列表，至少包含1条 |

#### items参数说明

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| itemName | String | 是 | 费用名称，最大100字符 |
| itemAmount | BigDecimal | 是 | 费用金额，必须大于0 |
| itemDescription | String | 否 | 费用说明，最大500字符 |

#### 请求示例

```json
{
  "caseId": 1,
  "fundAccountId": 1,
  "reimbursementDate": "2026-01-24",
  "description": "差旅费报销",
  "items": [
    {
      "itemName": "交通费",
      "itemAmount": 500.00,
      "itemDescription": "往返高铁票"
    },
    {
      "itemName": "住宿费",
      "itemAmount": 800.00,
      "itemDescription": "酒店住宿2晚"
    }
  ]
}
```

### 成功响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "reimbursementId": 1
  }
}
```

### 失败响应示例

```json
{
  "code": 400,
  "message": "案件不存在",
  "data": null
}
```

---

## 2. 查询报销单详情

### 接口信息

- **请求路径**: `/expense-reimbursement/{id}`
- **请求方法**: `GET`
- **接口描述**: 根据报销单ID获取详细信息

### 请求参数

#### 路径参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 报销单ID |

#### 请求示例

```http
GET /expense-reimbursement/1
```

### 成功响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "reimbursementNumber": "BX202601240001",
    "caseId": 1,
    "caseName": "某某破产清算案",
    "applicantId": 10,
    "applicantName": "张律师",
    "fundAccountId": 1,
    "fundAccountName": "张律师账户",
    "bankName": "中国工商银行",
    "bankAccount": "6222021234567890",
    "totalAmount": 1300.00,
    "reimbursementDate": "2026-01-24",
    "description": "差旅费报销",
    "approvalStatus": "PENDING",
    "approverId": null,
    "approverName": null,
    "approvalTime": null,
    "approvalOpinion": null,
    "createTime": "2026-01-24 10:00:00",
    "updateTime": "2026-01-24 10:00:00",
    "items": [
      {
        "id": 1,
        "reimbursementId": 1,
        "itemName": "交通费",
        "itemAmount": 500.00,
        "itemDescription": "往返高铁票",
        "sortOrder": 1
      },
      {
        "id": 2,
        "reimbursementId": 1,
        "itemName": "住宿费",
        "itemAmount": 800.00,
        "itemDescription": "酒店住宿2晚",
        "sortOrder": 2
      }
    ],
    "attachments": [
      {
        "id": 1,
        "reimbursementId": 1,
        "fileName": "高铁票.jpg",
        "filePath": "/uploads/expense/2026/01/24/xxx.jpg",
        "fileSize": 102400,
        "fileType": "image/jpeg",
        "uploadTime": "2026-01-24 10:00:00",
        "sortOrder": 0
      }
    ]
  }
}
```

### 失败响应示例

```json
{
  "code": 404,
  "message": "报销单不存在",
  "data": null
}
```

---

## 3. 查询报销单列表

### 接口信息

- **请求路径**: `/expense-reimbursement`
- **请求方法**: `GET`
- **接口描述**: 分页查询报销单列表，支持多条件筛选

### 请求参数

#### 查询参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | Integer | 否 | 页码，默认1 |
| size | Integer | 否 | 每页大小，默认10 |
| caseId | Long | 否 | 案件ID |
| applicantId | Long | 否 | 申请人ID |
| approvalStatus | String | 否 | 审批状态：PENDING-待审批, APPROVED-已通过, REJECTED-已拒绝 |
| reimbursementDate | String | 否 | 报销日期，格式：yyyy-MM-dd |

#### 请求示例

```http
GET /expense-reimbursement?page=1&size=10&caseId=1&approvalStatus=PENDING
```

### 成功响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 100,
    "list": [
      {
        "id": 1,
        "reimbursementNumber": "BX202601240001",
        "caseId": 1,
        "caseName": "某某破产清算案",
        "applicantId": 10,
        "applicantName": "张律师",
        "fundAccountId": 1,
        "fundAccountName": "张律师账户",
        "bankName": "中国工商银行",
        "bankAccount": "6222021234567890",
        "totalAmount": 1300.00,
        "reimbursementDate": "2026-01-24",
        "description": "差旅费报销",
        "approvalStatus": "PENDING",
        "approverId": null,
        "approverName": null,
        "approvalTime": null,
        "approvalOpinion": null,
        "createTime": "2026-01-24 10:00:00",
        "updateTime": "2026-01-24 10:00:00",
        "items": [],
        "attachments": []
      }
    ]
  }
}
```

---

## 4. 更新报销单

### 接口信息

- **请求路径**: `/expense-reimbursement/{id}`
- **请求方法**: `PUT`
- **接口描述**: 更新报销单信息（仅待审批状态可更新）

### 请求参数

#### 路径参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 报销单ID |

#### 请求体参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| caseId | Long | 是 | 案件ID |
| fundAccountId | Long | 是 | 律师银行账户ID |
| reimbursementDate | String | 是 | 报销日期，格式：yyyy-MM-dd |
| description | String | 否 | 报销说明，最大500字符 |

#### 请求示例

```json
{
  "caseId": 1,
  "fundAccountId": 1,
  "reimbursementDate": "2026-01-25",
  "description": "差旅费报销（更新）"
}
```

### 成功响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```

### 失败响应示例

```json
{
  "code": 400,
  "message": "报销单已审批，不能修改",
  "data": null
}
```

---

## 5. 删除报销单

### 接口信息

- **请求路径**: `/expense-reimbursement/{id}`
- **请求方法**: `DELETE`
- **接口描述**: 删除报销单（仅待审批状态可删除）

### 请求参数

#### 路径参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 报销单ID |

#### 请求示例

```http
DELETE /expense-reimbursement/1
```

### 成功响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```

### 失败响应示例

```json
{
  "code": 400,
  "message": "报销单已审批，不能删除",
  "data": null
}
```

---

## 6. 审批报销单

### 接口信息

- **请求路径**: `/expense-reimbursement/{id}/approve`
- **请求方法**: `POST`
- **接口描述**: 审批报销单

### 请求参数

#### 路径参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 报销单ID |

#### 请求体参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| approvalStatus | String | 是 | 审批状态：APPROVED-已通过, REJECTED-已拒绝 |
| approvalOpinion | String | 否 | 审批意见，最大500字符 |

#### 请求示例

```json
{
  "approvalStatus": "APPROVED",
  "approvalOpinion": "同意报销"
}
```

### 成功响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```

### 失败响应示例

```json
{
  "code": 400,
  "message": "报销单已审批",
  "data": null
}
```

---

## 7. 添加报销明细

### 接口信息

- **请求路径**: `/expense-reimbursement/{id}/items`
- **请求方法**: `POST`
- **接口描述**: 为报销单添加费用明细（仅待审批状态可添加）

### 请求参数

#### 路径参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 报销单ID |

#### 请求体参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| itemName | String | 是 | 费用名称，最大100字符 |
| itemAmount | BigDecimal | 是 | 费用金额，必须大于0 |
| itemDescription | String | 否 | 费用说明，最大500字符 |

#### 请求示例

```json
{
  "itemName": "餐饮费",
  "itemAmount": 200.00,
  "itemDescription": "工作餐"
}
```

### 成功响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "itemId": 3
  }
}
```

### 失败响应示例

```json
{
  "code": 400,
  "message": "报销单已审批，不能添加明细",
  "data": null
}
```

---

## 8. 删除报销明细

### 接口信息

- **请求路径**: `/expense-reimbursement/{id}/items/{itemId}`
- **请求方法**: `DELETE`
- **接口描述**: 删除报销单的费用明细（仅待审批状态可删除）

### 请求参数

#### 路径参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 报销单ID |
| itemId | Long | 是 | 明细ID |

#### 请求示例

```http
DELETE /expense-reimbursement/1/items/3
```

### 成功响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```

### 失败响应示例

```json
{
  "code": 400,
  "message": "报销单已审批，不能删除明细",
  "data": null
}
```

---

## 9. 上传报销附件

### 接口信息

- **请求路径**: `/expense-reimbursement/{id}/attachments`
- **请求方法**: `POST`
- **接口描述**: 上传报销单附件（仅待审批状态可上传）

### 请求参数

#### 路径参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 报销单ID |

#### 表单参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| file | File | 是 | 上传的文件 |

#### 文件要求

- 支持的文件格式：jpg、jpeg、png、gif、pdf、doc、docx、xls、xlsx
- 文件大小限制：单个文件不超过10MB

#### 请求示例

```http
POST /expense-reimbursement/1/attachments
Content-Type: multipart/form-data

file: [binary data]
```

### 成功响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "attachmentId": 1,
    "filePath": "/uploads/expense/2026/01/24/uuid_高铁票.jpg"
  }
}
```

### 失败响应示例

```json
{
  "code": 400,
  "message": "报销单已审批，不能上传附件",
  "data": null
}
```

---

## 10. 删除报销附件

### 接口信息

- **请求路径**: `/expense-reimbursement/{id}/attachments/{attachmentId}`
- **请求方法**: `DELETE`
- **接口描述**: 删除报销单附件（仅待审批状态可删除）

### 请求参数

#### 路径参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 报销单ID |
| attachmentId | Long | 是 | 附件ID |

#### 请求示例

```http
DELETE /expense-reimbursement/1/attachments/1
```

### 成功响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```

### 失败响应示例

```json
{
  "code": 400,
  "message": "报销单已审批，不能删除附件",
  "data": null
}
```

---

## 附录

### 审批状态说明

| 状态值 | 说明 |
|--------|------|
| PENDING | 待审批 |
| APPROVED | 已通过 |
| REJECTED | 已拒绝 |

### 报销单号生成规则

格式：BX + YYYYMMDD + 4位序号

示例：BX202601240001

生成逻辑：
1. 获取当前日期：YYYYMMDD
2. 查询当天已创建的报销单数量
3. 生成4位序号（不足4位前面补0）
4. 拼接生成报销单号

### 数据权限说明

- 律师只能查看和编辑自己创建的报销单
- 审批人可以查看所有待审批的报销单
- 管理员可以查看所有报销单

### 注意事项

1. 报销单审批后不能修改、删除、添加明细和附件
2. 报销单号由系统自动生成，无需手动输入
3. 总金额由系统根据明细自动计算，无需手动输入
4. 附件上传后会自动关联到对应的报销单
5. 删除报销单时会级联删除相关的明细和附件

---

## 版本历史

| 版本 | 日期 | 描述 |
|------|------|------|
| 1.0 | 2026-01-24 | 初始版本，完成费用报销API设计 |
