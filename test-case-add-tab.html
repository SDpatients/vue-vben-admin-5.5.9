<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试案件添加标签页问题</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
        }
        .code {
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .highlight {
            background-color: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
        }
        .success {
            color: green;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>案件添加标签页问题分析</h1>
        
        <div class="section">
            <h2>问题描述</h2>
            <p>案件添加页面的标签栏不显示“案件添加”标签页。</p>
        </div>
        
        <div class="section">
            <h2>路由配置检查</h2>
            <h3>1. 案件添加路由配置</h3>
            <div class="code">
                {
                    name: 'LawCaseAdd',
                    path: '/case-add',
                    component: () => import('#/views/law/case-add/index.vue'),
                    meta: {
                        affixTab: false,
                        icon: 'lucide:plus',
                        title: $t('page.law.caseAdd'),
                        hideInMenu: true,
                        <span class="highlight">// hideInTab 未设置，默认为 false</span>
                    },
                }
            </div>
            <p class="success">✅ 路由配置中没有设置 hideInTab: true，应该显示标签页</p>
            
            <h3>2. 父路由配置</h3>
            <div class="code">
                {
                    meta: {
                        icon: 'lucide:scale',
                        order: 2,
                        title: $t('page.law.title'),
                        roles: ['USER'],
                        <span class="highlight">// hideInTab 未设置，默认为 false</span>
                    },
                    name: 'Law',
                    path: '/law',
                    children: [
                        // 子路由包括案件添加
                    ],
                }
            </div>
            <p class="success">✅ 父路由没有设置 hideInTab: true，不会影响子路由标签页显示</p>
        </div>
        
        <div class="section">
            <h2>标签页显示逻辑</h2>
            <div class="code">
                function isTabShown(tab: TabDefinition) {
                    const matched = tab?.matched ?? [];
                    return !tab.meta.hideInTab && matched.every((item) => !item.meta.hideInTab);
                }
            </div>
            <p>这个函数检查：</p>
            <ol>
                <li>当前路由的 meta.hideInTab 是否为 false（或未设置）</li>
                <li>所有匹配的路由（matched 数组）的 meta.hideInTab 是否都为 false</li>
            </ol>
        </div>
        
        <div class="section">
            <h2>可能的问题</h2>
            <h3>1. 路由路径配置问题</h3>
            <p>案件添加路由路径是 <span class="highlight">/case-add</span>，而父路由是 <span class="highlight">/law</span>，这种配置可能导致路由匹配出现问题。</p>
            
            <h3>2. 路由匹配问题</h3>
            <p>当访问 /case-add 时，Vue Router 可能不会正确匹配到 /law 父路由，导致 matched 数组不包含父路由，或者包含了其他路由。</p>
            
            <h3>3. 组件内部影响</h3>
            <p>案件添加页面组件可能在内部修改了路由元信息或标签页状态。</p>
        </div>
        
        <div class="section">
            <h2>解决方案</h2>
            <p>根据以上分析，最可能的问题是路由路径配置问题。建议修改案件添加路由的路径，使其正确嵌套在父路由下：</p>
            <div class="code">
                {
                    name: 'LawCaseAdd',
                    path: 'case-add', <span class="highlight">// 去掉前面的斜杠，使其成为相对路径</span>
                    component: () => import('#/views/law/case-add/index.vue'),
                    meta: {
                        affixTab: false,
                        icon: 'lucide:plus',
                        title: $t('page.law.caseAdd'),
                        hideInMenu: true,
                    },
                }
            </div>
            <p>或者修改为绝对路径，但包含父路由：</p>
            <div class="code">
                {
                    name: 'LawCaseAdd',
                    path: '/law/case-add', <span class="highlight">// 添加父路由前缀</span>
                    component: () => import('#/views/law/case-add/index.vue'),
                    meta: {
                        affixTab: false,
                        icon: 'lucide:plus',
                        title: $t('page.law.caseAdd'),
                        hideInMenu: true,
                    },
                }
            </div>
        </div>
    </div>
</body>
</html>