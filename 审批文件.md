# 审批模块数据库设计

本文档包含案件审批和文书审批模块的MySQL数据表设计。

## 数据表设计

### 1. 案件审批表 (case_approval)

存储案件审批相关信息，包含附件数据。

```sql
-- 创建案件审批表
CREATE TABLE `case_approval` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '案件审批ID',
  `case_number` VARCHAR(100) NOT NULL COMMENT '案号',
  `case_title` VARCHAR(200) NOT NULL COMMENT '案件标题',
  `case_type` VARCHAR(20) NOT NULL COMMENT '案件类型：contract-合同纠纷，labor-劳动争议，property-房产纠纷，tort-侵权纠纷，family-婚姻家庭，other-其他',
  `submitter` VARCHAR(50) NOT NULL COMMENT '提交人',
  `submit_time` DATETIME NOT NULL COMMENT '提交时间',
  `approval_time` DATETIME DEFAULT NULL COMMENT '审批时间',
  `status` VARCHAR(10) NOT NULL DEFAULT 'pending' COMMENT '审批状态：pending-待审批，approved-已通过，rejected-已驳回',
  `priority` VARCHAR(10) NOT NULL DEFAULT 'medium' COMMENT '优先级：high-高，medium-中，low-低',
  `description` TEXT COMMENT '案件描述',
  `remark` TEXT COMMENT '审批意见',
  `approver` VARCHAR(50) DEFAULT NULL COMMENT '审批人',
  `attachments` JSON DEFAULT NULL COMMENT '附件列表，存储多个附件信息，格式：[{"file_name": "文件名", "file_size": 大小, "file_type": "类型", "file_path": "路径", "upload_time": "上传时间", "uploader": "上传人"}]',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_case_number` (`case_number`),
  KEY `idx_status` (`status`),
  KEY `idx_case_type` (`case_type`),
  KEY `idx_priority` (`priority`),
  KEY `idx_submit_time` (`submit_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='案件审批表';
```

### 2. 文书审批表 (document_approval)

存储文书审批相关信息，包含附件数据。

```sql
-- 创建文书审批表
CREATE TABLE `document_approval` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '文书审批ID',
  `document_title` VARCHAR(200) NOT NULL COMMENT '文书标题',
  `document_type` VARCHAR(20) NOT NULL COMMENT '文书类型：complaint-起诉状，defense-答辩状，evidence-证据清单，legal_opinion-法律意见书，other-其他',
  `content` TEXT NOT NULL COMMENT '文书内容',
  `submitter` VARCHAR(50) NOT NULL COMMENT '提交人',
  `submit_time` DATETIME NOT NULL COMMENT '提交时间',
  `approval_time` DATETIME DEFAULT NULL COMMENT '审批时间',
  `status` VARCHAR(10) NOT NULL DEFAULT 'pending' COMMENT '审批状态：pending-待审批，approved-已通过，rejected-已驳回',
  `remark` TEXT COMMENT '审批意见',
  `approver` VARCHAR(50) DEFAULT NULL COMMENT '审批人',
  `attachments` JSON DEFAULT NULL COMMENT '附件列表，存储多个附件信息，格式：[{"file_name": "文件名", "file_size": 大小, "file_type": "类型", "file_path": "路径", "upload_time": "上传时间", "uploader": "上传人"}]',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_status` (`status`),
  KEY `idx_document_type` (`document_type`),
  KEY `idx_submit_time` (`submit_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='文书审批表';
```

## 索引说明

### 案件审批表索引
- `uk_case_number`: 案号唯一索引，确保案号不重复
- `idx_status`: 审批状态索引，用于按状态查询
- `idx_case_type`: 案件类型索引，用于按类型筛选
- `idx_priority`: 优先级索引，用于按优先级排序
- `idx_submit_time`: 提交时间索引，用于按时间排序

### 文书审批表索引
- `idx_status`: 审批状态索引，用于按状态查询
- `idx_document_type`: 文书类型索引，用于按类型筛选
- `idx_submit_time`: 提交时间索引，用于按时间排序

## 字段说明

### 案件审批表字段说明
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键ID |
| case_number | VARCHAR(100) | 案号，唯一标识 |
| case_title | VARCHAR(200) | 案件标题 |
| case_type | VARCHAR(20) | 案件类型枚举值 |
| submitter | VARCHAR(50) | 提交人姓名 |
| submit_time | DATETIME | 提交时间 |
| approval_time | DATETIME | 审批时间，未审批时为NULL |
| status | VARCHAR(10) | 审批状态：pending/approved/rejected |
| priority | VARCHAR(10) | 优先级：high/medium/low |
| description | TEXT | 案件描述 |
| remark | TEXT | 审批意见 |
| approver | VARCHAR(50) | 审批人姓名 |
| attachments | JSON | 附件列表，存储多个附件信息，格式：[{"file_name": "文件名", "file_size": 大小, "file_type": "类型", "file_path": "路径", "upload_time": "上传时间", "uploader": "上传人"}] |
| create_time | DATETIME | 创建时间 |
| update_time | DATETIME | 更新时间 |

### 文书审批表字段说明
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键ID |
| document_title | VARCHAR(200) | 文书标题 |
| document_type | VARCHAR(20) | 文书类型枚举值 |
| content | TEXT | 文书内容 |
| submitter | VARCHAR(50) | 提交人姓名 |
| submit_time | DATETIME | 提交时间 |
| approval_time | DATETIME | 审批时间，未审批时为NULL |
| status | VARCHAR(10) | 审批状态：pending/approved/rejected |
| remark | TEXT | 审批意见 |
| approver | VARCHAR(50) | 审批人姓名 |
| attachments | JSON | 附件列表，存储多个附件信息，格式：[{"file_name": "文件名", "file_size": 大小, "file_type": "类型", "file_path": "路径", "upload_time": "上传时间", "uploader": "上传人"}] |
| create_time | DATETIME | 创建时间 |
| update_time | DATETIME | 更新时间 |

## 使用示例

### 插入案件审批数据（含附件）
```sql
INSERT INTO `case_approval` (
  `case_number`, 
  `case_title`, 
  `case_type`, 
  `submitter`, 
  `submit_time`, 
  `status`, 
  `priority`, 
  `description`,
  `attachments`
) VALUES (
  'CASE-2026-0001',
  '张三诉李四合同纠纷案',
  'contract',
  '王律师',
  '2026-01-07 14:30:00',
  'pending',
  'high',
  '张三与李四签订的买卖合同存在违约行为，要求赔偿损失...',
  '[{"file_name": "合同原件.pdf", "file_size": 1234567, "file_type": "pdf", "file_path": "/uploads/contract.pdf", "upload_time": "2026-01-07 14:25:00", "uploader": "王律师"}, {"file_name": "付款凭证.jpg", "file_size": 890123, "file_type": "jpg", "file_path": "/uploads/payment.jpg", "upload_time": "2026-01-07 14:26:00", "uploader": "王律师"}]'
);
```

### 插入文书审批数据（含附件）
```sql
INSERT INTO `document_approval` (
  `document_title`, 
  `document_type`, 
  `content`, 
  `submitter`, 
  `submit_time`, 
  `status`,
  `attachments`
) VALUES (
  '张三起诉状',
  'complaint',
  '张三因合同纠纷起诉李四，要求赔偿损失...',
  '李四',
  '2026-01-07 14:30:00',
  'pending',
  '[{"file_name": "起诉状正文.docx", "file_size": 456789, "file_type": "docx", "file_path": "/uploads/complaint.docx", "upload_time": "2026-01-07 14:27:00", "uploader": "李四"}]'
);
```

### 更新案件审批状态
```sql
UPDATE `case_approval` 
SET 
  `status` = 'approved',
  `approval_time` = '2026-01-07 18:30:00',
  `approver` = '张法官',
  `remark` = '材料齐全，符合审批条件'
WHERE `id` = 1;
```

### 查询待审批的案件
```sql
SELECT 
  `id`,
  `case_number`,
  `case_title`,
  `case_type`,
  `submitter`,
  `submit_time`,
  `priority`,
  `description`,
  `attachments`
FROM `case_approval`
WHERE `status` = 'pending'
ORDER BY `priority` DESC, `submit_time` ASC;
```

### 查询待审批的文书
```sql
SELECT 
  `id`,
  `document_title`,
  `document_type`,
  `content`,
  `submitter`,
  `submit_time`,
  `attachments`
FROM `document_approval`
WHERE `status` = 'pending'
ORDER BY `submit_time` ASC;
```

### 统计审批数据
```sql
-- 案件审批统计
SELECT 
  `status`,
  COUNT(*) as count
FROM `case_approval`
GROUP BY `status`;

-- 文书审批统计
SELECT 
  `status`,
  COUNT(*) as count
FROM `document_approval`
GROUP BY `status`;
```
