## 前端调用文档

### 接口信息

**接口地址**：`POST /document-delivery/with-files`

**功能描述**：创建文书送达记录并同时上传附件文件，在一个事务中完成所有操作。

### 请求参数

#### 方式1：FormData 方式（推荐）

```javascript
const formData = new FormData();

// 必填参数
formData.append('caseId', 123);                    // 案件ID（必填）
formData.append('documentName', '送达通知书');      // 文书名称（必填）
formData.append('recipientName', '张三');          // 受送达人（必填）

// 可选参数
formData.append('documentType', 'NOTICE');         // 文书类型
formData.append('recipientType', 'DEBTOR');        // 受送达人类型
formData.append('contactPhone', '13800138000');    // 联系电话
formData.append('deliveryAddress', '北京市朝阳区...'); // 送达地址
formData.append('deliveryMethod', 'POST');         // 送达方式
formData.append('deliveryContent', '<p>送达内容</p >'); // 送达内容（富文本）
formData.append('sendStatus', 'PENDING');          // 发送状态
formData.append('status', 'PENDING');              // 状态

// 文件列表（必填）
formData.append('files', fileObject1);             // 文件对象1
formData.append('files', fileObject2);             // 文件对象2

// 文件描述列表（可选，与文件一一对应）
formData.append('fileDescriptions', '文件1描述');  // 文件1的描述
formData.append('fileDescriptions', '文件2描述');  // 文件2的描述

// 发送请求
const response = await axios.post('/document-delivery/with-files', formData, {
  headers: {
    'Content-Type': 'multipart/form-data'
  }
});
```

#### 方式2：Axios 完整示例

```javascript
import axios from 'axios';

async function createDocumentDeliveryWithFiles(formData) {
  try {
    const response = await axios.post('/document-delivery/with-files', formData, {
      headers: {
        'Content-Type': 'multipart/form-data'
      },
      timeout: 60000  // 设置超时时间为60秒，因为涉及文件上传
    });
    
    return response.data;
  } catch (error) {
    console.error('创建文书送达失败:', error);
    throw error;
  }
}

// 使用示例
async function handleSubmit() {
  // 获取表单数据
  const caseId = document.getElementById('caseId').value;
  const documentName = document.getElementById('documentName').value;
  const recipientName = document.getElementById('recipientName').value;
  
  // 获取文件
  const fileInput = document.getElementById('fileInput');
  const files = Array.from(fileInput.files);
  
  if (files.length === 0) {
    alert('请至少选择一个文件');
    return;
  }
  
  // 构建FormData
  const formData = new FormData();
  formData.append('caseId', caseId);
  formData.append('documentName', documentName);
  formData.append('recipientName', recipientName);
  
  // 添加文件
  files.forEach(file => {
    formData.append('files', file);
  });
  
  // 添加可选参数
  const documentType = document.getElementById('documentType').value;
  if (documentType) {
    formData.append('documentType', documentType);
  }
  
  // 发送请求
  const result = await createDocumentDeliveryWithFiles(formData);
  
  if (result.code === 200) {
    console.log('创建成功:', result.data);
    alert(`文书送达创建成功！送达ID: ${result.data.deliveryId}`);
    
    // 显示上传的文件信息
    result.data.files.forEach(file => {
      console.log(`文件ID: ${file.fileId}, 文件名: ${file.originalFileName}`);
    });
  } else {
    alert('创建失败: ' + result.message);
  }
}
```

#### 方式3：Vue3 + Element Plus 示例

```vue
<template>
  <el-form :model="form" label-width="120px">
    <el-form-item label="案件ID" required>
      <el-input v-model="form.caseId" placeholder="请输入案件ID" />
    </el-form-item>
    
    <el-form-item label="文书名称" required>
      <el-input v-model="form.documentName" placeholder="请输入文书名称" />
    </el-form-item>
    
    <el-form-item label="受送达人" required>
      <el-input v-model="form.recipientName" placeholder="请输入受送达人" />
    </el-form-item>
    
    <el-form-item label="文书类型">
      <el-select v-model="form.documentType" placeholder="请选择文书类型">
        <el-option label="法院通知" value="COURT_NOTICE" />
        <el-option label="判决书" value="JUDGMENT" />
        <el-option label="裁定书" value="VERDICT" />
        <el-option label="通知书" value="NOTICE" />
        <el-option label="其他" value="OTHER" />
      </el-select>
    </el-form-item>
    
    <el-form-item label="受送达人类型">
      <el-select v-model="form.recipientType" placeholder="请选择受送达人类型">
        <el-option label="债务人" value="DEBTOR" />
        <el-option label="债权人" value="CREDITOR" />
        <el-option label="律师" value="LAWYER" />
        <el-option label="法院" value="COURT" />
        <el-option label="其他" value="OTHER" />
      </el-select>
    </el-form-item>
    
    <el-form-item label="送达方式">
      <el-select v-model="form.deliveryMethod" placeholder="请选择送达方式">
        <el-option label="邮寄" value="POST" />
        <el-option label="邮件" value="EMAIL" />
        <el-option label="快递" value="EXPRESS" />
        <el-option label="当面送达" value="IN_PERSON" />
        <el-option label="电子送达" value="ELECTRONIC" />
        <el-option label="其他" value="OTHER" />
      </el-select>
    </el-form-item>
    
    <el-form-item label="联系电话">
      <el-input v-model="form.contactPhone" placeholder="请输入联系电话" />
    </el-form-item>
    
    <el-form-item label="送达地址">
      <el-input v-model="form.deliveryAddress" placeholder="请输入送达地址" />
    </el-form-item>
    
    <el-form-item label="送达内容">
      <el-input 
        v-model="form.deliveryContent" 
        type="textarea" 
        :rows="4"
        placeholder="请输入送达内容" 
      />
    </el-form-item>
    
    <el-form-item label="附件文件" required>
      <el-upload
        v-model:file-list="fileList"
        :auto-upload="false"
        :on-change="handleFileChange"
        multiple
        :limit="10"
      >
        <el-button type="primary">选择文件</el-button>
        <template #tip>
          <div class="el-upload__tip">
            支持上传多个文件，单个文件不超过50MB
          </div>
        </template>
      </el-upload>
    </el-form-item>
    
    <el-form-item>
      <el-button type="primary" @click="handleSubmit" :loading="loading">
        提交
      </el-button>
      <el-button @click="handleReset">重置</el-button>
    </el-form-item>
  </el-form>
</template>

<script setup>
import { ref } from 'vue';
import { ElMessage } from 'element-plus';
import axios from 'axios';

const form = ref({
  caseId: '',
  documentName: '',
  recipientName: '',
  documentType: '',
  recipientType: '',
  contactPhone: '',
  deliveryAddress: '',
  deliveryMethod: '',
  deliveryContent: ''
});

const fileList = ref([]);
const loading = ref(false);

const handleFileChange = (uploadFile, uploadFiles) => {
  fileList.value = uploadFiles;
};

const handleSubmit = async () => {
  // 表单验证
  if (!form.value.caseId || !form.value.documentName || !form.value.recipientName) {
    ElMessage.error('请填写必填项');
    return;
  }
  
  if (fileList.value.length === 0) {
    ElMessage.error('请至少选择一个文件');
    return;
  }
  
  loading.value = true;
  
  try {
    // 构建FormData
    const formData = new FormData();
    
    // 添加表单字段
    Object.keys(form.value).forEach(key => {
      if (form.value[key]) {
        formData.append(key, form.value[key]);
      }
    });
    
    // 添加文件
    fileList.value.forEach(file => {
      formData.append('files', file.raw);
    });
    
    // 发送请求
    const response = await axios.post('/document-delivery/with-files', formData, {
      headers: {
        'Content-Type': 'multipart/form-data'
      },
      timeout: 60000
    });
    
    if (response.data.code === 200) {
      ElMessage.success('文书送达创建成功！');
      console.log('创建成功:', response.data.data);
      
      // 可以在这里跳转到详情页或列表页
      // router.push(`/document-delivery/${response.data.data.deliveryId}`);
    } else {
      ElMessage.error(response.data.message || '创建失败');
    }
  } catch (error) {
    console.error('创建失败:', error);
    ElMessage.error('创建失败，请稍后重试');
  } finally {
    loading.value = false;
  }
};

const handleReset = () => {
  form.value = {
    caseId: '',
    documentName: '',
    recipientName: '',
    documentType: '',
    recipientType: '',
    contactPhone: '',
    deliveryAddress: '',
    deliveryMethod: '',
    deliveryContent: ''
  };
  fileList.value = [];
};
</script>
```

### 响应示例

**成功响应**：
```json
{
  "code": 200,
  "message": "文书送达及文件创建成功",
  "data": {
    "deliveryId": 123,
    "files": [
      {
        "fileId": 456,
        "originalFileName": "送达通知书.pdf",
        "storedFileName": "abc123def456_送达通知书.pdf",
        "fileSize": 1024000,
        "fileExtension": "pdf",
        "mimeType": "application/pdf"
      },
      {
        "fileId": 457,
        "originalFileName": "附件.docx",
        "storedFileName": "xyz789ghi012_附件.docx",
        "fileSize": 512000,
        "fileExtension": "docx",
        "mimeType": "application/vnd.openxmlformats-officedocument.wordprocessingml.document"
      }
    ]
  }
}
```

**失败响应**：
```json
{
  "code": 500,
  "message": "案件ID不能为空",
  "data": null
}
```

### 参数说明

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| caseId | Long | 是 | 案件ID |
| documentName | String | 是 | 文书名称 |
| recipientName | String | 是 | 受送达人 |
| documentType | String | 否 | 文书类型：COURT_NOTICE/JUDGMENT/VERDICT/NOTICE/OTHER |
| recipientType | String | 否 | 受送达人类型：DEBTOR/CREDITOR/LAWYER/COURT/OTHER |
| contactPhone | String | 否 | 联系电话 |
| deliveryAddress | String | 否 | 送达地址 |
| deliveryMethod | String | 否 | 送达方式：POST/EMAIL/EXPRESS/IN_PERSON/ELECTRONIC/OTHER |
| deliveryContent | String | 否 | 送达内容（富文本） |
| sendStatus | String | 否 | 发送状态：PENDING/SENDING/SENT/DELIVERED/FAILED/REJECTED |
| status | String | 否 | 状态：PENDING/ACTIVE/INACTIVE |
| files | List<MultipartFile> | 是 | 文件列表，至少一个文件 |
| fileDescriptions | List<String> | 否 | 文件描述列表，与files一一对应 |

### 注意事项

1. **文件大小限制**：单个文件不超过50MB
2. **文件数量限制**：建议不超过10个文件
3. **超时设置**：建议设置超时时间为60秒或更长
4. **事务保证**：文书创建和文件上传在同一个事务中，任何一步失败都会全部回滚
5. **文件关联**：上传的文件会自动关联到创建的文书送达记录（biz_type=DOCUMENT_DELIVERY，biz_id=deliveryId）


### 核心特性

✅ **事务保证**：文书创建和文件上传在同一个事务中，确保数据一致性  
✅ **自动关联**：文件自动关联到文书送达记录（biz_type=DOCUMENT_DELIVERY）  
✅ **批量上传**：支持同时上传多个文件  
✅ **详细日志**：记录完整的操作日志，便于排查问题  
✅ **参数验证**：完整的参数验证，确保数据有效性
