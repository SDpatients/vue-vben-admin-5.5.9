# 文件上传API汇总文档

## 目录
- [概述](#概述)
- [认证机制](#认证机制)
- [API接口列表](#api接口列表)
- [业务规则](#业务规则)
- [错误码说明](#错误码说明)
- [前端集成示例](#前端集成示例)
- [常见问题](#常见问题)

---

## 概述

本文档详细说明了法律破产管理系统的文件上传相关API接口，供前端开发人员参考和集成使用。

### 基础信息

- **基础URL**: `http://192.168.0.120:8080/api/v1`
- **Content-Type**: `multipart/form-data`（文件上传）
- **认证方式**: JWT Bearer Token
- **字符编码**: UTF-8

### 文件存储规则

- **默认上传路径**: `C:\law-upload`
- **目录结构**: `{上传路径}/{业务类型}/{日期}/{存储文件名}`
- **文件命名**: `{UUID}_{原始文件名}`
- **最大文件大小**: 50MB

---

## 认证机制

### JWT Token认证

所有文件上传相关API都需要JWT Token认证（除公开接口外）。

### 请求头格式

```
Authorization: Bearer {token}
```

### Token获取

Token通过登录接口获取，详见登录模块文档。

### Token有效期

- **访问令牌**: 180000000毫秒（约50小时）
- **刷新令牌**: 2592000000毫秒（约30天）

---

## API接口列表

### 1. 文件上传

#### 接口信息

- **接口路径**: `/file/upload`
- **请求方法**: `POST`
- **Content-Type**: `multipart/form-data`
- **是否需要认证**: 是

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| file | File | 是 | 上传的文件对象 |
| bizType | String | 是 | 业务类型（如：case、creditor、debtor等） |
| bizId | Long | 是 | 业务ID（关联的业务记录ID） |

#### 请求示例

**JavaScript (Axios)**

```javascript
const formData = new FormData();
formData.append('file', fileObject);
formData.append('bizType', 'case');
formData.append('bizId', '123');

axios.post('http://192.168.0.120:8080/api/v1/file/upload', formData, {
  headers: {
    'Authorization': 'Bearer ' + token,
    'Content-Type': 'multipart/form-data'
  }
})
.then(response => {
  console.log('上传成功', response.data);
})
.catch(error => {
  console.error('上传失败', error);
});
```

**JavaScript (Fetch)**

```javascript
const formData = new FormData();
formData.append('file', fileObject);
formData.append('bizType', 'case');
formData.append('bizId', '123');

fetch('http://192.168.0.120:8080/api/v1/file/upload', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer ' + token
  },
  body: formData
})
.then(response => response.json())
.then(data => {
  console.log('上传成功', data);
})
.catch(error => {
  console.error('上传失败', error);
});
```

#### 响应示例

**成功响应**

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "originalFileName": "合同.pdf",
    "storedFileName": "a1b2c3d4-e5f6-7890-abcd-ef1234567890_合同.pdf",
    "filePath": "C:\\law-upload\\case\\2025-01-12\\a1b2c3d4-e5f6-7890-abcd-ef1234567890_合同.pdf",
    "fileSize": 2048576,
    "fileExtension": "pdf",
    "mimeType": "application/pdf",
    "fileHash": null,
    "bizType": "case",
    "bizId": 123,
    "uploadTime": "2025-01-12T10:30:00",
    "uploadUserId": 1,
    "fileStatus": 1,
    "status": "ACTIVE",
    "createTime": "2025-01-12T10:30:00",
    "updateTime": "2025-01-12T10:30:00"
  }
}
```

**错误响应**

```json
{
  "code": 500,
  "message": "文件大小不能超过50MB"
}
```

#### 常见业务类型（bizType）

| 业务类型 | 说明 | 示例 |
|----------|------|------|
| case | 案件相关文件 | 案件申请书、裁定书等 |
| creditor | 债权人相关文件 | 身份证明、债权证明等 |
| debtor | 债务人相关文件 | 企业资料、财务报表等 |
| claim | 债权申报文件 | 申报表、证明材料等 |
| announcement | 公告文件 | 公告文书等 |
| fund | 资金相关文件 | 收据、发票等 |
| common | 通用文件 | 其他类型文件 |

---

### 2. 文件下载

#### 接口信息

- **接口路径**: `/file/download/{fileId}`
- **请求方法**: `GET`
- **是否需要认证**: 是

#### 路径参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| fileId | Long | 是 | 文件ID |

#### 请求示例

**JavaScript (直接下载)**

```javascript
const fileId = 1;
const token = 'your-jwt-token';

window.location.href = `http://192.168.0.120:8080/api/v1/file/download/${fileId}?token=${token}`;
```

**JavaScript (使用Fetch下载)**

```javascript
const fileId = 1;

fetch(`http://192.168.0.120:8080/api/v1/file/download/${fileId}`, {
  method: 'GET',
  headers: {
    'Authorization': 'Bearer ' + token
  }
})
.then(response => response.blob())
.then(blob => {
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = '文件名.pdf';
  document.body.appendChild(a);
  a.click();
  window.URL.revokeObjectURL(url);
  document.body.removeChild(a);
})
.catch(error => {
  console.error('下载失败', error);
});
```

#### 响应

- **Content-Type**: 根据文件类型自动设置
- **Content-Disposition**: `attachment; filename="{原始文件名}"`
- **Content-Length**: 文件大小（字节）

---

### 3. 获取文件信息

#### 接口信息

- **接口路径**: `/file/{fileId}`
- **请求方法**: `GET`
- **是否需要认证**: 是

#### 路径参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| fileId | Long | 是 | 文件ID |

#### 请求示例

```javascript
const fileId = 1;

axios.get(`http://192.168.0.120:8080/api/v1/file/${fileId}`, {
  headers: {
    'Authorization': 'Bearer ' + token
  }
})
.then(response => {
  console.log('文件信息', response.data);
})
.catch(error => {
  console.error('获取失败', error);
});
```

#### 响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "originalFileName": "合同.pdf",
    "storedFileName": "a1b2c3d4-e5f6-7890-abcd-ef1234567890_合同.pdf",
    "filePath": "C:\\law-upload\\case\\2025-01-12\\a1b2c3d4-e5f6-7890-abcd-ef1234567890_合同.pdf",
    "fileSize": 2048576,
    "fileExtension": "pdf",
    "mimeType": "application/pdf",
    "fileHash": null,
    "bizType": "case",
    "bizId": 123,
    "uploadTime": "2025-01-12T10:30:00",
    "uploadUserId": 1,
    "fileStatus": 1,
    "status": "ACTIVE",
    "createTime": "2025-01-12T10:30:00",
    "updateTime": "2025-01-12T10:30:00"
  }
}
```

---

### 4. 文件列表（分页）

#### 接口信息

- **接口路径**: `/file/list`
- **请求方法**: `GET`
- **是否需要认证**: 是

#### 查询参数

| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| pageNum | Integer | 否 | 1 | 页码（从1开始） |
| pageSize | Integer | 否 | 10 | 每页大小 |
| bizType | String | 否 | - | 业务类型（筛选条件） |
| bizId | Long | 否 | - | 业务ID（筛选条件） |
| status | String | 否 | - | 状态（筛选条件） |

#### 请求示例

```javascript
const params = {
  pageNum: 1,
  pageSize: 10,
  bizType: 'case',
  bizId: 123,
  status: 'ACTIVE'
};

axios.get('http://192.168.0.120:8080/api/v1/file/list', {
  headers: {
    'Authorization': 'Bearer ' + token
  },
  params: params
})
.then(response => {
  console.log('文件列表', response.data);
})
.catch(error => {
  console.error('获取失败', error);
});
```

#### 响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 25,
    "list": [
      {
        "id": 1,
        "originalFileName": "合同.pdf",
        "storedFileName": "a1b2c3d4-e5f6-7890-abcd-ef1234567890_合同.pdf",
        "filePath": "C:\\law-upload\\case\\2025-01-12\\a1b2c3d4-e5f6-7890-abcd-ef1234567890_合同.pdf",
        "fileSize": 2048576,
        "fileExtension": "pdf",
        "mimeType": "application/pdf",
        "fileHash": null,
        "bizType": "case",
        "bizId": 123,
        "uploadTime": "2025-01-12T10:30:00",
        "uploadUserId": 1,
        "fileStatus": 1,
        "status": "ACTIVE",
        "createTime": "2025-01-12T10:30:00",
        "updateTime": "2025-01-12T10:30:00"
      }
    ]
  }
}
```

---

### 5. 删除文件

#### 接口信息

- **接口路径**: `/file/{fileId}`
- **请求方法**: `DELETE`
- **是否需要认证**: 是

#### 路径参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| fileId | Long | 是 | 文件ID |

#### 请求示例

```javascript
const fileId = 1;

axios.delete(`http://192.168.0.120:8080/api/v1/file/${fileId}`, {
  headers: {
    'Authorization': 'Bearer ' + token
  }
})
.then(response => {
  console.log('删除成功', response.data);
})
.catch(error => {
  console.error('删除失败', error);
});
```

#### 响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```

---

### 6. 批量删除文件

#### 接口信息

- **接口路径**: `/file/batch`
- **请求方法**: `DELETE`
- **Content-Type**: `application/json`
- **是否需要认证**: 是

#### 请求体

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| fileIds | Array[Long] | 是 | 文件ID列表 |

#### 请求示例

```javascript
const fileIds = [1, 2, 3];

axios.delete('http://192.168.0.120:8080/api/v1/file/batch', {
  headers: {
    'Authorization': 'Bearer ' + token,
    'Content-Type': 'application/json'
  },
  data: fileIds
})
.then(response => {
  console.log('批量删除成功', response.data);
})
.catch(error => {
  console.error('批量删除失败', error);
});
```

#### 响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```

---

### 7. 文件重命名

#### 接口信息

- **接口路径**: `/file/{fileId}/rename`
- **请求方法**: `PUT`
- **Content-Type**: `multipart/form-data` 或 `application/x-www-form-urlencoded`
- **是否需要认证**: 是

#### 路径参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| fileId | Long | 是 | 文件ID |

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| newFileName | String | 是 | 新文件名 |

#### 请求示例

```javascript
const fileId = 1;
const formData = new FormData();
formData.append('newFileName', '新文件名.pdf');

axios.put(`http://192.168.0.120:8080/api/v1/file/${fileId}/rename`, formData, {
  headers: {
    'Authorization': 'Bearer ' + token
  }
})
.then(response => {
  console.log('重命名成功', response.data);
})
.catch(error => {
  console.error('重命名失败', error);
});
```

#### 响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "originalFileName": "新文件名.pdf",
    "storedFileName": "e5f6g7h8-i9j0-1234-5678-90abcdef1234_新文件名.pdf",
    "filePath": "C:\\law-upload\\case\\2025-01-12\\e5f6g7h8-i9j0-1234-5678-90abcdef1234_新文件名.pdf",
    "fileSize": 2048576,
    "fileExtension": "pdf",
    "mimeType": "application/pdf",
    "fileHash": null,
    "bizType": "case",
    "bizId": 123,
    "uploadTime": "2025-01-12T10:30:00",
    "uploadUserId": 1,
    "fileStatus": 1,
    "status": "ACTIVE",
    "createTime": "2025-01-12T10:30:00",
    "updateTime": "2025-01-12T11:00:00"
  }
}
```

---

### 8. 更新文件状态

#### 接口信息

- **接口路径**: `/file/{fileId}/status`
- **请求方法**: `PUT`
- **Content-Type**: `multipart/form-data` 或 `application/x-www-form-urlencoded`
- **是否需要认证**: 是

#### 路径参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| fileId | Long | 是 | 文件ID |

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| status | String | 是 | 状态值 |

#### 请求示例

```javascript
const fileId = 1;
const formData = new FormData();
formData.append('status', 'INACTIVE');

axios.put(`http://192.168.0.120:8080/api/v1/file/${fileId}/status`, formData, {
  headers: {
    'Authorization': 'Bearer ' + token
  }
})
.then(response => {
  console.log('状态更新成功', response.data);
})
.catch(error => {
  console.error('状态更新失败', error);
});
```

#### 响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "originalFileName": "合同.pdf",
    "storedFileName": "a1b2c3d4-e5f6-7890-abcd-ef1234567890_合同.pdf",
    "filePath": "C:\\law-upload\\case\\2025-01-12\\a1b2c3d4-e5f6-7890-abcd-ef1234567890_合同.pdf",
    "fileSize": 2048576,
    "fileExtension": "pdf",
    "mimeType": "application/pdf",
    "fileHash": null,
    "bizType": "case",
    "bizId": 123,
    "uploadTime": "2025-01-12T10:30:00",
    "uploadUserId": 1,
    "fileStatus": 1,
    "status": "INACTIVE",
    "createTime": "2025-01-12T10:30:00",
    "updateTime": "2025-01-12T11:00:00"
  }
}
```

---

### 9. 批量更新文件状态

#### 接口信息

- **接口路径**: `/file/batch/status`
- **请求方法**: `PUT`
- **Content-Type**: `application/json`
- **是否需要认证**: 是

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| fileIds | Array[Long] | 是 | 文件ID列表 |
| status | String | 是 | 状态值 |

#### 请求示例

```javascript
const params = {
  fileIds: [1, 2, 3],
  status: 'INACTIVE'
};

axios.put('http://192.168.0.120:8080/api/v1/file/batch/status', null, {
  headers: {
    'Authorization': 'Bearer ' + token,
    'Content-Type': 'application/json'
  },
  params: params
})
.then(response => {
  console.log('批量更新成功', response.data);
})
.catch(error => {
  console.error('批量更新失败', error);
});
```

#### 响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```

---

### 10. 获取文件统计信息

#### 接口信息

- **接口路径**: `/file/statistics`
- **请求方法**: `GET`
- **是否需要认证**: 是

#### 查询参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| bizType | String | 否 | 业务类型（筛选条件） |
| bizId | Long | 否 | 业务ID（筛选条件） |

#### 请求示例

```javascript
const params = {
  bizType: 'case',
  bizId: 123
};

axios.get('http://192.168.0.120:8080/api/v1/file/statistics', {
  headers: {
    'Authorization': 'Bearer ' + token
  },
  params: params
})
.then(response => {
  console.log('统计信息', response.data);
})
.catch(error => {
  console.error('获取失败', error);
});
```

#### 响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "totalFiles": 25,
    "totalSize": 52428800,
    "totalSizeMB": 50.0,
    "statusCount": {
      "ACTIVE": 20,
      "INACTIVE": 5
    },
    "extensionCount": {
      "pdf": 15,
      "doc": 5,
      "jpg": 3,
      "png": 2
    }
  }
}
```

---

### 11. 文件预览

#### 接口信息

- **接口路径**: `/file/preview/{fileId}`
- **请求方法**: `GET`
- **是否需要认证**: 是

#### 路径参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| fileId | Long | 是 | 文件ID |

#### 请求示例

```javascript
const fileId = 1;

fetch(`http://192.168.0.120:8080/api/v1/file/preview/${fileId}`, {
  method: 'GET',
  headers: {
    'Authorization': 'Bearer ' + token
  }
})
.then(response => response.blob())
.then(blob => {
  const url = window.URL.createObjectURL(blob);
  window.open(url, '_blank');
})
.catch(error => {
  console.error('预览失败', error);
});
```

#### 响应

- **Content-Type**: 根据文件类型自动设置
- **Content-Disposition**: `inline; filename="{原始文件名}"`

#### 支持预览的文件类型

- 图片文件：`image/*`（jpg, png, gif等）
- 文本文件：`text/*`（txt, csv等）
- PDF文件：`application/pdf`

其他文件类型不支持预览，会返回错误提示。

---

## 业务规则

### 文件大小限制

- **最大文件大小**: 50MB
- **超出限制**: 返回错误提示"文件大小不能超过50MB"

### 文件类型支持

系统支持所有类型的文件上传，但预览功能仅支持以下类型：
- 图片文件（jpg, png, gif等）
- 文本文件（txt, csv等）
- PDF文件

### 文件命名规则

- **原始文件名**: 保留用户上传时的文件名
- **存储文件名**: `{UUID}_{原始文件名}`
- **存储路径**: `{上传路径}/{业务类型}/{日期}/{存储文件名}`

### 业务类型（bizType）

业务类型用于对文件进行分类管理，常见的业务类型包括：

| 业务类型 | 说明 | 适用场景 |
|----------|------|----------|
| case | 案件文件 | 破产案件相关文档 |
| creditor | 债权人文件 | 债权人身份证明、债权证明等 |
| debtor | 债务人文件 | 债务人企业资料、财务报表等 |
| claim | 债权申报文件 | 债权申报表、证明材料等 |
| announcement | 公告文件 | 案件公告、通知等 |
| fund | 资金文件 | 收据、发票、转账凭证等 |
| common | 通用文件 | 其他类型文件 |

### 文件状态（status）

| 状态值 | 说明 |
|--------|------|
| ACTIVE | 激活状态（默认） |
| INACTIVE | 停用状态 |
| DELETED | 删除状态 |

### 文件业务状态（fileStatus）

| 状态值 | 说明 |
|--------|------|
| 0 | 无效 |
| 1 | 有效（默认） |

### 分页规则

- **默认页码**: 1
- **默认每页大小**: 10
- **排序方式**: 按上传时间降序排列

---

## 错误码说明

### 通用响应格式

所有API响应都遵循以下格式：

```json
{
  "code": 200,
  "message": "success",
  "data": {}
}
```

### HTTP状态码

| 状态码 | 说明 |
|--------|------|
| 200 | 请求成功 |
| 400 | 请求参数错误 |
| 401 | 未授权（Token无效或过期） |
| 404 | 资源不存在 |
| 429 | 请求频率超限 |
| 500 | 服务器内部错误 |

### 业务错误码

| 错误码 | 错误信息 | 说明 |
|--------|----------|------|
| 500 | 文件不能为空 | 上传的文件为空 |
| 500 | 文件大小不能超过50MB | 文件大小超出限制 |
| 500 | 文件不存在 | 指定的文件ID不存在 |
| 500 | 文件上传失败：{错误信息} | 文件上传过程中发生错误 |
| 500 | 文件删除失败：{错误信息} | 文件删除过程中发生错误 |
| 500 | 文件ID列表不能为空 | 批量操作时未提供文件ID列表 |
| 500 | 新文件名不能为空 | 重命名时未提供新文件名 |
| 500 | 文件重命名失败：{错误信息} | 文件重命名过程中发生错误 |
| 500 | 状态不能为空 | 更新状态时未提供状态值 |
| 500 | 该文件类型不支持预览 | 文件类型不支持预览功能 |
| 400 | 参数校验失败：{错误信息} | 请求参数验证失败 |
| 500 | 系统异常，请联系管理员 | 服务器内部错误 |

### 错误处理建议

前端开发人员应根据不同的错误码和错误信息，向用户展示友好的错误提示：

```javascript
axios.post('/file/upload', formData, config)
  .then(response => {
    if (response.data.code === 200) {
      showToast('上传成功', 'success');
    } else {
      showToast(response.data.message, 'error');
    }
  })
  .catch(error => {
    if (error.response) {
      const { status, data } = error.response;
      if (status === 401) {
        showToast('登录已过期，请重新登录', 'error');
        // 跳转到登录页
      } else if (status === 429) {
        showToast('请求过于频繁，请稍后再试', 'warning');
      } else {
        showToast(data.message || '请求失败', 'error');
      }
    } else {
      showToast('网络错误，请检查网络连接', 'error');
    }
  });
```

---

## 前端集成示例

### 完整的上传组件示例

```vue
<template>
  <div class="file-upload">
    <input
      type="file"
      ref="fileInput"
      @change="handleFileChange"
      :accept="acceptTypes"
      :multiple="multiple"
      style="display: none"
    />
    
    <button @click="triggerFileUpload">
      选择文件
    </button>
    
    <div v-if="uploading" class="upload-progress">
      <progress :value="uploadProgress" max="100"></progress>
      <span>{{ uploadProgress }}%</span>
    </div>
    
    <div v-if="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>
  </div>
</template>

<script>
import axios from 'axios';

export default {
  name: 'FileUpload',
  props: {
    bizType: {
      type: String,
      required: true
    },
    bizId: {
      type: Number,
      required: true
    },
    acceptTypes: {
      type: String,
      default: '*'
    },
    multiple: {
      type: Boolean,
      default: false
    },
    maxSize: {
      type: Number,
      default: 50 * 1024 * 1024 // 50MB
    }
  },
  data() {
    return {
      uploading: false,
      uploadProgress: 0,
      errorMessage: ''
    };
  },
  methods: {
    triggerFileUpload() {
      this.$refs.fileInput.click();
    },
    
    handleFileChange(event) {
      const files = event.target.files;
      if (files.length > 0) {
        this.uploadFiles(files);
      }
    },
    
    async uploadFiles(files) {
      this.uploading = true;
      this.uploadProgress = 0;
      this.errorMessage = '';
      
      try {
        const token = localStorage.getItem('token');
        
        for (let i = 0; i < files.length; i++) {
          const file = files[i];
          
          // 验证文件大小
          if (file.size > this.maxSize) {
            throw new Error(`文件 ${file.name} 大小超过限制（最大${this.maxSize / 1024 / 1024}MB）`);
          }
          
          const formData = new FormData();
          formData.append('file', file);
          formData.append('bizType', this.bizType);
          formData.append('bizId', this.bizId);
          
          const response = await axios.post(
            'http://192.168.0.120:8080/api/v1/file/upload',
            formData,
            {
              headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'multipart/form-data'
              },
              onUploadProgress: (progressEvent) => {
                const progress = Math.round(
                  (progressEvent.loaded / progressEvent.total) * 100
                );
                this.uploadProgress = Math.round(
                  ((i * 100 + progress) / files.length)
                );
              }
            }
          );
          
          if (response.data.code === 200) {
            this.$emit('upload-success', response.data.data);
          } else {
            throw new Error(response.data.message);
          }
        }
        
        this.$emit('upload-complete');
      } catch (error) {
        this.errorMessage = error.message || '上传失败';
        this.$emit('upload-error', error);
      } finally {
        this.uploading = false;
        this.uploadProgress = 0;
        this.$refs.fileInput.value = '';
      }
    }
  }
};
</script>

<style scoped>
.file-upload {
  padding: 20px;
}

.upload-progress {
  margin-top: 10px;
}

.error-message {
  margin-top: 10px;
  color: red;
}
</style>
```

### 文件列表组件示例

```vue
<template>
  <div class="file-list">
    <div class="filter-bar">
      <select v-model="filterBizType" @change="loadFileList">
        <option value="">全部类型</option>
        <option value="case">案件文件</option>
        <option value="creditor">债权人文件</option>
        <option value="debtor">债务人文件</option>
      </select>
      
      <select v-model="filterStatus" @change="loadFileList">
        <option value="">全部状态</option>
        <option value="ACTIVE">激活</option>
        <option value="INACTIVE">停用</option>
      </select>
    </div>
    
    <div class="file-table">
      <table>
        <thead>
          <tr>
            <th>文件名</th>
            <th>文件大小</th>
            <th>业务类型</th>
            <th>上传时间</th>
            <th>状态</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="file in fileList" :key="file.id">
            <td>{{ file.originalFileName }}</td>
            <td>{{ formatFileSize(file.fileSize) }}</td>
            <td>{{ file.bizType }}</td>
            <td>{{ formatDate(file.uploadTime) }}</td>
            <td>{{ file.status }}</td>
            <td>
              <button @click="downloadFile(file.id)">下载</button>
              <button @click="previewFile(file.id)" v-if="canPreview(file)">预览</button>
              <button @click="deleteFile(file.id)">删除</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <div class="pagination">
      <button @click="prevPage" :disabled="pageNum <= 1">上一页</button>
      <span>第 {{ pageNum }} 页，共 {{ totalPages }} 页</span>
      <button @click="nextPage" :disabled="pageNum >= totalPages">下一页</button>
    </div>
  </div>
</template>

<script>
import axios from 'axios';

export default {
  name: 'FileList',
  data() {
    return {
      fileList: [],
      pageNum: 1,
      pageSize: 10,
      total: 0,
      filterBizType: '',
      filterStatus: ''
    };
  },
  computed: {
    totalPages() {
      return Math.ceil(this.total / this.pageSize);
    }
  },
  mounted() {
    this.loadFileList();
  },
  methods: {
    async loadFileList() {
      try {
        const token = localStorage.getItem('token');
        const params = {
          pageNum: this.pageNum,
          pageSize: this.pageSize,
          bizType: this.filterBizType || undefined,
          status: this.filterStatus || undefined
        };
        
        const response = await axios.get(
          'http://192.168.0.120:8080/api/v1/file/list',
          {
            headers: {
              'Authorization': `Bearer ${token}`
            },
            params: params
          }
        );
        
        if (response.data.code === 200) {
          this.fileList = response.data.data.list;
          this.total = response.data.data.total;
        }
      } catch (error) {
        console.error('加载文件列表失败', error);
      }
    },
    
    downloadFile(fileId) {
      const token = localStorage.getItem('token');
      window.location.href = `http://192.168.0.120:8080/api/v1/file/download/${fileId}?token=${token}`;
    },
    
    async previewFile(fileId) {
      try {
        const token = localStorage.getItem('token');
        const response = await fetch(
          `http://192.168.0.120:8080/api/v1/file/preview/${fileId}`,
          {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          }
        );
        
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        window.open(url, '_blank');
      } catch (error) {
        console.error('预览失败', error);
      }
    },
    
    canPreview(file) {
      const mimeType = file.mimeType;
      return mimeType && (
        mimeType.startsWith('image/') ||
        mimeType.startsWith('text/') ||
        mimeType === 'application/pdf'
      );
    },
    
    async deleteFile(fileId) {
      if (!confirm('确定要删除这个文件吗？')) {
        return;
      }
      
      try {
        const token = localStorage.getItem('token');
        const response = await axios.delete(
          `http://192.168.0.120:8080/api/v1/file/${fileId}`,
          {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          }
        );
        
        if (response.data.code === 200) {
          alert('删除成功');
          this.loadFileList();
        }
      } catch (error) {
        console.error('删除失败', error);
        alert('删除失败');
      }
    },
    
    prevPage() {
      if (this.pageNum > 1) {
        this.pageNum--;
        this.loadFileList();
      }
    },
    
    nextPage() {
      if (this.pageNum < this.totalPages) {
        this.pageNum++;
        this.loadFileList();
      }
    },
    
    formatFileSize(bytes) {
      if (bytes === 0) return '0 B';
      const k = 1024;
      const sizes = ['B', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
    },
    
    formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleString('zh-CN');
    }
  }
};
</script>

<style scoped>
.file-list {
  padding: 20px;
}

.filter-bar {
  margin-bottom: 20px;
}

.filter-bar select {
  margin-right: 10px;
  padding: 5px;
}

.file-table {
  margin-bottom: 20px;
}

.file-table table {
  width: 100%;
  border-collapse: collapse;
}

.file-table th,
.file-table td {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: left;
}

.file-table th {
  background-color: #f2f2f2;
}

.pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
}
</style>
```

---

## 常见问题

### 1. 如何处理大文件上传？

当前系统限制文件大小为50MB，如果需要上传更大的文件，建议：
- 联系后端开发人员调整配置
- 使用分片上传方案（需要后端支持）

### 2. 如何实现断点续传？

当前系统不支持断点续传。如需此功能，需要：
- 后端实现分片上传接口
- 前端实现文件分片和上传状态管理

### 3. 如何处理文件上传进度？

使用axios的`onUploadProgress`回调：

```javascript
axios.post('/file/upload', formData, {
  onUploadProgress: (progressEvent) => {
    const progress = Math.round(
      (progressEvent.loaded / progressEvent.total) * 100
    );
    console.log('上传进度:', progress + '%');
  }
});
```

### 4. 如何限制文件类型？

在input元素上设置accept属性：

```html
<input type="file" accept=".pdf,.doc,.docx,.jpg,.png" />
```

或在上传前验证文件类型：

```javascript
const allowedTypes = ['application/pdf', 'image/jpeg', 'image/png'];
if (!allowedTypes.includes(file.type)) {
  alert('不支持的文件类型');
  return;
}
```

### 5. 如何处理Token过期？

监听401错误，跳转到登录页：

```javascript
axios.interceptors.response.use(
  response => response,
  error => {
    if (error.response && error.response.status === 401) {
      localStorage.removeItem('token');
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);
```

### 6. 如何批量上传文件？

使用multiple属性和FormData：

```html
<input type="file" multiple @change="handleMultipleFiles" />
```

```javascript
async handleMultipleFiles(event) {
  const files = event.target.files;
  const uploadPromises = [];
  
  for (let i = 0; i < files.length; i++) {
    const formData = new FormData();
    formData.append('file', files[i]);
    formData.append('bizType', this.bizType);
    formData.append('bizId', this.bizId);
    
    uploadPromises.push(
      axios.post('/file/upload', formData, {
        headers: { 'Authorization': `Bearer ${token}` }
      })
    );
  }
  
  try {
    const results = await Promise.all(uploadPromises);
    console.log('批量上传成功', results);
  } catch (error) {
    console.error('批量上传失败', error);
  }
}
```

### 7. 如何实现文件拖拽上传？

```vue
<template>
  <div
    class="drop-zone"
    @dragover.prevent="handleDragOver"
    @dragleave.prevent="handleDragLeave"
    @drop.prevent="handleDrop"
  >
    <p>拖拽文件到此处上传</p>
  </div>
</template>

<script>
export default {
  methods: {
    handleDragOver(event) {
      event.target.classList.add('drag-over');
    },
    handleDragLeave(event) {
      event.target.classList.remove('drag-over');
    },
    handleDrop(event) {
      event.target.classList.remove('drag-over');
      const files = event.dataTransfer.files;
      this.uploadFiles(files);
    },
    uploadFiles(files) {
      // 上传逻辑
    }
  }
};
</script>

<style scoped>
.drop-zone {
  border: 2px dashed #ccc;
  padding: 40px;
  text-align: center;
  cursor: pointer;
}

.drop-zone.drag-over {
  border-color: #007bff;
  background-color: #f0f8ff;
}
</style>
```

### 8. 如何处理文件名重复？

系统自动为每个文件生成唯一的存储文件名（UUID + 原始文件名），因此不会出现文件名冲突的问题。

### 9. 如何获取文件的URL？

文件需要通过下载或预览接口访问，不支持直接通过URL访问。如需在页面中显示图片：

```javascript
async showImage(fileId) {
  const token = localStorage.getItem('token');
  const response = await fetch(`/file/preview/${fileId}`, {
    headers: { 'Authorization': `Bearer ${token}` }
  });
  const blob = await response.blob();
  const url = URL.createObjectURL(blob);
  this.imageUrl = url;
}
```

### 10. 如何删除文件后同时删除数据库记录？

调用删除接口会同时删除物理文件和数据库记录：

```javascript
await axios.delete(`/file/${fileId}`, {
  headers: { 'Authorization': `Bearer ${token}` }
});
```

---

## 附录

### 数据库表结构

#### tb_file_record（文件记录表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | bigint | 主键ID |
| original_file_name | varchar(500) | 原始文件名 |
| stored_file_name | varchar(100) | 存储文件名 |
| file_path | varchar(1000) | 文件路径 |
| file_size | bigint | 文件大小（字节） |
| file_extension | varchar(20) | 文件扩展名 |
| mime_type | varchar(100) | MIME类型 |
| file_hash | varchar(128) | 文件哈希值 |
| biz_type | varchar(50) | 业务类型 |
| biz_id | bigint | 业务ID |
| upload_time | datetime | 上传时间 |
| upload_user_id | bigint | 上传用户ID |
| file_status | tinyint(1) | 文件状态：0-无效，1-有效 |
| status | varchar(20) | 状态：ACTIVE-激活，INACTIVE-停用，DELETED-删除 |
| is_deleted | tinyint(1) | 是否删除：0-否，1-是 |
| delete_time | datetime | 删除时间 |
| delete_user_id | bigint | 删除用户ID |
| create_time | datetime | 创建时间 |
| update_time | datetime | 修改时间 |
| create_user_id | bigint | 创建者ID |
| update_user_id | bigint | 修改者ID |

### 索引说明

- idx_biz_type: 业务类型索引
- idx_biz_id: 业务ID索引
- idx_file_status: 文件状态索引
- idx_status: 状态索引
- idx_upload_time: 上传时间索引
- idx_upload_user_id: 上传用户ID索引
- idx_create_time: 创建时间索引

### 配置参数

#### application.yml

```yaml
file:
  upload:
    path: C:\law-upload  # 文件上传路径
```

---

## 联系方式

如有问题或建议，请联系后端开发团队。

---

**文档版本**: 1.0  
**更新日期**: 2025-01-12  
**维护者**: 后端开发团队
